# Copyright 2019 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Product
name: MLEngine
display_name: ML Engine
versions:
  - !ruby/object:Api::Product::Version
    name: ga
    base_url: https://ml.googleapis.com/v1/
scopes:
  - https://www.googleapis.com/auth/cloud-platform
apis_required:
  - !ruby/object:Api::Product::ApiReference
    name: Cloud ML
    url: https://console.cloud.google.com/apis/library/ml.googleapis.com
objects:
  - !ruby/object:Api::Resource
    name: 'Model'
    base_url: projects/{{project}}/models
    self_link: projects/{{project}}/models/{{name}}
    # This resources is not updatable (outside of versions, which is a version-level method)
    input: true
    async: !ruby/object:Api::Async
      actions: ['delete']
      operation: !ruby/object:Api::Async::Operation
        path: 'name'
        base_url: '{{op_id}}'
        wait_ms: 1000
      result: !ruby/object:Api::Async::Result
        path: 'response'
        resource_inside_response: true
      status: !ruby/object:Api::Async::Status
        path: 'done'
        complete: True
        allowed:
          - True
          - False
      error: !ruby/object:Api::Async::Error
        path: 'error'
        message: 'message'
    description: |
      Represents a machine learning solution.

      A model can have multiple versions, each of which is a deployed, trained model
      ready to receive prediction requests. The model itself is just a container.
    properties:
      - !ruby/object:Api::Type::String
        name: 'name'
        description: The name specified for the model.
        required: true
      - !ruby/object:Api::Type::String
        name: 'description'
        description: The description specified for the model when it was created.
      # Ignoring most of defaultVersion.
      # Only name should be exposed. Use the Version resource to learn more
      # about versions.
      - !ruby/object:Api::Type::NestedObject
        name: 'defaultVersion'
        description: |
          The default version of the model. This version will be used to handle
          prediction requests that do not specify a version.
        properties:
          - !ruby/object:Api::Type::String
            name: 'name'
            description: The name specified for the version when it was created.
        # Even though only one region is supported, keeping this as an array
        # to future-proof it.
      - !ruby/object:Api::Type::Array
        name: 'regions'
        description: |
          The list of regions where the model is going to be deployed.
          Currently only one region per model is supported
        item_type: Api::Type::String
      - !ruby/object:Api::Type::Boolean
        name: 'onlinePredictionLogging'
        description:  If true, online prediction access logs are sent to StackDriver Logging.
      - !ruby/object:Api::Type::Boolean
        name: 'onlinePredictionConsoleLogging'
        description: If true, online prediction nodes send stderr and stdout streams to Stackdriver Logging
      - !ruby/object:Api::Type::KeyValuePairs
        name: 'labels'
        description: One or more labels that you can add, to organize your models.
  - !ruby/object:Api::Resource
    name: 'Version'
    base_url: projects/{{project}}/models/{{model}}/versions
    self_link: projects/{{project}}/models/{{model}}/versions/{{name}}
    input: true
    description: |
      Each version is a trained model deployed in the cloud, ready to handle
      prediction requests. A model can have multiple versions
    async: !ruby/object:Api::Async
      operation: !ruby/object:Api::Async::Operation
        path: 'name'
        base_url: '{{op_id}}'
        wait_ms: 1000
      result: !ruby/object:Api::Async::Result
        path: 'response'
        resource_inside_response: true
      status: !ruby/object:Api::Async::Status
        path: 'done'
        complete: True
        allowed:
          - True
          - False
      error: !ruby/object:Api::Async::Error
        path: 'error'
        message: 'message'
    parameters:
      - !ruby/object:Api::Type::ResourceRef
        name: 'model'
        description: The model that this version belongs to
        resource: Model
        imports: name
        required: true
      - !ruby/object:Api::Type::Boolean
        name: 'isDefault'
        description:  If true, this version will be used to handle prediction requests that do not specify a version
    properties:
      - !ruby/object:Api::Type::String
        name: 'name'
        description: |
          The name specified for the version when it was created.

          The version name must be unique within the model it is created in.
        required: true
      - !ruby/object:Api::Type::String
        name: 'description'
        description: The description specified for the version when it was created.
      - !ruby/object:Api::Type::String
        name: 'deploymentUri'
        description: The Cloud Storage location of the trained model used to create the version
        required: true
      - !ruby/object:Api::Type::Time
        name: 'createTime'
        description: The time the version was created.
        output: true
      - !ruby/object:Api::Type::Time
        name: 'lastUseTime'
        description: The time the version was last used for prediction.
        output: true
      - !ruby/object:Api::Type::String
        name: 'runtimeVersion'
        description: The AI Platform runtime version to use for this deployment
      - !ruby/object:Api::Type::Enum
        name: 'machineType'
        description: The type of machine on which to serve the model. Currently only applies to online prediction service.
        values:
          - mls1-c1-m2
          - mls1-c4-m2
      - !ruby/object:Api::Type::Enum
        name: 'state'
        description: The state of a version
        values:
          - UNKNOWN
          - READY
          - CREATING
          - FAILED
          - DELETING
          - UPDATING
        output: true
      - !ruby/object:Api::Type::String
        name: 'errorMessage'
        description: The details of a failure or cancellation
        output: true
      - !ruby/object:Api::Type::Array
        name: 'packageUris'
        description: Cloud Storage paths (gs://â€¦) of packages for custom prediction routines or scikit-learn pipelines with custom code.
        output: true
        item_type: Api::Type::String
      - !ruby/object:Api::Type::KeyValuePairs
        name: 'labels'
        description: One or more labels that you can add, to organize your model versions
        # no etag since it's input: true
      - !ruby/object:Api::Type::Enum
        name: 'framework'
        description: The machine learning framework AI Platform uses to train this version of the model
        values:
          - FRAMEWORK_UNSPECIFIED
          - TENSORFLOW
          - SCIKIT_LEARN
          - XGBOOST
      - !ruby/object:Api::Type::Enum
        name: 'pythonVersion'
        description: |
          The version of Python used in prediction. If not set, the default
          version is '2.7'. Python '3.5' is available when runtimeVersion is
          set to '1.4' and above. Python '2.7' works with all supported runtime
          versions.
        values:
          - '2.7'
          - '3.5'
      - !ruby/object:Api::Type::String
        name: 'serviceAccount'
        description: Specifies the service account for resource access control.
      - !ruby/object:Api::Type::NestedObject
        name: 'autoScaling'
        description: |
          Automatically scale the number of nodes used to serve the model in
          response to increases and decreases in traffic. Care should be taken
          to ramp up traffic according to the model's ability to scale or you
          will start seeing increases in latency and 429 response codes.
        conflicts: ['manualScaling']
        properties:
          - !ruby/object:Api::Type::Integer
            name: 'minNodes'
            description: The minimum number of nodes to allocate for this mode
      - !ruby/object:Api::Type::NestedObject
        name: 'manualScaling'
        description: |
          Manually select the number of nodes to use for serving the model. You
          should generally use autoScaling with an appropriate minNodes
          instead, but this option is available if you want more predictable
          billing. Beware that latency and error rates will increase if the
          traffic exceeds that capability of the system to serve it based on
          the selected number of nodes.
        properties:
          - !ruby/object:Api::Type::Integer
            name: 'nodes'
            description: The number of nodes to allocate for this model. These nodes are always up, starting from the time the model is deployed
      - !ruby/object:Api::Type::String
        name: 'predictionClass'
        description: |
          The fully qualified name (module_name.class_name) of a class that
          implements the Predictor interface described in this reference
          field. The module containing this class should be included in a
          package provided to the packageUris field.
  - !ruby/object:Api::Resource
    name: 'Job'
    base_url: projects/{{project}}/jobs
    self_link: projects/{{project}}/jobs/{{name}}
    input: true
    description: |
      Represents a training or prediction job.
    properties:
      - !ruby/object:Api::Type::String
        name: 'jobId'
        description: Required. The user-specified id of the job.
        required: true
      - !ruby/object:Api::Type::Time
        name: 'createTime'
        description: When the job was created.
        output: true
      - !ruby/object:Api::Type::Time
        name: 'endTime'
        description: When the job processing was completed.
        output: true     
      - !ruby/object:Api::Type::Enum
        name: 'state'
        description: The detailed state of a job.
        values:
          - STATE_UNSPECIFIED
          - QUEUED
          - PREPARING
          - RUNNING
          - SUCCEEDED
          - FAILED
          - CANCELLING
          - CANCELLED
        output: true     
      - !ruby/object:Api::Type::String
        name: 'errorMessage'
        description: The details of a failure or a cancellation.
        output: true                
      - !ruby/object:Api::Type::KeyValuePairs
        name: 'labels'
        description: |
           One or more labels that you can add, to organize your jobs. Each label is a key-value pair, 
           where both the key and the value are arbitrary Strings that you supply. 
           An object containing a list of "key": value pairs. Example: { "name": "wrench", "mass": "1.3kg", "count": "3" }.
      # no etag since it's input: true     
      ## trainingInput starts here     
      - !ruby/object:Api::Type::NestedObject
        name: 'trainingInput'
        description: Input parameters to create a training job.
        output: false
        properties:
          - !ruby/object:Api::Type::Enum
            name: 'scaleTier'
            description: Specifies the machine types, the number of replicas for workers and parameter servers.
            values:
              - BASIC
              - STANDARD_1
              - PREMIUM_1
              - BASIC_GPU
              - BASIC_TPU
              - CUSTOM
            required: true
          - !ruby/object:Api::Type::String
            name: 'masterType'
            description: Specifies the type of virtual machine to use for your training job's master worker  
            required: false  
          - !ruby/object:Api::Type::NestedObject
            name: 'masterConfig'
            description: The configuration for your master worker.
            properties:
              - !ruby/object:Api::Type::NestedObject
                name: 'acceleratorConfig'
                description: Represents the type and number of accelerators used by the replica
                properties:
                - !ruby/object:Api::Type::Integer
                  name: 'count'
                  description: The number of accelerators to attach to each machine running the job.
                - !ruby/object:Api::Type::Enum
                  name: 'type'
                  description: The type of accelerator to use.
                  values:
                    - ACCELERATOR_TYPE_UNSPECIFIED
                    - NVIDIA_TESLA_K80	
                    - NVIDIA_TESLA_P100
                    - NVIDIA_TESLA_V100
                    - NVIDIA_TESLA_P4
                    - NVIDIA_TESLA_T4
                    - TPU_V2
                    - TPU_V3 
              - !ruby/object:Api::Type::String
                name: 'imageUri'
                description: The Docker image to run on the replica. This image must be in Container Registry.
              - !ruby/object:Api::Type::String
                name: 'tpuTfVersion'
                description: |
                  The AI Platform runtime version that includes a TensorFlow version matching the one used in the 
                  custom container. This field is required if the replica is a TPU worker that uses a custom container. 
                  Otherwise, do not specify this field.
          - !ruby/object:Api::Type::String
            name: 'workerType'
            description: Specifies the type of virtual machine to use for your training job's worker nodes.
            required: false
          - !ruby/object:Api::Type::NestedObject
            name: 'workerConfig'
            description: The configuration for workers.
            required: false
            properties:
              - !ruby/object:Api::Type::NestedObject
                name: 'acceleratorConfig'
                description: Represents the type and number of accelerators used by the replica
                properties:
                - !ruby/object:Api::Type::Integer
                  name: 'count'
                  description: The number of accelerators to attach to each machine running the job.
                - !ruby/object:Api::Type::Enum
                  name: 'type'
                  description: The type of accelerator to use.
                  values:
                    - ACCELERATOR_TYPE_UNSPECIFIED
                    - NVIDIA_TESLA_K80	
                    - NVIDIA_TESLA_P100
                    - NVIDIA_TESLA_V100
                    - NVIDIA_TESLA_P4
                    - NVIDIA_TESLA_T4
                    - TPU_V2
                    - TPU_V3 
              - !ruby/object:Api::Type::String
                name: 'imageUri'
                description: The Docker image to run on the replica. This image must be in Container Registry.
              - !ruby/object:Api::Type::String
                name: 'tpuTfVersion'
                description: |
                  The AI Platform runtime version that includes a TensorFlow version matching the one used in the 
                  custom container. This field is required if the replica is a TPU worker that uses a custom container. 
                  Otherwise, do not specify this field.
          - !ruby/object:Api::Type::String
            name: 'parameterServerType'
            description: The configuration for parameter servers
            required: false
          - !ruby/object:Api::Type::NestedObject
            name: 'parameterServerConfig'
            description:  The configuration for parameter servers.
            required: false  
            properties:
              - !ruby/object:Api::Type::NestedObject
                name: 'acceleratorConfig'
                description: Represents the type and number of accelerators used by the replica
                properties:
                  - !ruby/object:Api::Type::Integer
                    name: 'count'
                    description: The number of accelerators to attach to each machine running the job.
                  - !ruby/object:Api::Type::Enum
                    name: 'type'
                    description: The type of accelerator to use.
                    values:
                      - ACCELERATOR_TYPE_UNSPECIFIED
                      - NVIDIA_TESLA_K80	
                      - NVIDIA_TESLA_P100
                      - NVIDIA_TESLA_V100
                      - NVIDIA_TESLA_P4
                      - NVIDIA_TESLA_T4
                      - TPU_V2
                      - TPU_V3 
              - !ruby/object:Api::Type::String
                name: 'imageUri'
                description: The Docker image to run on the replica. This image must be in Container Registry.
              - !ruby/object:Api::Type::String
                name: 'tpuTfVersion'
                description: |
                  The AI Platform runtime version that includes a TensorFlow version matching the one used in the 
                  custom container. This field is required if the replica is a TPU worker that uses a custom container. 
                  Otherwise, do not specify this field.
          - !ruby/object:Api::Type::Integer
            name: 'workerCount'
            description: | 
              The number of worker replicas to use for the training job. Each replica in the cluster will be of the type 
              specified in workerType
            required: false
          - !ruby/object:Api::Type::Integer
            name: 'parameterServerCount'
            description: | 
              The number of parameter server replicas to use for the training job. Each replica in the cluster will be 
              of the type specified in parameterServerType.
            required: false
          - !ruby/object:Api::Type::Array
            name: 'packageUris'
            description: |
              The Google Cloud Storage location of the packages with the training program and any additional dependencies.
               The maximum number of package URIs is 100.
            required: true
            item_type: Api::Type::String
          - !ruby/object:Api::Type::String
            name: 'pythonModule'
            description: The Python module name to run after installing the packages.
            required: true
          - !ruby/object:Api::Type::Array
            name: 'args'
            description: Command line arguments to pass to the program.
            required: false
            item_type: Api::Type::String
          - !ruby/object:Api::Type::String
            name: 'region'
            description: The Google Compute Engine region to run the training job in. See the available regions for AI Platform services.
            required: true 
          - !ruby/object:Api::Type::String
            name: 'jobDir'
            description: |
               A Google Cloud Storage path in which to store training outputs and other data needed for training. This path is passed 
               to your TensorFlow program as the '--job-dir' command-line argument. The benefit of specifying this field is that Cloud 
               ML validates the path for use in training.
            required: false 
          - !ruby/object:Api::Type::String
            name: 'runtimeVersion'
            description: | 
              The AI Platform runtime version to use for training. If not set, AI Platform uses the default stable version, 1.0. For more 
              information, see the runtime version list and how to manage runtime versions.
            required: false 
          - !ruby/object:Api::Type::String
            name: 'pythonVersion'
            description: |
              The version of Python used in training. If not set, the default version is '2.7'. Python '3.5' is available when 
              runtimeVersion is set to '1.4' and above. Python '2.7' works with all supported runtime versions.
            required: false 
      ## Training output start here      
      - !ruby/object:Api::Type::NestedObject
        name: 'trainingOutput'
        description: The current training job result.
        output: true
        properties:
          - !ruby/object:Api::Type::String
            name: 'completedTrialCount'
            description: The number of hyperparameter tuning trials that completed successfully. Only set for hyperparameter tuning jobs.
          - !ruby/object:Api::Type::NestedObject
            name: 'trials'
            description: Results for individual Hyperparameter trials. Only set for hyperparameter tuning jobs.
            properties:
              - !ruby/object:Api::Type::String
                name: 'trialId'
                description: The trial id for these results.
              - !ruby/object:Api::Type::KeyValuePairs
                name: 'hyperparameters'
                description: |
                  The hyperparameters given to this trial. An object containing a list of "key": value pairs. 
                  Example: { "name": "wrench", "mass": "1.3kg", "count": "3" }
              - !ruby/object:Api::Type::Time
                name: 'startTime'
                description: Start time for the trial.
                output: true
              - !ruby/object:Api::Type::Time
                name: 'endTime'
                description:  End time for the trial.
                output: true              
              - !ruby/object:Api::Type::Enum
                name: 'state'
                description: The detailed state of a job.
                values:
                  - STATE_UNSPECIFIED
                  - QUEUED
                  - PREPARING
                  - RUNNING
                  - SUCCEEDED
                  - FAILED
                  - CANCELLING
                  - CANCELLED
                output: true
              - !ruby/object:Api::Type::NestedObject
                name: 'finalMetric'
                description:  The final objective metric seen for this trial.
                properties:
                  - !ruby/object:Api::Type::String
                    name: 'trainingStep'
                    description:  The global training step for this metric
                  - !ruby/object:Api::Type::Integer
                    name: 'objectiveValue'
                    description:  The objective value at this training step.
              - !ruby/object:Api::Type::Boolean
                name: 'isTrialStoppedEarly'
                description:  True if the trial is stopped early.
              - !ruby/object:Api::Type::NestedObject
                name: 'allMetrics'
                description:  All recorded object metrics for this trial. This field is not currently populated.
                properties:
                  - !ruby/object:Api::Type::String
                    name: 'trainingStep'
                    description:  The global training step for this metric
                  - !ruby/object:Api::Type::Integer
                    name: 'objectiveValue'
                    description:  The objective value at this training step.
              - !ruby/object:Api::Type::NestedObject
                name: 'builtInAlgorithmOutput'
                description:  Details related to built-in algorithms jobs. Only set for trials of built-in algorithms jobs that have succeeded.
                properties:
                  - !ruby/object:Api::Type::String
                    name: 'framework'
                    description:  Framework on which the built-in algorithm was trained.
                  - !ruby/object:Api::Type::Integer
                    name: 'runtimeVersion'
                    description:  AI Platform runtime version on which the built-in algorithm was trained         
                  - !ruby/object:Api::Type::Integer
                    name: 'pythonVersion'
                    description:  Python version on which the built-in algorithm was trained.          
                  - !ruby/object:Api::Type::Integer
                    name: 'modelPath'
                    description:  |
                      The Cloud Storage path to the model/ directory where the training job saves the trained model. 
                      Only set for successful jobs that don't use hyperparameter tuning          
          - !ruby/object:Api::Type::Integer
            name: 'consumedMLUnits'
            description: The amount of ML units consumed by the job.
          - !ruby/object:Api::Type::Boolean
            name: 'isHyperparameterTuningJob'
            description: Whether this job is a hyperparameter tuning job.
          - !ruby/object:Api::Type::String
            name: 'isBuiltInAlgorithmJob'
            description: Whether this job is a built-in Algorithm job.
          - !ruby/object:Api::Type::NestedObject
            name: 'builtInAlgorithmOutput'
            description: Details related to built-in algorithms jobs. Only set for built-in algorithms jobs.
            properties:
              - !ruby/object:Api::Type::String
                name: 'framework'
                description:  Framework on which the built-in algorithm was trained.
              - !ruby/object:Api::Type::Integer
                name: 'runtimeVersion'
                description:  AI Platform runtime version on which the built-in algorithm was trained         
              - !ruby/object:Api::Type::Integer
                name: 'pythonVersion'
                description:  Python version on which the built-in algorithm was trained.          
              - !ruby/object:Api::Type::Integer
                name: 'modelPath'
                description:  |
                  The Cloud Storage path to the model/ directory where the training job saves the trained model. 
                  Only set for successful jobs that don't use hyperparameter tuning    
          - !ruby/object:Api::Type::String
            name: 'hyperparameterMetricTag'
            description: The TensorFlow summary tag name used for optimizing hyperparameter tuning trials.