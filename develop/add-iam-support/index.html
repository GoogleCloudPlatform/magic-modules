<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Add IAM support
  #

This page covers how to add IAM resources in Terraform if they are supported by a particular API resource (indicated by
setIamPolicy and getIamPolicy methods in the API documentation for the resource).
For more information about types of resources and the generation process overall, see How Magic Modules works.

  Before you begin
  #


Complete the steps in Set up your development environment to set up your environment and your Google Cloud project.
Ensure that your magic-modules, terraform-provider-google, and terraform-provider-google-beta repositories are up to date.
cd ~/magic-modules
git checkout main && git clean -f . && git checkout -- . && git pull
cd $GOPATH/src/github.com/hashicorp/terraform-provider-google
git checkout main && git clean -f . && git checkout -- . && git pull
cd $GOPATH/src/github.com/hashicorp/terraform-provider-google-beta
git checkout main && git clean -f . && git checkout -- . && git pull



  Add IAM support
  #






  MMv1
  IAM support for MMv1-generated resources is configured within the ResourceName.yaml file, and will create the google_product_resource_iam_policy, google_product_resource_iam_binding, google_product_resource_iam_member resource, website, and test files for that resource target when an iam_policy block is present."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/develop/add-iam-support/"><meta property="og:site_name" content="Magic Modules"><meta property="og:title" content="Add IAM support"><meta property="og:description" content="Add IAM support # This page covers how to add IAM resources in Terraform if they are supported by a particular API resource (indicated by setIamPolicy and getIamPolicy methods in the API documentation for the resource).
For more information about types of resources and the generation process overall, see How Magic Modules works.
Before you begin # Complete the steps in Set up your development environment to set up your environment and your Google Cloud project. Ensure that your magic-modules, terraform-provider-google, and terraform-provider-google-beta repositories are up to date. cd ~/magic-modules git checkout main && git clean -f . && git checkout -- . && git pull cd $GOPATH/src/github.com/hashicorp/terraform-provider-google git checkout main && git clean -f . && git checkout -- . && git pull cd $GOPATH/src/github.com/hashicorp/terraform-provider-google-beta git checkout main && git clean -f . && git checkout -- . && git pull Add IAM support # MMv1 IAM support for MMv1-generated resources is configured within the ResourceName.yaml file, and will create the google_product_resource_iam_policy, google_product_resource_iam_binding, google_product_resource_iam_member resource, website, and test files for that resource target when an iam_policy block is present."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="develop"><meta property="article:modified_time" content="2024-12-16T14:01:21-05:00"><title>Add IAM support | Magic Modules</title>
<link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png><link rel=canonical href=https://googlecloudplatform.github.io/magic-modules/develop/add-iam-support/><link rel=stylesheet href=/magic-modules/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/magic-modules/fuse.min.js></script><script defer src=/magic-modules/en.search.min.915ba9df3e382d416ae5e08ed09b538253c2552b7cb3e8ab3a905f88656f70a6.js integrity="sha256-kVup3z44LUFq5eCO0JtTglPCVSt8s+irOpBfiGVvcKY=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/magic-modules/>Overview</a></li></ul><ul><li><a href=/magic-modules/contribution-process/>Contribution process</a></li><li><span>Develop</span><ul><li><a href=/magic-modules/develop/set-up-dev-environment/>Set up your development environment</a></li><li><a href=/magic-modules/develop/add-resource/>Add a resource</a></li><li><a href=/magic-modules/develop/add-fields/>Add a field to an existing resource</a></li><li><a href=/magic-modules/develop/add-iam-support/ class=active>Add IAM support</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/update-dependencies/>Update dependencies</a></li><li><a href=/magic-modules/develop/diffs/>Fix diffs</a></li><li><a href=/magic-modules/develop/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/develop/client-side-fields/>Client-side fields</a></li></ul></li><li><span>Test</span><ul><li><a href=/magic-modules/test/test/>Add resource tests</a></li><li><a href=/magic-modules/test/run-tests/>Run tests</a></li></ul></li><li><span>Document</span><ul><li><a href=/magic-modules/document/add-documentation/>Add documentation</a></li><li><a href=/magic-modules/document/handwritten-docs-style-guide/>Handwritten docs style guide</a></li></ul></li><li><span>Breaking changes</span><ul><li><a href=/magic-modules/breaking-changes/breaking-changes/>Types of breaking changes</a></li><li><a href=/magic-modules/breaking-changes/make-a-breaking-change/>Make a breaking change</a></li></ul></li><li><span>Code review</span><ul><li><a href=/magic-modules/code-review/create-pr/>Create a pull request</a></li><li><a href=/magic-modules/code-review/release-notes/>Write release notes</a></li><li><a href=/magic-modules/code-review/review-pr/>Review a pull request</a></li></ul></li><li><span>Best practices</span><ul><li><a href=/magic-modules/best-practices/immutable-fields/>Immutable fields</a></li><li><a href=/magic-modules/best-practices/deletion-behaviors/>Deletion behaviors</a></li><li><a href=/magic-modules/best-practices/labels-and-annotations/>Labels and annotations</a></li><li><a href=/magic-modules/best-practices/common-resource-patterns/>Common resource patterns</a></li></ul></li><li><span>Reference</span><ul><li><a href=/magic-modules/reference/resource/>MMv1 resource reference</a></li><li><a href=/magic-modules/reference/field/>MMv1 field reference</a></li><li><a href=/magic-modules/reference/make-commands/>make commands</a></li><li><a href=/magic-modules/reference/metadata/>MMv1 metadata reference</a></li><li><a href=/magic-modules/reference/ruby-go-changes/>Ruby to Go Migration</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Add IAM support</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a></li><li><a href=#add-iam-support-1>Add IAM support</a></li><li><a href=#add-documentation>Add documentation</a></li><li><a href=#whats-next>What&rsquo;s next?</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=add-iam-support>Add IAM support
<a class=anchor href=#add-iam-support>#</a></h1><p>This page covers how to add IAM resources in Terraform if they are supported by a particular API resource (indicated by
<code>setIamPolicy</code> and <code>getIamPolicy</code> methods in the API documentation for the resource).</p><p>For more information about types of resources and the generation process overall, see <a href=https://googlecloudplatform.github.io/magic-modules/>How Magic Modules works</a>.</p><h2 id=before-you-begin>Before you begin
<a class=anchor href=#before-you-begin>#</a></h2><ol><li>Complete the steps in <a href=https://googlecloudplatform.github.io/magic-modules/develop/set-up-dev-environment/>Set up your development environment</a> to set up your environment and your Google Cloud project.</li><li>Ensure that your <code>magic-modules</code>, <code>terraform-provider-google</code>, and <code>terraform-provider-google-beta</code> repositories are up to date.<pre tabindex=0><code>cd ~/magic-modules
git checkout main &amp;&amp; git clean -f . &amp;&amp; git checkout -- . &amp;&amp; git pull
cd $GOPATH/src/github.com/hashicorp/terraform-provider-google
git checkout main &amp;&amp; git clean -f . &amp;&amp; git checkout -- . &amp;&amp; git pull
cd $GOPATH/src/github.com/hashicorp/terraform-provider-google-beta
git checkout main &amp;&amp; git clean -f . &amp;&amp; git checkout -- . &amp;&amp; git pull
</code></pre></li></ol><h2 id=add-iam-support-1>Add IAM support
<a class=anchor href=#add-iam-support-1>#</a></h2><div class=book-tabs><input type=radio class=toggle name=tabs-IAM id=tabs-IAM-0 checked>
<label for=tabs-IAM-0>MMv1</label><div class="book-tabs-content markdown-inner"><p>IAM support for MMv1-generated resources is configured within the <code>ResourceName.yaml</code> file, and will create the <code>google_product_resource_iam_policy</code>, <code>google_product_resource_iam_binding</code>, <code>google_product_resource_iam_member</code> resource, website, and test files for that resource target when an <code>iam_policy</code> block is present.</p><ol><li>Add the following top-level block to <code>ResourceName.yaml</code> directly above <code>parameters</code>.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>iam_policy</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># Name of the field on the terraform IAM resources which references</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># the parent resource. Update to match the parent resource&#39;s name.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>parent_resource_attribute</span>: <span style=color:#e6db74>&#39;resource_name&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Character preceding setIamPolicy in the full URL for the API method.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Usually `:`</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>method_name_separator</span>: <span style=color:#e6db74>&#39;:&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># HTTP method for getIamPolicy. Usually &#39;POST&#39;.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>fetch_iam_policy_verb</span>: <span style=color:#e6db74>&#39;POST&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Overrides the HTTP method for setIamPolicy. Default: &#39;POST&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># set_iam_policy_verb: &#39;POST&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Must match the parent resource&#39;s `import_format` (or `self_link` if</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># `import_format` is unset), but with the `parent_resource_attribute`</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># value substituted for the final field.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>import_format</span>:
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#39;projects/{{project}}/locations/{{location}}/resourcenames/{{resource_name}}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># If IAM conditions are supported, set this attribute to indicate how the</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># conditions should be passed to the API. Allowed values: &#39;QUERY_PARAM&#39;,</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># &#39;REQUEST_BODY&#39;, &#39;QUERY_PARAM_NESTED&#39;. Note: &#39;QUERY_PARAM_NESTED&#39; should</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># only be used if the query param field contains a `.`</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># iam_conditions_request_type: &#39;REQUEST_BODY&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Marks IAM support as beta-only</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># min_version: beta</span>
</span></span></code></pre></div><ol start=2><li>Modify the template as needed to match the API resource&rsquo;s documented behavior. These are the most commonly-used fields. For a comprehensive reference, see <a href=https://googlecloudplatform.github.io/magic-modules/reference/resource/#iam_policy>MMv1 resource reference: <code>iam_policy</code> ↗</a>.</li><li>Delete all remaining comments in the IAM configuration (including attribute descriptions) that were copied from the above template.</li></ol></div><input type=radio class=toggle name=tabs-IAM id=tabs-IAM-1>
<label for=tabs-IAM-1>Handwritten</label><div class="book-tabs-content markdown-inner"><blockquote><p><strong>Warning:</strong> IAM support for handwritten resources should be implemented using MMv1. New handwritten IAM resources will only be accepted if they cannot be implemented using MMv1.</p></blockquote><h3 id=add-support-in-mmv1>Add support in MMv1
<a class=anchor href=#add-support-in-mmv1>#</a></h3><ol><li>Follow the MMv1 directions in <a href=https://googlecloudplatform.github.io/magic-modules/develop/add-resource/>Add a resource</a> to create a skeleton ResourceName.yaml file for the handwritten resource, but set only the following top-level fields:<ul><li><code>name</code></li><li><code>description</code> (required but unused)</li><li><code>base_url</code> (set to URL of IAM parent resource)</li><li><code>self_link</code> (set to same value as <code>base_url</code>)</li><li><code>id_format</code> (set to same value as <code>base_url</code>)</li><li><code>import_format</code> (including <code>base_url</code> value)</li><li><code>exclude_resource</code> (set to <code>true</code>)</li><li><code>properties</code></li></ul></li><li>Follow the MMv1 directions in <a href=#add-fields>Add fields</a> to add only the fields used by base_url.</li><li>Follow the MMv1 directions in this section to add IAM support.</li></ol><h3 id=convert-to-handwritten-not-usually-necessary>Convert to handwritten (not usually necessary)
<a class=anchor href=#convert-to-handwritten-not-usually-necessary>#</a></h3><ol><li><a href=https://googlecloudplatform.github.io/magic-modules/develop/generate-providers/>Generate the beta provider</a></li><li>From the beta provider, copy the files generated for the IAM resources to the following locations:<ul><li>Resource: Copy to the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a></li><li>Documentation: <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/website/docs/r><code>magic-modules/mmv1/third_party/terraform/website/docs/r</code></a></li><li>Tests: In the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a></li></ul></li><li>Modify the Go code as needed.<ul><li>Replace all occurrences of <code>github.com/hashicorp/terraform-provider-google-beta/google-beta</code> with <code>github.com/hashicorp/terraform-provider-google/google</code></li><li>Remove the comments at the top of the file.</li><li>If any of the added Go code is beta-only:<ul><li>Change the file suffix to <code>.go.tmpl</code></li><li>Wrap each beta-only code block (including any imports) in a separate version guard: <code>{{- if ne $.TargetVersionName "ga" -}}...{{- else }}...{{- end }}</code></li></ul></li></ul></li><li>Register the binding, member, and policy resources <code>handwrittenIAMResources</code> in <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/third_party/terraform/provider/provider_mmv1_resources.go.tmpl><code>magic-modules/mmv1/third_party/terraform/provider/provider_mmv1_resources.go.tmpl</code></a><ul><li>Add a version guard for any beta-only resources.</li></ul></li></ol></div></div><h2 id=add-documentation>Add documentation
<a class=anchor href=#add-documentation>#</a></h2><div class=book-tabs><input type=radio class=toggle name=tabs-docs id=tabs-docs-0 checked>
<label for=tabs-docs-0>MMv1</label><div class="book-tabs-content markdown-inner"><p>Documentation is autogenerated based on the resource and field configurations. To preview the documentation:</p><ol><li><a href=https://googlecloudplatform.github.io/magic-modules/develop/generate-providers/>Generate the providers</a></li><li>Copy and paste the generated documentation into the Hashicorp Registry&rsquo;s <a href=https://registry.terraform.io/tools/doc-preview>Doc Preview Tool</a> to see how it is rendered.</li></ol></div><input type=radio class=toggle name=tabs-docs id=tabs-docs-1>
<label for=tabs-docs-1>Handwritten</label><div class="book-tabs-content markdown-inner"><h3 id=add-or-modify-documentation-files>Add or modify documentation files
<a class=anchor href=#add-or-modify-documentation-files>#</a></h3><ol><li>Open the resource documentation in <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/website/docs/r><code>magic-modules/third_party/terraform/website/docs/r/</code></a> using an editor of your choice.<ul><li>The name of the file is the name of the resource without a <code>google_</code> prefix. For example, for <code>google_compute_instance</code>, the file is called <code>compute_instance.html.markdown</code></li></ul></li><li>Modify the documentation as needed according to <a href=https://googlecloudplatform.github.io/magic-modules/document/handwritten-docs-style-guide/>Handwritten documentation style guide</a>.</li><li><a href=https://googlecloudplatform.github.io/magic-modules/develop/generate-providers/>Generate the providers</a></li><li>Copy and paste the generated documentation into the Hashicorp Registry&rsquo;s <a href=https://registry.terraform.io/tools/doc-preview>Doc Preview Tool</a> to see how it is rendered.</li></ol></div></div><h2 id=whats-next>What&rsquo;s next?
<a class=anchor href=#whats-next>#</a></h2><ul><li><a href=https://googlecloudplatform.github.io/magic-modules/document/add-documentation/>Add documentation</a></li><li><a href=https://googlecloudplatform.github.io/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=https://googlecloudplatform.github.io/magic-modules/test/test/>Add tests</a></li><li><a href=https://googlecloudplatform.github.io/magic-modules/test/run-tests/>Run tests</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/369c73a05c4f5b810dd9eae1b30b8371a78ab7cd title='Last modified by nityaravi | December 16, 2024' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 16, 2024</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/develop%2fadd-iam-support.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/develop/add-iam-support.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a></li><li><a href=#add-iam-support-1>Add IAM support</a></li><li><a href=#add-documentation>Add documentation</a></li><li><a href=#whats-next>What&rsquo;s next?</a></li></ul></nav></div></aside></main></body></html>