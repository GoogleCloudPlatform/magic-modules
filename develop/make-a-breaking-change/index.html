<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guidance on making a breaking change during a major release"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Make a breaking change"><meta property="og:description" content="Guidance on making a breaking change during a major release"><meta property="og:type" content="article"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/develop/make-a-breaking-change/"><meta property="article:section" content="develop"><meta property="article:modified_time" content="2023-08-09T17:25:31-05:00"><title>Make a breaking change | Magic Modules</title><link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png type=image/x-icon><link rel=stylesheet href=/magic-modules/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/magic-modules/flexsearch.min.js></script>
<script defer src=/magic-modules/en.search.min.aa8a69f8a84c7180a2a2a347dc8b6c7449efa26be8f6419076bec65f9dcc8514.js integrity="sha256-qopp+KhMcYCioqNH3ItsdEnvomvo9kGQdr7GX53MhRQ=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/magic-modules/>Overview</a></li></ul><ul><li><span>Get started</span><ul><li><a href=/magic-modules/get-started/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/get-started/how-magic-modules-works/>How Magic Modules works</a></li><li><a href=/magic-modules/get-started/contribution-process/>Contribution process</a></li><li><a href=/magic-modules/get-started/provider-documentation/>Provider documentation</a></li></ul></li><li><span>Develop</span><ul><li><a href=/magic-modules/develop/resource/>Add or modify a resource</a></li><li><a href=/magic-modules/develop/test/>Add resource tests</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource-documentation/>Add datasource documentation</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/run-tests/>Run tests</a></li><li><a href=/magic-modules/develop/make-a-breaking-change/ class=active>Make a breaking change</a></li></ul></li><li><a href=/magic-modules/best-practices/>Best practices</a><ul></ul></li><li><span>Contribute</span><ul><li><a href=/magic-modules/contribute/release-notes/>Write release notes</a></li><li><a href=/magic-modules/contribute/review-pr/>Review a PR</a></li></ul></li><li><span>Reference</span><ul><li><a href=/magic-modules/reference/make-commands/>make commands</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource.rb target=_blank rel=noopener>Resource YAML reference ↗</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/type.rb target=_blank rel=noopener>Field YAML reference ↗</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource/iam_policy.rb target=_blank rel=noopener>IAM policy YAML reference ↗</a></li><li><a href=/magic-modules/reference/breaking-change-detector/>Breaking change detector</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Make a breaking change</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#when-to-or-not-to-make-a-breaking-change>When to (or not to) make a breaking change</a></li><li><a href=#what-counts-as-a-breaking-change>What counts as a breaking change?</a></li><li><a href=#making-a-breaking-change>Making a breaking change</a><ul><li><a href=#contributing-to-the-next-major-release-500>Contributing to the next major release (<code>5.0.0</code>)</a></li><li><a href=#renaming-a-field>Renaming a field</a></li><li><a href=#removing-a-field>Removing a field</a></li><li><a href=#marking-optional-fields-required>Marking optional fields required</a></li><li><a href=#changing-default-values>Changing default values</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside></header><article class=markdown><h1 id=how-to-make-a-breaking-change>How to make a breaking change
<a class=anchor href=#how-to-make-a-breaking-change>#</a></h1><blockquote class="book-hint info"><strong>Note:</strong> This page covers the general requirements to make a breaking change
and may not include exact, comprehensive details on making your change. Breaking
changes are generally complicated and resource or field specific traits can
drastically change how they need to be made.</blockquote><h2 id=when-to-or-not-to-make-a-breaking-change>When to (or not to) make a breaking change
<a class=anchor href=#when-to-or-not-to-make-a-breaking-change>#</a></h2><p>Within the Terraform ecosystem, there&rsquo;s a strong expectation of stability
<strong>including across major versions</strong>. Ecosystem-wide, the community has had
deeply negative reactions to provider changes with overly-broad impact, and
too-large changes can delay customers upgrading to adopt new major versions.</p><p>In general, we recommend avoiding breaking changes where possible. The
provider&rsquo;s schema is an API surface relied on by many GCP customers, and users
have responded negatively to instability in our surface and those of other
providers.</p><p>While the cost to make a change in the provider is relatively cheap, it has
knock-on effects through the whole ecosystem:</p><ul><li>Modules need to update to adapt to the breaking changes</li><li>Customers need to update their provider version (and module versions)</li><li>Terraform assistive tools like <a href=https://cloud.google.com/docs/terraform/policy-validation/quickstart><code>gcloud terraform vet</code></a>
and 3P tools with provider dependencies like
<a href=https://cloud.google.com/config-connector/docs/overview>Config Connector</a>
and <a href=https://www.pulumi.com/registry/packages/gcp/>Pulumi GCP Classic</a> need
to be updated</li></ul><p>When breaking changes are made, they must be made within a major release
(typically yearly) and meet the stringent ecosystem requirements for a breaking
change, detailed below.</p><h2 id=what-counts-as-a-breaking-change>What counts as a breaking change?
<a class=anchor href=#what-counts-as-a-breaking-change>#</a></h2><p>While the general versioning model for providers is captured
in <a href=https://developer.hashicorp.com/terraform/plugin/best-practices/versioning>https://developer.hashicorp.com/terraform/plugin/best-practices/versioning</a>,
that documentation serves as a baseline for new provider development and not
guidelines for mature providers like the major cloud providers.</p><p>The standard our joint Google & HashiCorp team has developed is that any change
that requires an end user to modify any previously-valid configuration after a
provider upgrade is a breaking change, and must happen in a major release. In
this context &ldquo;valid&rdquo; means that a configuration is syntactically correct
(passes <code>terraform validate</code>) and runs in <code>terraform apply</code> without returning an
error. This means that minor corrections are possible such as marking immutable
fields as immutable if they previously weren&rsquo;t.</p><p>There is a single exception to this rule- if a user has managed a resource
out-of-band from Terraform to enable a new field with a non-default value,
adding support for the field without handling that case is permissible.
Terraform will generate a plan that reconciles their state with their live
configuration.</p><p>For example, the following are (a non-exhaustive list of) breaking changes:</p><ul><li>Changing the output format of a field (i.e. from an integer to a string, or
the pattern of a structured value)</li><li>Adding a new required field or changing an existing non-required field to
required</li><li>Removing a field</li><li>Major behaviour changes to a resource (if configurable, if they are done by
default)</li></ul><p>Meanwhile, the following are allowed in a minor version:</p><ul><li>Adding a new field</li><li>Adding update support for a field</li><li>Removing update support from a field that returned an error in <strong>all cases</strong> a
user attempted to update it</li><li>Marking a field required if <strong>all configurations</strong> that did not specify the
field returned an error</li><li>Major behavioural changes guarded by a flag where the <strong>previous</strong> behaviour
is the default</li></ul><h2 id=making-a-breaking-change>Making a breaking change
<a class=anchor href=#making-a-breaking-change>#</a></h2><blockquote class="book-hint info"><strong>Note:</strong> This section of the document refers to several release versions of the
provider at once. Breaking changes are made in major releases such as 1.0.0,
4.0.0, or 5.0.0 (referred to as the &ldquo;major release&rdquo; or <code>N</code> here) while typical
provider releases are minor versions, most notably the last minor release of the
previous major release series such as <code>2.20.3</code> for <code>3.0.0</code> or <code>3.90.1</code>
for <code>4.0.0</code> (referred to as the &ldquo;last minor release&rdquo; or <code>N-1.X</code> here).</blockquote><p>The Terraform provider ecosystem follows the standard that deprecations or
warnings must be resolvable by end users in the last minor release of the prior
release series before their removal or change in a major release. Additionally,
deprecation warnings must be actionable- at the time a deprecation is posted, a
user must be able to remove the field.</p><h3 id=contributing-to-the-next-major-release-500>Contributing to the next major release (<code>5.0.0</code>)
<a class=anchor href=#contributing-to-the-next-major-release-500>#</a></h3><p>For the <code>5.0.0</code> major release, the major release branch that you&rsquo;ll contribute your code changes to is <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/FEATURE-BRANCH-major-release-5.0.0><code>FEATURE-BRANCH-major-release-5.0.0</code></a>.
All breaking changes targeting <code>5.0.0</code> must be committed to this branch. <a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/version_5_upgrade>Upgrade guide entries</a> are required to be made to the <code>main</code> branch in a separate pull request.</p><p>A downstream branch with the same name <code>FEATURE-BRANCH-major-release-5.0.0</code> will be used to track the generated <code>5.0.0</code> changes in both <a href=https://github.com/hashicorp/terraform-provider-google/tree/FEATURE-BRANCH-major-release-5.0.0><code>google</code></a> and <a href=https://github.com/hashicorp/terraform-provider-google-beta/tree/FEATURE-BRANCH-major-release-5.0.0><code>google-beta</code></a> provider repos.</p><p>The process of contributing to the major release <code>5.0.0</code> follows most of the <a href=https://googlecloudplatform.github.io/magic-modules/get-started/contribution-process/>General contributing steps</a>, with the following exceptions</p><ol><li>Use <code>FEATURE-BRANCH-major-release-5.0.0</code> branch instead of the <code>main</code> branch as the base branch when you<ul><li>checkout your working branch where you make your code changes.</li><li>sync your working branch using <code>git rebase</code> or <code>git merge</code>.</li><li>create a pull request in the magic-modules repo.</li></ul></li><li>Make sure that you checkout to the <code>FEATURE-BRANCH-major-release-5.0.0</code> branch in your downstream <code>google</code> and <code>google-beta</code> repos before generating the providers locally.</li><li>Create a <a href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/mmv1/third_party/terraform/website/docs/guides/version_5_upgrade.html.markdown>separate pull request</a> in the <code>main</code> branch to add an entry to the <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/third_party/terraform/website/docs/guides/version_5_upgrade.html.markdown>upgrade guide</a>.<ul><li>Refer to the 4.0.0 upgrade guide as a reference for your type of change.</li><li>Your reviewer will require this to be made before merging your code changes in the <code>FEATURE-BRANCH-major-release-5.0.0</code> branch.</li></ul></li><li>If your change is a follow-up to a recent code change commit to <code>main</code> that is not yet contained in the released branch, it is strongly encouraged to wait until the branch sync and resolve any merge conflicts in the PR.
For example, if you are removing a field that has been recently deprecated in main.</li></ol><p>The release branch is synced with main on a weekly basis every Monday.</p><h3 id=renaming-a-field>Renaming a field
<a class=anchor href=#renaming-a-field>#</a></h3><p>The most common type of breaking change is a field rename, and most guidance is
tuned around that. To perform one, a provider contributor must:</p><ol><li>Add support for the new field on or before the last minor release of the
preceding release series (i.e. version <code>N-1.X.0</code>) by contributing to
the <code>main</code> branch in the magic-modules repo</li><li>Mark the old field deprecated on or before the last minor release of the
preceding release series (i.e. version <code>N-1.X.0</code>) by contributing to
the <code>main</code> branch in the magic-modules repo</li><li>Write an upgrade guide entry in the major release&rsquo;s upgrade guide (such
as <a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/version_5_upgrade>this one</a>
for <code>5.0.0</code>) by contributing to the <code>main</code> branch in the magic-modules repo</li><li>Remove the old field from the major release (i.e. version <code>N</code>) in the major
release branch in the magic-modules repo</li></ol><p>For example, if <code>google_foobar</code> has a field <code>baz</code> in version <code>3.80.0</code> that is
being replaced by <code>qux</code> in <code>4.0.0</code>, <code>qux</code> must be added on or before <code>3.90.1</code>,
and <code>baz</code> must be deprecated within the same window (either at the same time
as <code>qux</code> is added, or afterwards (if added earlier than <code>3.90.1</code>), but not
before).</p><p>Example (<code>google_storage_bucket.bucket_policy_only</code> -> <code>google_storage_bucket.uniform_bucket_level_access</code>)</p><ul><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/3916>https://github.com/GoogleCloudPlatform/magic-modules/pull/3916</a> introduced the new field and deprecated the original one in <code>3.38.0</code></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/5340>https://github.com/GoogleCloudPlatform/magic-modules/pull/5340</a> added the upgrade guide entry and removed the field in <code>4.0.0</code></li><li>Note: In 4.0.0 the upgrade guide was split between main and the major release branch. Going forward, those changes will be made against main exclusively.</li></ul><h3 id=removing-a-field>Removing a field
<a class=anchor href=#removing-a-field>#</a></h3><p>Removing a field is similar to renaming one, except that a new field doesn&rsquo;t
need to be introduced:</p><ol><li>Mark the field deprecated on or before the last minor release of the
preceding release series (i.e. version <code>N-1.X.0</code>) by contributing to
the <code>main</code> branch in the magic-modules repo</li><li>Write an upgrade guide entry in the major release&rsquo;s upgrade guide (such
as <a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/version_5_upgrade>this one</a>
for <code>5.0.0</code>) by contributing to the <code>main</code> branch in the magic-modules repo</li><li>Remove the field from the major release (i.e. version <code>N</code>) in the major
release branch in the magic-modules repo</li></ol><p>Example (<code>google_container_cluster.instance_group_urls</code>)</p><ul><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/5261>https://github.com/GoogleCloudPlatform/magic-modules/pull/5261</a> deprecated <code>instance_group_urls</code> and filled out the upgrade guide</li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/5378>https://github.com/GoogleCloudPlatform/magic-modules/pull/5378</a> removed the field</li></ul><h3 id=marking-optional-fields-required>Marking optional fields required
<a class=anchor href=#marking-optional-fields-required>#</a></h3><p>There is no way to message a change to users in advance at the moment, other
than through the upgrade guide.</p><ol><li>Write an upgrade guide entry in the major release&rsquo;s upgrade guide (such
as <a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/version_5_upgrade>this one</a>
for <code>5.0.0</code>) by contributing to the <code>main</code> branch in the magic-modules repo</li><li>Mark the field as required in the major release (i.e. version <code>N</code>) in the major
release branch in the magic-modules repo</li></ol><p>Example (<code>google_app_engine_standard_app_version.entrypoint</code>)</p><ul><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/5318>https://github.com/GoogleCloudPlatform/magic-modules/pull/5318</a> marked the field required and added an upgrade guide entry</li><li>Note: In 4.0.0 the upgrade guide was split between main and the major release branch. Going forward, those changes will be made against main exclusively.</li></ul><h3 id=changing-default-values>Changing default values
<a class=anchor href=#changing-default-values>#</a></h3><p>Default values in Terraform are used to replace null values in configuration at
plan/apply time and <strong>do not</strong> respect previously-configured values by the user.
These changes are often undesirable, as their impact is extremely broad.</p><p>When a default is changed, every user that has not specified an explicit value in their configuration will see Terraform propose changing the value of the field <strong>including</strong> if the change will destroy and recreate the resource due to changing an immutable value. Default changes in the provider are comparable in impact to default changes in an API, and modifying examples and modules may achieve the intended effect with a smaller blast radius.</p><p>There is no way to message a change to users in advance at the moment, other
than through the upgrade guide.</p><ol><li>Write an upgrade guide entry in the major release&rsquo;s upgrade guide (such
as <a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/version_5_upgrade>this one</a>
for <code>5.0.0</code>) by contributing to the <code>main</code> branch in the magic-modules repo</li><li>Mark the new default in the major release (i.e. version <code>N</code>) in the major
release branch in the magic-modules repo</li></ol><p>Example (<code>google_container_cluster.enable_shielded_nodes</code>)</p><ul><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/pull/5263>https://github.com/GoogleCloudPlatform/magic-modules/pull/5263</a> changed the default value for the field and added an upgrade guide entry</li><li>Note: In 4.0.0 the upgrade guide was split between main and the major release branch. Going forward, those changes will be made against main exclusively.</li></ul><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li>Terraform (Provider) Plugin Development<ul><li><a href=https://developer.hashicorp.com/terraform/plugin/best-practices/versioning>Versioning and Changelog</a></li><li><a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/best-practices/deprecations>SDKv2 Deprecations, Removals, and Renames</a></li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/cd25215305e861a47c5515c75120329dd4cdaff7 title='Last modified by Cameron Thornton | August 9, 2023' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 9, 2023</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/develop%2fmake-a-breaking-change.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/develop/make-a-breaking-change.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#when-to-or-not-to-make-a-breaking-change>When to (or not to) make a breaking change</a></li><li><a href=#what-counts-as-a-breaking-change>What counts as a breaking change?</a></li><li><a href=#making-a-breaking-change>Making a breaking change</a><ul><li><a href=#contributing-to-the-next-major-release-500>Contributing to the next major release (<code>5.0.0</code>)</a></li><li><a href=#renaming-a-field>Renaming a field</a></li><li><a href=#removing-a-field>Removing a field</a></li><li><a href=#marking-optional-fields-required>Marking optional fields required</a></li><li><a href=#changing-default-values>Changing default values</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></aside></main></body></html>