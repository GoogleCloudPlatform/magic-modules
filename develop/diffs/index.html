<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Fix diffs
  #

This page outlines best practices for fixing various kinds of diffs that can show up at plan time. These will often show up as test failures with the text: After applying this test step, the plan was not empty.. They can also show up for users at plan time, on fields that a user has not modified in their configuration. If the diff does not go away even after running terraform apply more than once with the same configuration, the diff is called a &ldquo;permadiff&rdquo;."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/develop/diffs/"><meta property="og:site_name" content="Magic Modules"><meta property="og:title" content="Fix diffs"><meta property="og:description" content="Fix diffs # This page outlines best practices for fixing various kinds of diffs that can show up at plan time. These will often show up as test failures with the text: After applying this test step, the plan was not empty.. They can also show up for users at plan time, on fields that a user has not modified in their configuration. If the diff does not go away even after running terraform apply more than once with the same configuration, the diff is called a “permadiff”."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="develop"><meta property="article:modified_time" content="2024-12-16T14:01:21-05:00"><title>Fix diffs | Magic Modules</title>
<link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png><link rel=canonical href=https://googlecloudplatform.github.io/magic-modules/develop/diffs/><link rel=stylesheet href=/magic-modules/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/magic-modules/fuse.min.js></script><script defer src=/magic-modules/en.search.min.bc0d696b442e077fe8fdb10978c511833dbeb07c944cf6a1c2923f1a43d88d28.js integrity="sha256-vA1pa0QuB3/o/bEJeMURgz2+sHyUTPahwpI/GkPYjSg=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/magic-modules/>Overview</a></li></ul><ul><li><a href=/magic-modules/contribution-process/>Contribution process</a></li><li><span>Develop</span><ul><li><a href=/magic-modules/develop/set-up-dev-environment/>Set up your development environment</a></li><li><a href=/magic-modules/develop/add-resource/>Add a resource</a></li><li><a href=/magic-modules/develop/add-fields/>Add a field to an existing resource</a></li><li><a href=/magic-modules/develop/add-iam-support/>Add IAM support</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/update-dependencies/>Update dependencies</a></li><li><a href=/magic-modules/develop/diffs/ class=active>Fix diffs</a></li><li><a href=/magic-modules/develop/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/develop/client-side-fields/>Client-side fields</a></li></ul></li><li><span>Test</span><ul><li><a href=/magic-modules/test/test/>Add resource tests</a></li><li><a href=/magic-modules/test/run-tests/>Run tests</a></li></ul></li><li><span>Document</span><ul><li><a href=/magic-modules/document/add-documentation/>Add documentation</a></li><li><a href=/magic-modules/document/handwritten-docs-style-guide/>Handwritten docs style guide</a></li></ul></li><li><span>Breaking changes</span><ul><li><a href=/magic-modules/breaking-changes/breaking-changes/>Types of breaking changes</a></li><li><a href=/magic-modules/breaking-changes/make-a-breaking-change/>Make a breaking change</a></li></ul></li><li><span>Code review</span><ul><li><a href=/magic-modules/code-review/create-pr/>Create a pull request</a></li><li><a href=/magic-modules/code-review/release-notes/>Write release notes</a></li><li><a href=/magic-modules/code-review/review-pr/>Review a pull request</a></li></ul></li><li><span>Best practices</span><ul><li><a href=/magic-modules/best-practices/immutable-fields/>Immutable fields</a></li><li><a href=/magic-modules/best-practices/deletion-behaviors/>Deletion behaviors</a></li><li><a href=/magic-modules/best-practices/labels-and-annotations/>Labels and annotations</a></li><li><a href=/magic-modules/best-practices/common-resource-patterns/>Common resource patterns</a></li></ul></li><li><span>Reference</span><ul><li><a href=/magic-modules/reference/resource/>MMv1 resource reference</a></li><li><a href=/magic-modules/reference/field/>MMv1 field reference</a></li><li><a href=/magic-modules/reference/make-commands/>make commands</a></li><li><a href=/magic-modules/reference/metadata/>MMv1 metadata reference</a></li><li><a href=/magic-modules/reference/ruby-go-changes/>Ruby to Go Migration</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Fix diffs</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#default>API returns default value for unset field</a></li><li><a href=#default_if_empty>API returns an empty value if default value is sent</a></li><li><a href=#normalized-value>API normalizes a value</a></li><li><a href=#ignore_read>API field that is never included in the response</a></li><li><a href=#list-order>API returns a list in a different order than was sent</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=fix-diffs>Fix diffs
<a class=anchor href=#fix-diffs>#</a></h1><p>This page outlines best practices for fixing various kinds of diffs that can show up at plan time. These will often show up as test failures with the text: <code>After applying this test step, the plan was not empty.</code>. They can also show up for users at plan time, on fields that a user has not modified in their configuration. If the diff does not go away even after running <code>terraform apply</code> more than once with the same configuration, the diff is called a &ldquo;permadiff&rdquo;.</p><p>In a general sense, diffs appear when the API response is detected by Terraform to be different than what is in the user&rsquo;s configuration. This can happen for a number of reasons, including:</p><ul><li>API returns a normalized version of the input</li><li>API returns server-side defaults if the field is unset</li><li>API does not return all the fields set on a resource (for example, secrets)</li></ul><p>The sections below describe in more detail how to address a number of different causes of diffs.</p><h2 id=default>API returns default value for unset field
<a class=anchor href=#default>#</a></h2><p>For new fields, if possible, set a client-side default that matches the API default. This will prevent the diff and will allow users to accurately see what the end state will be if the field is not set in their configuration. A client-side default should only be used if the API sets the same default value in all cases and the default value will be stable over time. Changing a client-side default is a <a href=https://googlecloudplatform.github.io/magic-modules/breaking-changes/breaking-changes/>breaking change</a>.</p><div class=book-tabs><input type=radio class=toggle name=tabs-default_value id=tabs-default_value-0 checked>
<label for=tabs-default_value-0>MMv1</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>default_value</span>: <span style=color:#ae81ff>DEFAULT_VALUE</span>
</span></span></code></pre></div><p>In the providers, this will be converted to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#e6db74>&#34;field&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Default</span>: <span style=color:#e6db74>&#34;DEFAULT_VALUE&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>See <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#default>SDKv2 Schema Behaviors - Default ↗</a> for more information.</p></div><input type=radio class=toggle name=tabs-default_value id=tabs-default_value-1>
<label for=tabs-default_value-1>Handwritten</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#e6db74>&#34;field&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Default</span>: <span style=color:#e6db74>&#34;DEFAULT_VALUE&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>See <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#default>SDKv2 Schema Behaviors - Default ↗</a> for more information.</p></div></div><p>For existing fields (or new fields that are not eligible for a client-side default), mark the field as having an API-side default. If the field is not set (or is set to an &ldquo;empty&rdquo; value such as zero, false, or an empty string) the provider will treat the most recent value returned by the API as the value for the field, and will send that value for the field on subsequent requests. The field will show as <code>(known after apply)</code> in plans and it will not be possible for the user to explicitly set the field to an &ldquo;empty&rdquo; value.</p><div class=book-tabs><input type=radio class=toggle name=tabs-default_from_api id=tabs-default_from_api-0 checked>
<label for=tabs-default_from_api-0>MMv1</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>default_from_api</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>In the providers, this will be converted to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#e6db74>&#34;field&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Optional</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Computed</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>See <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#optional>SDKv2 Schema Behaviors - Optional ↗</a> and <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#computed>SDKv2 Schema Behaviors - Computed ↗</a> for more information.</p></div><input type=radio class=toggle name=tabs-default_from_api id=tabs-default_from_api-1>
<label for=tabs-default_from_api-1>Handwritten</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#e6db74>&#34;field&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Optional</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Computed</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>See <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#optional>SDKv2 Schema Behaviors - Optional ↗</a> and <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#computed>SDKv2 Schema Behaviors - Computed ↗</a> for more information.</p></div></div><h2 id=default_if_empty>API returns an empty value if default value is sent
<a class=anchor href=#default_if_empty>#</a></h2><p>Use a flattener to store the default value in state if the response has an empty (or unset) value.</p><div class=book-tabs><input type=radio class=toggle name=tabs-default_if_empty id=tabs-default_if_empty-0 checked>
<label for=tabs-default_if_empty-0>MMv1</label><div class="book-tabs-content markdown-inner"><p>Use the standard <code>default_if_empty</code> flattener.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>custom_flatten</span>: <span style=color:#e6db74>&#39;templates/terraform/custom_flatten/default_if_empty.tmpl&#39;</span>
</span></span></code></pre></div></div><input type=radio class=toggle name=tabs-default_if_empty id=tabs-default_if_empty-1>
<label for=tabs-default_if_empty-1>Handwritten</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flattenResourceNameFieldName</span>(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>, <span style=color:#a6e22e>config</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>transport_tpg</span>.<span style=color:#a6e22e>Config</span>) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>IsEmptyValue</span>(<span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#a6e22e>v</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;DEFAULT_VALUE&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Any other necessary logic goes here.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><h2 id=normalized-value>API normalizes a value
<a class=anchor href=#normalized-value>#</a></h2><p>In cases where the API normalizes and returns a value in a simple, predictable way (such as capitalizing the value) add a diff suppress function for the field to suppress the diff.</p><p>The <code>tpgresource</code> package in each provider supplies diff suppress functions for the following common cases:</p><ul><li><code>tpgresource.CaseDiffSuppress</code>: Suppress diffs from capitalization differences between the user&rsquo;s configuration and the API.</li><li><code>tpgresource.DurationDiffSuppress</code>: Suppress diffs from duration format differences such as &ldquo;60.0s&rdquo; vs &ldquo;60s&rdquo;. This is necessary for <a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration><code>Duration</code></a> API fields.</li><li><code>tpgresource.ProjectNumberDiffSuppress</code>: Suppress diffs caused by the provider sending a project ID and the API returning a project number.</li></ul><div class=book-tabs><input type=radio class=toggle name=tabs-diff_suppress_simple id=tabs-diff_suppress_simple-0 checked>
<label for=tabs-diff_suppress_simple-0>MMv1</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Use a built-in function</span>
</span></span><span style=display:flex><span><span style=color:#f92672>diff_suppress_func</span>: <span style=color:#e6db74>&#39;tpgresource.CaseDiffSuppress&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reference a resource-specific function</span>
</span></span><span style=display:flex><span><span style=color:#f92672>diff_suppress_func</span>: <span style=color:#e6db74>&#39;resourceNameFieldNameDiffSuppress&#39;</span>
</span></span></code></pre></div><p>Define resource-specific functions in a <a href=https://googlecloudplatform.github.io/magic-modules/develop/custom-code/#add-reusable-variables-and-functions><code>custom_code.constants</code></a> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>resourceNameFieldNameDiffSuppress</span>(<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Separate function for easier unit testing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resourceNameFieldNameDiffSuppressLogic</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>resourceNameFieldNameDiffSuppressLogic</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Diff suppression logic. Returns true if the diff should be suppressed - that is, if the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// old and new values should be considered &#34;the same&#34;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>See <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#diffsuppressfunc>SDKv2 Schema Behaviors - DiffSuppressFunc ↗</a> for more information.</p></div><input type=radio class=toggle name=tabs-diff_suppress_simple id=tabs-diff_suppress_simple-1>
<label for=tabs-diff_suppress_simple-1>Handwritten</label><div class="book-tabs-content markdown-inner"><p>Define resource-specific functions in your service package, for example at the top of the related resource file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>resourceNameFieldNameDiffSuppress</span>(<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Separate function for easier unit testing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resourceNameFieldNameDiffSuppressLogic</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>resourceNameFieldNameDiffSuppressLogic</span>(<span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Diff suppression logic. Returns true if the diff should be suppressed - that is, if the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// old and new values should be considered &#34;the same&#34;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Reference diff suppress functions from the field definition.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#e6db74>&#34;field&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>DiffSuppressFunc</span>: <span style=color:#a6e22e>resourceNameFieldNameDiffSuppress</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>See <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/schemas/schema-behaviors#diffsuppressfunc>SDKv2 Schema Behaviors - DiffSuppressFunc ↗</a> for more information.</p></div></div><h2 id=ignore_read>API field that is never included in the response
<a class=anchor href=#ignore_read>#</a></h2><p>This is common for fields that store credentials or similar information. Such fields should also be marked as <a href=https://googlecloudplatform.github.io/magic-modules/reference/field/#sensitive><code>sensitive</code></a>.</p><p>In the flattener for the field, return the value of the field in the user&rsquo;s configuration.</p><div class=book-tabs><input type=radio class=toggle name=tabs-ignore_read id=tabs-ignore_read-0 checked>
<label for=tabs-ignore_read-0>MMv1</label><div class="book-tabs-content markdown-inner"><p>On top-level fields, this can be done with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ignore_read</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>For nested fields, <code>ignore_read</code> is <a href=https://github.com/hashicorp/terraform-provider-google/issues/12410>not currently supported</a>, so this must be implemented with a <a href=https://googlecloudplatform.github.io/magic-modules/develop/custom-code/#custom_flatten>custom flattener</a>. You will also need to add the field to <code>ignore_read_extra</code> on any examples that are used to generate tests; this will cause tests to ignore the field when checking that the values in the API match the user&rsquo;s configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatten</span>{{<span style=color:#960050;background-color:#1e0010>$</span>.<span style=color:#a6e22e>GetPrefix</span>}}{{<span style=color:#960050;background-color:#1e0010>$</span>.<span style=color:#a6e22e>TitlelizeProperty</span>}}(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>, <span style=color:#a6e22e>config</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>transport_tpg</span>.<span style=color:#a6e22e>Config</span>) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// We want to ignore read on this field, but cannot because it is nested
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;path.0.to.0.nested.0.field&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>examples</span>:
</span></span><span style=display:flex><span>   <span style=color:#75715e># example configuration</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>ignore_read_extra</span>:
</span></span><span style=display:flex><span>     - <span style=color:#e6db74>&#34;path.0.to.0.nested.0.field&#34;</span>
</span></span></code></pre></div></div><input type=radio class=toggle name=tabs-ignore_read id=tabs-ignore_read-1>
<label for=tabs-ignore_read-1>Handwritten</label><div class="book-tabs-content markdown-inner"><p>Use <code>d.Get</code> to set the flattened value to be the same as the user-configured value (instead of a value from the API).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flattenParentField</span>(<span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>, <span style=color:#a6e22e>disk</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>compute</span>.<span style=color:#a6e22e>AttachedDisk</span>, <span style=color:#a6e22e>config</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>transport_tpg</span>.<span style=color:#a6e22e>Config</span>) []<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;nested_field&#34;</span>: <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;path.0.to.0.parent_field.0.nested_field&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> []<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{<span style=color:#a6e22e>result</span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In tests, add the field to <code>ImportStateVerifyIgnore</code> on any relevant import steps.</p><pre tabindex=0><code>{
    ResourceName:            &#34;google_product_resource.default&#34;,
    ImportState:             true,
    ImportStateVerify:       true,
    ImportStateVerifyIgnore: []string{&#34;&#34;path.0.to.0.parent_field.0.nested_field&#34;},
},
</code></pre></div></div><h2 id=list-order>API returns a list in a different order than was sent
<a class=anchor href=#list-order>#</a></h2><p>For an Array of unique string values (or nested objects with unique string identifiers), use the <code>SortStringsByConfigOrder</code> or <code>SortMapsByConfigOrder</code> helper functions to sort the API response to match the order in the user&rsquo;s configuration. This will also simplify diffs if new values are added or removed. Imported resources will not have access to a configuration, so the field will be sorted alphabetically. This means that tests for the resource need to ignore the field&rsquo;s import behavior via <code>ignore_read_extra</code> (for MMv1 examples) or <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/import#importstateverifyignore-1><code>ImportStateVerifyIgnore</code></a> (for handwritten tests).</p><div class=book-tabs><input type=radio class=toggle name=tabs-diff_suppress_list id=tabs-diff_suppress_list-0 checked>
<label for=tabs-diff_suppress_list-0>MMv1</label><div class="book-tabs-content markdown-inner"><p>Add a <a href=https://googlecloudplatform.github.io/magic-modules/develop/custom-code/#custom_flatten>custom flattener</a> for the field.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flatten</span>{{<span style=color:#960050;background-color:#1e0010>$</span>.<span style=color:#a6e22e>GetPrefix</span>}}{{<span style=color:#960050;background-color:#1e0010>$</span>.<span style=color:#a6e22e>TitlelizeProperty</span>}}(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>, <span style=color:#a6e22e>config</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>transport_tpg</span>.<span style=color:#a6e22e>Config</span>) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rawConfigValue</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;path.0.to.0.parent_field.0.nested_field&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert config value to []string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>configValue</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>InterfaceSliceToStringSlice</span>(<span style=color:#a6e22e>rawConfigValue</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] Failed to convert config value: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert v to []string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>apiStringValue</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>InterfaceSliceToStringSlice</span>(<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] Failed to convert API value: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sortedStrings</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>SortStringsByConfigOrder</span>(<span style=color:#a6e22e>configValue</span>, <span style=color:#a6e22e>apiStringValue</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] Could not sort API response value: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sortedStrings</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><input type=radio class=toggle name=tabs-diff_suppress_list id=tabs-diff_suppress_list-1>
<label for=tabs-diff_suppress_list-1>Handwritten</label><div class="book-tabs-content markdown-inner"><p>Define resource-specific functions in your service package, for example at the top of the related resource file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flattenResourceNameFieldName</span>(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>ResourceData</span>, <span style=color:#a6e22e>config</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>transport_tpg</span>.<span style=color:#a6e22e>Config</span>) <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rawConfigValue</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;path.0.to.0.parent_field.0.nested_field&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert config value to []string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>configValue</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>InterfaceSliceToStringSlice</span>(<span style=color:#a6e22e>rawConfigValue</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] Failed to convert config value: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert v to []string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>apiStringValue</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>InterfaceSliceToStringSlice</span>(<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] Failed to convert API value: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sortedStrings</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tpgresource</span>.<span style=color:#a6e22e>SortStringsByConfigOrder</span>(<span style=color:#a6e22e>configValue</span>, <span style=color:#a6e22e>apiStringValue</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[ERROR] Could not sort API response value: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sortedStrings</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><p>For other Array fields, convert the field to a Set – this is a <a href=https://googlecloudplatform.github.io/magic-modules/breaking-changes/breaking-changes/>breaking change</a> and can only happen in a major release.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/369c73a05c4f5b810dd9eae1b30b8371a78ab7cd title='Last modified by nityaravi | December 16, 2024' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 16, 2024</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/develop%2fdiffs.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/develop/diffs.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#default>API returns default value for unset field</a></li><li><a href=#default_if_empty>API returns an empty value if default value is sent</a></li><li><a href=#normalized-value>API normalizes a value</a></li><li><a href=#ignore_read>API field that is never included in the response</a></li><li><a href=#list-order>API returns a list in a different order than was sent</a></li></ul></nav></div></aside></main></body></html>