<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="What has changed in the MMv1 Go migration#
The Magic Modules code generator has been rewritten from Ruby to Go. For experienced contributors, this reference document lists what the expected changes are to the previous development workflow in Ruby.
YAML changes#
.yaml files within mmv1/products have had adjustments to the attribute typing. The initial Ruby lines !ruby/object:Api::Type::<TYPE> have been removed and replaced with a simpler type: <TYPE> line.
Old Ruby YAML"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/reference/ruby-go-changes/"><meta property="og:site_name" content="Magic Modules"><meta property="og:title" content="Ruby to Go Migration"><meta property="og:description" content="What has changed in the MMv1 Go migration# The Magic Modules code generator has been rewritten from Ruby to Go. For experienced contributors, this reference document lists what the expected changes are to the previous development workflow in Ruby.
YAML changes# .yaml files within mmv1/products have had adjustments to the attribute typing. The initial Ruby lines !ruby/object:Api::Type::<TYPE> have been removed and replaced with a simpler type: <TYPE> line.
Old Ruby YAML"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="reference"><meta property="article:modified_time" content="2024-12-12T12:40:29-05:00"><title>Ruby to Go Migration | Magic Modules</title><link rel=icon href=/magic-modules/favicon.png><link rel=manifest href=/magic-modules/manifest.json><link rel=canonical href=https://googlecloudplatform.github.io/magic-modules/reference/ruby-go-changes/><link rel=stylesheet href=/magic-modules/book.min.34f6ea145e56d87823abe9f451d0a8fbe3dbcc6f9e02412199a014611b7adf70.css integrity="sha256-NPbqFF5W2Hgjq+n0UdCo++PbzG+eAkEhmaAUYRt633A=" crossorigin=anonymous><script defer src=/magic-modules/fuse.min.js></script><script defer src=/magic-modules/en.search.min.f80a1790b33c1c9d52b24e467f117903baf956e86799991ca9e8f53a2a67c0d7.js integrity="sha256-+AoXkLM8HJ1Ssk5GfxF5A7r5VuhnmZkcqej1OipnwNc=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-reference"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/magic-modules/ title=Overview>Overview</a></li></ul><ul><li><a href=/magic-modules/contribution-process/>Contribution process</a></li><li><input type=checkbox id=section-1218d39abefe7f824522d24e615b6429 class=toggle>
<label for=section-1218d39abefe7f824522d24e615b6429 class=flex><a role=button>Develop</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/develop/set-up-dev-environment/>Set up your development environment</a></li><li><a href=/magic-modules/develop/add-resource/>Add a resource</a></li><li><a href=/magic-modules/develop/add-fields/>Add a field to an existing resource</a></li><li><a href=/magic-modules/develop/add-iam-support/>Add IAM support</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/update-dependencies/>Update dependencies</a></li><li><a href=/magic-modules/develop/diffs/>Fix diffs</a></li><li><a href=/magic-modules/develop/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/develop/client-side-fields/>Client-side fields</a></li></ul></li><li><input type=checkbox id=section-46008ee5c4ef0e6f804abf3cfaea6dd0 class=toggle>
<label for=section-46008ee5c4ef0e6f804abf3cfaea6dd0 class=flex><a role=button>Test</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/test/test/>Add resource tests</a></li><li><a href=/magic-modules/test/run-tests/>Run tests</a></li></ul></li><li><input type=checkbox id=section-54e8c97150acf80b182bc188a6e6c492 class=toggle>
<label for=section-54e8c97150acf80b182bc188a6e6c492 class=flex><a role=button>Document</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/document/add-documentation/>Add documentation</a></li><li><a href=/magic-modules/document/handwritten-docs-style-guide/>Handwritten docs style guide</a></li></ul></li><li><input type=checkbox id=section-d11be9eb6f9aad36128162d909d31b29 class=toggle>
<label for=section-d11be9eb6f9aad36128162d909d31b29 class=flex><a role=button>Convert</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/convert/add-new-resource-tgc/>Add TGC conversion</a></li></ul></li><li><input type=checkbox id=section-ca39f9a7961e297a8c04b44ec69dbc58 class=toggle>
<label for=section-ca39f9a7961e297a8c04b44ec69dbc58 class=flex><a role=button>Breaking changes</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/breaking-changes/breaking-changes/>Types of breaking changes</a></li><li><a href=/magic-modules/breaking-changes/make-a-breaking-change/>Make a breaking change</a></li></ul></li><li><input type=checkbox id=section-e42fc06bc1be2cad20d6487ff549c503 class=toggle>
<label for=section-e42fc06bc1be2cad20d6487ff549c503 class=flex><a role=button>Code review</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/code-review/create-pr/>Create a pull request</a></li><li><a href=/magic-modules/code-review/release-notes/>Write release notes</a></li><li><a href=/magic-modules/code-review/review-pr/>Review a pull request</a></li></ul></li><li><input type=checkbox id=section-29607ad0ac6d788001e899a44038a031 class=toggle>
<label for=section-29607ad0ac6d788001e899a44038a031 class=flex><a role=button>Best practices</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/best-practices/immutable-fields/>Immutable fields</a></li><li><a href=/magic-modules/best-practices/deletion-behaviors/>Deletion behaviors</a></li><li><a href=/magic-modules/best-practices/labels-and-annotations/>Labels and annotations</a></li><li><a href=/magic-modules/best-practices/common-resource-patterns/>Common resource patterns</a></li><li><a href=/magic-modules/best-practices/validation/>Validation</a></li></ul></li><li><input type=checkbox id=section-3de530fff78b7e92c59925d632c7e725 class=toggle checked>
<label for=section-3de530fff78b7e92c59925d632c7e725 class=flex><a role=button>Reference</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/reference/resource/>MMv1 resource reference</a></li><li><a href=/magic-modules/reference/field/>MMv1 field reference</a></li><li><a href=/magic-modules/reference/make-commands/>make commands</a></li><li><a href=/magic-modules/reference/metadata/>MMv1 metadata reference</a></li><li><a href=/magic-modules/reference/ruby-go-changes/ class=active>Ruby to Go Migration</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/icons/menu.svg class=book-icon alt=Menu></label><h3>Ruby to Go Migration</h3><label for=toc-control><img src=/magic-modules/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#yaml-changes>YAML changes</a></li><li><a href=#template-erb-file-changes>Template <code>.erb</code> file changes</a><ul><li><a href=#common-templating-snippets>Common templating snippets</a></li></ul></li><li><a href=#advanced-mmv1-specific-generator-command>Advanced: MMv1-specific generator command</a></li><li><a href=#advanced-mmv1-generator-code-locations>Advanced: MMv1 generator code locations</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=what-has-changed-in-the-mmv1-go-migration>What has changed in the MMv1 Go migration<a class=anchor href=#what-has-changed-in-the-mmv1-go-migration>#</a></h1><p>The Magic Modules code generator has been rewritten from Ruby to Go. For experienced contributors, this reference document lists what the expected changes are to the previous development workflow in Ruby.</p><h2 id=yaml-changes>YAML changes<a class=anchor href=#yaml-changes>#</a></h2><p><code>.yaml</code> files within <code>mmv1/products</code> have had adjustments to the attribute typing. The initial Ruby lines <code>!ruby/object:Api::Type::&lt;TYPE></code> have been removed and replaced with a simpler <code>type: &lt;TYPE></code> line.</p><p>Old Ruby YAML</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>- !ruby/object:Api::Type::String
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>name</span>: <span style=color:#5af78e>&#39;apiFieldName&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>description</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    MULTILINE_FIELD_DESCRIPTION</span></span></span></code></pre></div><p>New Go YAML</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff6ac1>name</span>: <span style=color:#5af78e>&#39;apiFieldName&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>type</span>: String
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>description</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>    MULTI_LINE_FIELD_DESCRIPTION</span></span></span></code></pre></div><h2 id=template-erb-file-changes>Template <code>.erb</code> file changes<a class=anchor href=#template-erb-file-changes>#</a></h2><p>Template files have all been converted Embedded Ruby (ERB) templates to Go&rsquo;s <a href=https://pkg.go.dev/text/template>text/template</a> format.
All <code>.erb</code> files are replaced with equivalent <code>.tmpl</code> files. The MMv1 resource objects are passed to the Go templates for referencing, similar to the previous Ruby templates. For the list of available variables and functions within the templates, please reference:</p><ul><li><a href=https://pkg.go.dev/text/template>text/template standard library</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource.go>mmv1/api/resource.go</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/google/template_utils.go>mmv1/google/template_utils.go</a></li></ul><h3 id=common-templating-snippets>Common templating snippets<a class=anchor href=#common-templating-snippets>#</a></h3><h4 id=version-guards>Version guards<a class=anchor href=#version-guards>#</a></h4><p>Old Ruby template</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span>&lt;<span style=color:#ff6ac1>%</span> unless version <span style=color:#ff6ac1>==</span> <span style=color:#ff5c57>&#39;</span>ga<span style=color:#ff5c57>&#39;</span> <span style=color:#ff6ac1>-%</span>&gt;
</span></span><span style=display:flex><span><span style=color:#78787e>// Go code here</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#ff6ac1>%</span> end <span style=color:#ff6ac1>-%</span>&gt;</span></span></code></pre></div><p>New Go template</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span>{{<span style=color:#ff6ac1>-</span> <span style=color:#ff6ac1>if</span> ne <span style=color:#ff5c57>$</span>.TargetVersionName <span style=color:#5af78e>&#34;ga&#34;</span> }}
</span></span><span style=display:flex><span><span style=color:#78787e>// Go code here</span>
</span></span><span style=display:flex><span>{{<span style=color:#ff6ac1>-</span> end }}</span></span></code></pre></div><h4 id=example-tferb-variables>Example <code>.tf.erb</code> variables<a class=anchor href=#example-tferb-variables>#</a></h4><p>Old Ruby template <code>pubsub_topic_basic.tf.erb</code></p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-hcl data-lang=hcl><span style=display:flex><span>resource &#34;google_pubsub_topic&#34; &#34;&lt;%<span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>ctx</span>[<span style=color:#ff5c57>:</span><span style=color:#ff6ac1>primary_resource_id</span>] <span style=color:#ff5c57>%&gt;&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#ff6ac1>=</span> &#34;&lt;%<span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>ctx</span>[<span style=color:#ff5c57>:</span><span style=color:#ff6ac1>vars</span>][<span style=color:#ff5c57>&#39;</span><span style=color:#ff6ac1>topic_name</span><span style=color:#ff5c57>&#39;</span>] <span style=color:#ff5c57>%&gt;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  labels <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>    foo <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  message_retention_duration <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;86600s&#34;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>New Go template <code>pubsub_topic_basic.tf.tmpl</code></p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#ff6ac1>resource</span> <span style=color:#5af78e>&#34;google_pubsub_topic&#34; &#34;{{$.PrimaryResourceId}}&#34;</span> {
</span></span><span style=display:flex><span>  name <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;{{index $.Vars &#34;topic_name&#34;}}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  labels <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>    foo <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;bar&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  message_retention_duration <span style=color:#ff6ac1>=</span> <span style=color:#5af78e>&#34;86600s&#34;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=advanced-mmv1-specific-generator-command>Advanced: MMv1-specific generator command<a class=anchor href=#advanced-mmv1-specific-generator-command>#</a></h2><p>Most contributors should use the make commands referenced in <a href=https://googlecloudplatform.github.io/magic-modules/reference/make-commands/>make-commands</a> reference page to generate the downstream <code>google</code> and <code>google-beta</code> providers. The input for these commands have not changed, and have already been correctly switched over to use the new Go engine.</p><p>Some advanced contributors may be used to running the MMv1 generator commands. These commands have changed from Ruby&rsquo;s <code>bundle exec</code> to <code>go run</code>.</p><p><strong>These are not generally recommended to use</strong></p><p>Old Ruby MMv1 generator command in mmv1/:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>bundle <span style=color:#ff5c57>exec</span> compiler -e terraform -o &lt;output directory&gt; -v &lt;version&gt; -f &lt;MMv1 provider&gt; -p &lt;products/productfolder&gt;</span></span></code></pre></div><p>New Go MMv1 generator command in mmv1/:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>go run . --output &lt;output directory&gt; --version &lt;version&gt; --provider &lt;MMv1 provider&gt;</span></span></code></pre></div><h2 id=advanced-mmv1-generator-code-locations>Advanced: MMv1 generator code locations<a class=anchor href=#advanced-mmv1-generator-code-locations>#</a></h2><p>Most previous Ruby compiler code has parallel Go code placed the same file locations.
For example, the Go replacements for <code>mmv1/compiler.rb</code> and <code>mmv1/provider/terraform.rb</code> are <code>mmv1/main.go</code> and <code>mmv1/provider/terraform.go</code> respectively.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/5c029adc5b18bc0f13f45e7731b2caf20161fd99 title='Last modified by nityaravi | December 12, 2024' target=_blank rel=noopener><img src=/magic-modules/icons/calendar.svg class=book-icon alt>
<span>December 12, 2024</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/reference%2fruby-go-changes.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/icons/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/reference/ruby-go-changes.md target=_blank rel="noopener edit"><img src=/magic-modules/icons/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap justify-between"><span><a href=/magic-modules/reference/metadata/ class="flex align-center"><img src=/magic-modules/icons/backward.svg class=book-icon alt=Previous title="MMv1 metadata reference">
<span>MMv1 metadata reference</span>
</a></span><span></span></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#yaml-changes>YAML changes</a></li><li><a href=#template-erb-file-changes>Template <code>.erb</code> file changes</a><ul><li><a href=#common-templating-snippets>Common templating snippets</a></li></ul></li><li><a href=#advanced-mmv1-specific-generator-command>Advanced: MMv1-specific generator command</a></li><li><a href=#advanced-mmv1-generator-code-locations>Advanced: MMv1 generator code locations</a></li></ul></nav></div></aside></main></body></html>