name: Feature branch auto merge

permissions: read-all

on:
  push:
    branches:
      - main  # Set a branch to deploy

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true
      
env:

  REPO: https://GoogleCloudPlatform:${{secrets.GITHUB_TOKEN}}@github.com/GoogleCloudPlatform/magic-modules.git

  FEATURE_BRANCH: feature-branch-release-5.0.0

jobs:
  merge:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    permissions:
      contents: write

    steps:
    - name: Merge with main
      run: |
        git clone ${{env.REPO}} -b ${{env.FEATURE_BRANCH}} tmp
        cd tmp
        git config user.name "Feature Branch automerge"
        git config user.email "magic-modules+automerge@google.com"
        git merge origin/main
        git push