<% gcp_organization_id = "#{external_attribute('gcp_organization_id', doc_generation)}" -%>
<% folder_sink = grab_attributes['folder_sink'] -%>
# Getting folder sinks is complicated due to the name being generated by the server.
# This can be drastically simplified if you have the folder name when writing the test
describe.one do
  google_resourcemanager_folders(parent: <%= doc_generation ? "'organizations/12345'" : "\"organizations/\#{gcp_organization_id}\"" -%>).names.each do |folder_name|
    # name on a folder is in the form `folders/12345`
    describe google_logging_folder_log_sink(folder: folder_name.split('/')[1], name: <%= doc_generation ? "'#{folder_sink['name']}'" : "folder_sink['name']" -%>) do
      it { should exist }
      its('filter') { should cmp <%= doc_generation ? "'#{folder_sink['filter']}'" : "folder_sink['filter']" -%> }
    end
  end
end