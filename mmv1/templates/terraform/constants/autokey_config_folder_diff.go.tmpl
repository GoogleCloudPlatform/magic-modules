// Helper functions injected into generated provider files for AutokeyConfig.
// This template is included via the `constants` custom_code entry in the
// AutokeyConfig product YAML. It must not emit a package or import block
// because it is inserted into generated files which already declare those.

const (
    autokeyFolderPrefix  = "folders/"
    autokeyProjectPrefix = "projects/"
    autokeyConfigSuffix  = "/autokeyConfig"
)

func autokeyHasPrefix(value, prefix string) bool {
    return len(value) >= len(prefix) && value[:len(prefix)] == prefix
}

func autokeyTrimPrefix(value, prefix string) string {
    if autokeyHasPrefix(value, prefix) {
        return value[len(prefix):]
    }
    return value
}

func autokeyTrimSuffix(value, suffix string) string {
    if len(value) >= len(suffix) && value[len(value)-len(suffix):] == suffix {
        return value[:len(value)-len(suffix)]
    }
    return value
}

func autokeyJoin(fields []string) string {
    result := ""
    for i, field := range fields {
        if i > 0 {
            result += ","
        }
        result += field
    }
    return result
}

// normalizeParent ensures the parent identifier has the expected prefix.
// Callers should pass the raw value along with the kind ("folder" or "project").
func normalizeParent(parent, kind string) string {
    if parent == "" {
        return parent
    }
    switch kind {
    case "folder":
        if !autokeyHasPrefix(parent, autokeyFolderPrefix) {
            return autokeyFolderPrefix + parent
        }
    case "project":
        if !autokeyHasPrefix(parent, autokeyProjectPrefix) {
            return autokeyProjectPrefix + parent
        }
    }
    return parent
}

// folderPrefixSuppress treats the values "folders/123" and "123" as equivalent.
func folderPrefixSuppress(k, old, new string, d *schema.ResourceData) bool {
    return autokeyTrimPrefix(old, autokeyFolderPrefix) == autokeyTrimPrefix(new, autokeyFolderPrefix)
}
