resource "google_beyondcorp_security_gateway" "default" {
  security_gateway_id = "{{index $.PrefixedVars "security_gateway_name"}}"
  display_name = "My SPA Security Gateway resource"
}

resource "google_beyondcorp_security_gateway_application" "{{$.PrimaryResourceId}}" {
  security_gateway_id = google_beyondcorp_security_gateway.default.security_gateway_id
  application_id = "{{index $.PrefixedVars "application_discovery_name"}}"
  upstreams {
    external {
      endpoints {
        hostname = "my.discovery.service.com"
        port = 443
      }
    }
    proxy_protocol {
      allowed_client_headers= ["header"]
    }
  }
  schema = "API_GATEWAY"
}
