// extract location from the parent
location := ""

if parts := regexp.MustCompile(`locations\/([^\/]*)\/`).FindStringSubmatch(d.Get("parent").(string)); parts != nil {
	location = parts[1]
} else {
	return fmt.Errorf(
		"Saw %s when the parent is expected to contains location %s",
		d.Get("parent"),
		"projects/{{"{{"}}project{{"}}"}}/locations/{{"{{"}}location{{"}}"}}/...",
	)
}

// only insert location into url if the base_url in products/dialogflowcx/product.yaml is used
if strings.HasPrefix(url, "https://-dialogflow.googleapis.com/v3/")
 || strings.HasPrefix(url, "https://-dialogflow." + config.UniverseDomain + "/v3/")
 || strings.HasPrefix(url, "https://-dialogflow.googleapis.com/v3beta1/") 
 || strings.HasPrefix(url, "https://-dialogflow." + config.UniverseDomain + "/v3beta1/")  {
	url = strings.Replace(url, "https://-dialogflow", fmt.Sprintf("https://%s-dialogflow", location), 1)
}

// The generated code sets the wrong masks for the following fields.
newUpdateMask := []string{}
if d.HasChange("instruction.0.steps") {
    newUpdateMask = append(newUpdateMask, "instruction.steps")
}
if d.HasChange("instruction.0.guidelines") {
    newUpdateMask = append(newUpdateMask, "instruction.guidelines")
}
// Pull out any other set fields from the generated mask.
for _, mask := range updateMask {
    if mask == "instruction" {
        continue
    }
    newUpdateMask = append(newUpdateMask, mask)
}
// Overwrite the previously set mask.
url, err = transport_tpg.AddQueryParams(url, map[string]string{"updateMask": strings.Join(newUpdateMask, ",")})
if err != nil {
    return err
}
