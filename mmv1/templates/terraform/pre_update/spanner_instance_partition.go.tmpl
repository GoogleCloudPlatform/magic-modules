delete(obj, "instancePartitionId")
fieldMask := []string{}

if d.HasChange("display_name") {
    fieldMask = append(fieldMask, "displayName")
}

if d.HasChange("config") {
    fieldMask = append(fieldMask, "config")
}

if d.HasChange("node_count") {
    fieldMask = append(fieldMask, "nodeCount")
}

if d.HasChange("processing_units") {
    fieldMask = append(fieldMask, "processingUnits")
}

if d.HasChange("autoscaling_config") {
    old, new := d.GetChange("autoscaling_config")
    oldSlice := old.([]interface{})
    newSlice := new.([]interface{})
    if len(oldSlice) == 0 || len(newSlice) == 0 {
        fieldMask = append(fieldMask, "autoscalingConfig")
        if len(newSlice) == 0 {
            fieldMask = append(fieldMask, "processingUnits")
        }
    } else {
        if d.HasChange("autoscaling_config.0.autoscaling_limits.0.max_processing_units") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingLimits.maxProcessingUnits")
        }
        if d.HasChange("autoscaling_config.0.autoscaling_limits.0.min_processing_units") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingLimits.minProcessingUnits")
        }
        if d.HasChange("autoscaling_config.0.autoscaling_limits.0.max_nodes") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingLimits.maxNodes")
        }
        if d.HasChange("autoscaling_config.0.autoscaling_limits.0.min_nodes") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingLimits.minNodes")
        }
        if d.HasChange("autoscaling_config.0.autoscaling_targets.0.high_priority_cpu_utilization_percent") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingTargets.highPriorityCpuUtilizationPercent")
        }
        if d.HasChange("autoscaling_config.0.autoscaling_targets.0.storage_utilization_percent") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingTargets.storageUtilizationPercent")
        }
        if d.HasChange("autoscaling_config.0.autoscaling_targets.0.total_cpu_utilization_percent") {
            fieldMask = append(fieldMask, "autoscalingConfig.autoscalingTargets.totalCpuUtilizationPercent")
        }
        if d.HasChange("autoscaling_config.0.asymmetric_autoscaling_options") {
            fieldMask = append(fieldMask, "autoscalingConfig.asymmetricAutoscalingOptions")
        }
    }
}

// Add field_mask as a URL parameter
url, err = transport_tpg.AddQueryParams(url, map[string]string{"field_mask": strings.Join(fieldMask, ",")})
if err != nil {
    return err
}
