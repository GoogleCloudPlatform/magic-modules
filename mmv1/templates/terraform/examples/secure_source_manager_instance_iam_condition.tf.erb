resource "google_secure_source_manager_instance" "<%= ctx[:primary_resource_id] %>" {
    location = "us-central1"
    instance_id = "<%= ctx[:vars]['instance_id'] %>"
    labels = {
      "foo" = "bar"
    }
}

resource "google_secure_source_manager_instance_iam_binding" "primary" {
  location = "us-central1"
  instance_id = "<%= ctx[:vars]['instance_id'] %>"

  role = "roles/securesourcemanager.instanceAccessor"
  members = [
    "user:admin@hashicorptest.com"
  ]
  condition {
    description = "Secure Source Manager instance creation"
    expression  = "resource.name == 'google_secure_source_manager_instance.default.id' && resource.service == 'securesourcemanager.googleapis.com'"
    title       = "created"
  }
}

resource "google_secure_source_manager_instance_iam_member" "primary" {
  location = "us-central1"
  instance_id = "<%= ctx[:vars]['instance_id'] %>"

  role = "roles/securesourcemanager.instanceManager"
  member =  "user:admin@hashicorptest.com"
  condition {
    description = "Secure Source Manager instance creation"
    expression  = "resource.name == 'google_secure_source_manager_instance.default.id' && resource.service == 'securesourcemanager.googleapis.com'"
    title       = "created"
  }
}