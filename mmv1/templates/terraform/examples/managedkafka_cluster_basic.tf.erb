resource "google_managed_kafka_cluster" "<%= ctx[:primary_resource_id] %>" {
  cluster_id = "<%= ctx[:vars]['cluster_id'] %>"
  location = "us-central1"
  capacity_config {
    vcpu_count = 3
    memory_bytes = 3221225472
  }
  gcp_config {
    access_config {
      network_configs {
        subnet = "projects/${data.google_project.project.number}/regions/us-central1/subnetworks/default"
      }
    }
  }
  rebalance_config {
    mode = "NO_REBALANCE"
  }
  labels = {
    key = "value"
  }

  depends_on = [google_project_service.managedkafka]

  provider = google-beta
}

resource "google_project_service" "managedkafka" {
  project = data.google_project.project.project_id
  service = "staging-managedkafka.sandbox.googleapis.com"
  disable_on_destroy = false

  provider = google-beta
}

data "google_project" "project" {
  provider = google-beta
}
