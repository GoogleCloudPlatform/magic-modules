data "google_project" "project" { provider = google-beta }

resource "google_network_services_wasm_plugin" "{{$.PrimaryResourceId}}" {
  provider    = google-beta
  name        = "{{index $.Vars "wasm_plugin_name"}}"
  description = "my wasm plugin"
  location    = "global"

  main_version_id = "v1"

  labels = {
    test_label =  "test_value"
  }
  log_config {
    enable =  true
    sample_rate = 1
    min_log_level =  "WARN"
  }

  versions {
    version_name = "v1"
    description = "v1 version of my wasm plugin"
    image_uri = "us-central1-docker.pkg.dev/${data.google_project.project.name}/svextensionplugin/my-wasm-plugin:prod"

    labels = {
      test_label =  "test_value"
    }
  }
  
}
