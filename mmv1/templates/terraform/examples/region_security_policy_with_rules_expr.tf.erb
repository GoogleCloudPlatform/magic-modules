resource "google_compute_region_security_policy" "<%= ctx[:primary_resource_id] %>" {
  name        = "<%= ctx[:vars]['sec_policy_name'] %>"
  description = "region security policy with rules.expr"
  type        = "CLOUD_ARMOR"

  rules {
    action   = "allow"
    priority = "2147483647"
    description = "default rule"
    match {
      versioned_expr = "SRC_IPS_V1"
      config {
        src_ip_ranges = ["*"]
      }
    }
  }

	rules {
    action      = "deny"
    description = "custom rule with expr"
		priority    = "1000"
		match {
			expr {
				expression  = "evaluatePreconfiguredWaf('sqli-stable')"
        title       = "expr for sqli-stable"
        description = "evaluates the preconfigured waf"
        location    = "location for error reporting"
			}
		}
    preview     = false
  }
}