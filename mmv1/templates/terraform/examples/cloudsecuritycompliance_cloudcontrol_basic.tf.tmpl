resource "google_cloud_security_compliance_cloudcontrol" "{{$.PrimaryResourceId}}" {
  organization      = "{{index $.TestEnvVars "org_id"}}"
  location          = "global"
  cloud_control_id  = "{{index $.Vars "cloudcontrol_name"}}"
  
  display_name      = "Example CloudControl"
  description       = "An example cloud control for testing"
  categories        = ["SECURITY"]
  severity          = "HIGH"
  finding_category  = "SECURITY_POLICY"
  remediation_steps = "Review and update the security configuration according to best practices."
  
  supported_cloud_providers        = ["GCP"]
  supported_target_resource_types = ["compute.googleapis.com/Instance"]
  
  rules {
    description         = "Ensure compute instances have secure boot enabled"
    rule_action_types   = ["DETECTIVE"]
    
    cel_expression {
      expression = "resource.data.shieldedInstanceConfig.enableSecureBoot == true"
      resource_types_values {
        values = ["compute.googleapis.com/Instance"]
      }
    }
  }
  
  parameter_spec {
    name         = "location"
    display_name = "Resource Location"
    description  = "The location where the resource should be deployed"
    value_type   = "STRING"
    is_required  = true
    
    default_value {
      string_value = "us-central1"
    }
    
    validation {
      regexp_pattern {
        pattern = "^[a-z]+-[a-z]+[0-9]$"
      }
    }
  }
}