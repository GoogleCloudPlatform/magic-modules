resource "tls_private_key" "default" {
  algorithm = "RSA"
  rsa_bits  = 2048
}

resource "google_public_ca_external_account_key" "account_key" {
  project = "<%= ctx[:test_env_vars]['project'] %>"
}

data "google_client_openid_userinfo" "user" {}

resource "google_public_ca_acme_registration" "<%= ctx[:primary_resource_id] %>" {
  name            = "<%= ctx[:primary_resource_id] %>"
  email           = data.google_client_openid_userinfo.user.email
  private_key_pem = tls_private_key.default.private_key_pem_pkcs8
  eab_key_id      = google_public_ca_external_account_key.account_key.key_id
  eab_hmac_key    = google_public_ca_external_account_key.account_key.b64_mac_key
  project         = "<%= ctx[:test_env_vars]['project'] %>"
}