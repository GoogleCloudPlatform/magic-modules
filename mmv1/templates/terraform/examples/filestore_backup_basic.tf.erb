
resource "google_filestore_instance" "instance" {
  name     = "<%= ctx[:vars]["instance_name"] %>"
  location = "us-central1-a"
  tier     = "BASIC_HDD"


  file_shares {
    capacity_gb = 1024
    name        = "share4"


    nfs_export_options {
      ip_ranges = ["10.0.0.0/24"]
      access_mode = "READ_WRITE"
      squash_mode = "NO_ROOT_SQUASH"
    }

    nfs_export_options {
      ip_ranges = ["10.10.0.0/24"]
      access_mode = "READ_ONLY"
      squash_mode = "ROOT_SQUASH"
      anon_uid = 123
    }
  }

  networks {
    network = "default"
    modes   = ["MODE_IPV4"]
  }
}

resource "google_filestore_backup" "<%= ctx[:primary_resource_id] %>" {
  name        = "tf-test-test-backup%{random_suffix}"
  location    = google_filestore_instance.instance.location
  description = "This is a filestore backup for the test instance"
  labels = {
    "files":"label1",
    "otherLabel": "label2"
    }
  source_instance   = google_filestore_instance.instance.id
  source_file_share = "share4"
}
