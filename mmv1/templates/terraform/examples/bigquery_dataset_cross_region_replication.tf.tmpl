resource "google_bigquery_dataset" "{{$.PrimaryResourceId}}" {
  dataset_id                  = "{{$.Vars.dataset_id}}"
  friendly_name              = "Cross Region Replication Example"
  description               = "This is a test dataset with cross-region replication enabled"
  location                  = "{{$.Vars.location}}"
  delete_contents_on_destroy = true

  cross_region_replication {
    enabled = true
    replica_regions = [
      "{{$.Vars.replica_region1}}",
      "{{$.Vars.replica_region2}}"
    ]
  }

  labels = {
    env = "test"
  }

  access {
    role          = "OWNER"
    user_by_email = google_service_account.bqowner.email
  }
}

resource "google_service_account" "bqowner" {
  account_id = "bqowner"
}
