resource "google_vertex_ai_endpoint_with_model_garden_deployment" "{{$.PrimaryResourceId}}" {
  publisher_model_name = "publishers/google/models/paligemma@paligemma-224-float32"
  location             = "us-central1"

  model_config {
    accept_eula =  true
  }

  endpoint_config {
    private_service_connect_config {
      enable_private_service_connect = true
      project_allowlist              = [data.google_project.project.id]

      psc_automation_configs {
        project_id = data.google_project.project.id
        network    = google_compute_network.network.id
      }
    }
  }
}

resource "google_compute_subnetwork" "subnetwork" {
  name          = "subnetwork"
  ip_cidr_range = "192.168.0.0/24"
  region        = "us-central1"
  network       = google_compute_network.network.id
}

resource "google_compute_network" "network" {
  name                    = "network"
  auto_create_subnetworks = false
}

data "google_project" "project" {}
