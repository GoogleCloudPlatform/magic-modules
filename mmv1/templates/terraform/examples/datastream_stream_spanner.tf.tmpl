mmv1/templates/terraform/examples/datastream_stream_spanner.tf.tmplresource "google_datastream_stream" "default" {
    display_name = "Spanner to BigQuery"
    location     = "us-central1"
    stream_id    = "{{index $.Vars "stream_id"}}"

    source_config {
        source_connection_profile = "{{index $.Vars "source_connection_profile_id"}}"
        spanner_source_config {
            change_stream_name = "example-change-stream"
            fgac_role = "example-role"
            spanner_rpc_priority = "MEDIUM"
            max_concurrent_cdc_tasks = 1000
            max_concurrent_backfill_tasks = 10
            include_objects {
                schemas {
                    schema = "schema-to-include"
                    tables {
                        table = "table-to-include"
                        columns {
                            column = "column-to-include"
                        }
                    }
                }
            }
            exclude_objects {
                schemas {
                    schema = "schema-to-exclude"
                    tables {
                        table = "table-to-exclude"
                        columns {
                            column = "column-to-exclude"
                        }
                    }
                }
            }
            backfill_data_boost_enabled = true
        }
    }

    destination_config {
        destination_connection_profile = "{{index $.Vars "destination_connection_profile_id"}}"
        bigquery_destination_config {
            data_freshness = "900s"
            source_hierarchy_datasets {
                dataset_template {
                    location = "us-central1"
                }
            }
        }
    }

    backfill_all {
        spanner_excluded_objects {
            schemas {
                schema = "example-schema"
                tables {
                    table = "example-table"
                }
            }
        }
    }
}
