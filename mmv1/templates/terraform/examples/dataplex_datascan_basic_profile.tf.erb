resource "google_bigquery_dataset" "source" {
  count = 1
  dataset_id                  = "dataplex_dataset_%{random_suffix}"
  friendly_name               = "test"
  description                 = "This is a test description"
  location                    = "US"
}

resource "google_dataplex_datascan" "<%= ctx[:primary_resource_id] %>" {
  location     = "us-central1"
  data_scan_id = "tf-test-datascan%{random_suffix}"

  data {
	  resource = "//bigquery.googleapis.com/projects/bigquery-public-data/datasets/samples/tables/shakespeare"
  }

  execution_spec {
    trigger {
      on_demand {}
    }
  }

  data_profile_spec {
    post_scan_actions {
      bigquery_export {
        results_table = "//bigquery.googleapis.com/projects/<%= ctx[:test_env_vars]['project_name'] %>/datasets/google_bigquery_dataset.source.dataset_id/tables/profile_export"
      }
    }
  }

  project = "<%= ctx[:test_env_vars]['project_name'] %>"
  depends_on = [
    google_bigquery_dataset.source
  ]
}


