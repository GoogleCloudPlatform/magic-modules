resource "google_secure_source_manager_instance" "<%= ctx[:primary_resource_id] %>" {
    instance_id = "<%= ctx[:vars]['instance_id'] %>"
    location = "us-central1"
    labels = {
      "foo" = "bar"
    }
}

resource "google_secure_source_manager_instance_iam_binding" "instance" {
  location = "us-central1"
  instance_id = google_secure_source_manager_instance.<%= ctx[:primary_resource_id] %>.instance_id
  role = "roles/securesourcemanager.instanceManager"

  members = [
    "user:admin@hashicorptest.com"
  ]
}

resource "google_secure_source_manager_instance_iam_member" "instance" {
  location = "us-central1"
  instance_id = google_secure_source_manager_instance.<%= ctx[:primary_resource_id] %>.instance_id
  role = "roles/securesourcemanager.instanceAccessor"
  member     = "user:admin@hashicorptest.com"
}