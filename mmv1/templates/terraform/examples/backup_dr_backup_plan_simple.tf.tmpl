resource "google_backup_dr_backup_vault" "my-backup-vault" {
    provider = google-beta
    location = "us-central1"
    backup_vault_id    = "bv-test"
    description = "This is a second backup vault built by Terraform."
    backup_minimum_enforced_retention_duration = "100000s"
    labels = {
      foo = "bar1"
      bar = "baz1"
    }
    annotations = {
      annotations1 = "bar1"
      annotations2 = "baz1"
    }
    force_update = "true"
    force_delete = "true"
    allow_missing = "true" 
}

resource "google_backup_dr_backup_plan" "{{$.PrimaryResourceId}}" { 
  provider = google-beta
  location = "us-central1" 
  backup_plan_id = "{{index $.Vars "backup_plan_id"}}"
  resource_type= "compute.googleapis.com/Instance"
  backup_vault = google_backup_dr_backup_vault.my-backup-vault.id
  depends_on= [ google_backup_dr_backup_vault.my-backup-vault ]
  lifecycle {
    ignore_changes = [backup_vault, description]
  }
  backup_rules {
	rule_id = "rule-1"
	backup_retention_days = 5
	standard_schedule {
	  recurrence_type = "HOURLY"
	   hourly_frequency = 6
	    time_zone = "UTC"
	     backup_window{
		start_hour_of_day = 0
		end_hour_of_day = 24
      }
    }
}
}
