resource "google_pubsub_topic" "{{$.PrimaryResourceId}}" {
  name = "{{index $.Vars "topic_name"}}"
}

resource "google_pubsub_subscription" "{{$.PrimaryResourceId}}" {
  name  = "{{index $.Vars "subscription_name"}}"
  topic = google_pubsub_topic.{{$.PrimaryResourceId}}.id

  message_transforms = [
    {
      javascript_udf {
        function_name = "filter_falsy",
        code = "function filter_falsy(message, metadata) {\n  return message ? message : null;\n}\n"
      }
      enabled = true
    }
  ]
}
