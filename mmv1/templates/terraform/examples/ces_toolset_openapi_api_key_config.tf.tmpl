resource "google_ces_app" "ces_app_for_toolset" {
  app_id = "{{index $.Vars "app_id"}}"
  location = "us"
  description = "App used as parent for CES Toolset example"
  display_name = "{{index $.Vars "app_display_name"}}"

  language_settings {
    default_language_code    = "en-US"
    supported_language_codes = ["es-ES", "fr-FR"]
    enable_multilingual_support = true
    fallback_action          = "escalate"
  }
  time_zone_settings {
    time_zone = "America/Los_Angeles"
  }
}

resource "google_ces_toolset" "ces_toolset_openapi_api_key_config" {
  toolset_id = "{{index $.Vars "toolset_id"}}"
  location = "us"
  app      = google_ces_app.ces_app_for_toolset.app_id
  display_name = "Basic toolset display name"
  description = "Test description"
  execution_type = "SYNCHRONOUS"

  open_api_toolset {
    open_api_schema = <<-EOT
      openapi: 3.0.0
      info:
        title: My Sample API
        version: 1.0.0
        description: A simple API example
      servers:
        - url: https://api.example.com/v1
      paths: {}
    EOT
    ignore_unknown_fields = false
    tls_config {
        ca_certs {
          display_name="example"
          cert="ZXhhbXBsZQ=="
        }
    }
    service_directory_config {
      service = "projects/example/locations/us/namespaces/namespace/services/service"
    }
    api_authentication {
        api_key_config {
            key_name = "ExampleKey"
            api_key_secret_version = "projects/fake-project/secrets/fake-secret/versions/version-1"
            request_location = "HEADER"
        }
    }
  }
}