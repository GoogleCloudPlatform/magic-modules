resource "google_monitoring_uptime_check_config" "<%= ctx[:primary_resource_id] %>" {
  display_name = "<%= ctx[:vars]["display_name"] %>"
  timeout      = "60s"
  user_labels  = {
    example-key = "example-value"
  }

  http_check {
    path = "some-path"
    port = "443"
  }

  monitored_resource {
    type = "cloud_run_revision"
    labels = {
      location     = google_cloud_run_v2_service.<%= ctx[:vars]["cloud_run_primary_id"] %>.location
      project_id   = google_cloud_run_v2_service.<%= ctx[:vars]["cloud_run_primary_id"] %>.project
      service_name = google_cloud_run_v2_service.<%= ctx[:vars]["cloud_run_primary_id"] %>.name
    }
  }
}

resource "google_cloud_run_v2_service" "<%= ctx[:cloud_run_primary_id] %>" {
  name     = "<%= ctx[:vars]['cloud_run_service_name'] %>"
  location = "us-central1"
  ingress = "INGRESS_TRAFFIC_ALL"
  
  template {
    containers {
      image = "us-docker.pkg.dev/cloudrun/container/hello"
    }
  }
}
