resource "google_bigquery_dataset" "test" {
  dataset_id = "{{index $.Vars "dataset_id"}}"
}

resource "google_bigquery_routine" "sproc" {
  dataset_id      = google_bigquery_dataset.test.dataset_id
  routine_id      = "{{index $.Vars "routine_id"}}"
  routine_type    = "TABLE_VALUED_FUNCTION"
  language        = "SQL"
  description     = "Gets every row from a table."
  definition_body = "SELECT * FROM t1"

  arguments {
    name          = "t1"
    argument_kind = "FIXED_TABLE"
    table_type {
      columns {
        name = "year"
        type = jsonencode({ "typeKind" : "INT64" })
      }
    }
  }
}
