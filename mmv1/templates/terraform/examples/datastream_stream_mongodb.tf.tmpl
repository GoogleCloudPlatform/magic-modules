resource "google_datastream_stream" "default" {
    display_name = "Mongodb to BigQuery"
    location     = "us-central1"
    stream_id    = "{{index $.Vars "stream_id"}}"

    source_config {
        source_connection_profile = "{{index $.Vars "source_connection_profile_id"}}"
        mongodb_source_config {
            include_objects {
                databases {
                    database = "mydb"
                    collections {
                        collection = "mycollection1"
                    }
                    collections {
                        collection = "mycollection2"
                    }
                }
            }
            excludee_objects {
                databases {
                    database = "mydb"
                    collections {
                        fields {
                           field = "excludedField"
                        }
                    }
                }
            }
        }
    }

    destination_config {
        destination_connection_profile = "{{index $.Vars "destination_connection_profile_id"}}"
        bigquery_destination_config {
            data_freshness = "900s"
            source_hierarchy_datasets {
                dataset_template {
                    location = "us-central1"
                }
            }
        }
    }

    backfill_none {}
}
