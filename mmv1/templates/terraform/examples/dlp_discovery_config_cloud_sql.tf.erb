resource "google_data_loss_prevention_discovery_config" "<%= ctx[:primary_resource_id] %>" {
	parent = "projects/<%= ctx[:test_env_vars]['project'] %>/locations/us"
    location = "us"
    status = "RUNNING"

    targets {
        cloud_sql_target {
            filter {
                collection {
                    include_regexes {
                        patterns {
                            project_id_regex = ".*"
                            instance_regex = ".*"
                            database_regex = ".*"
                            database_resource_name_regex = "mytable.*"
                        }
                    }
                }
            }
            conditions {
                database_engines = ["ALL_SUPPORTED_DATABASE_ENGINES", "MYSQL", "POSTGRES"]
                types = ["DATABASE_RESOURCE_TYPE_ALL_SUPPORTED_TYPES", "DATABASE_RESOURCE_TYPE_TABLE"]
            }
            cadence {
                schema_modified_cadence {
                    types = ["NEW_COLUMNS", "REMOVED_COLUMNS"]
                    frequency = "UPDATE_FREQUENCY_DAILY"
                }
                refresh_frequency = "UPDATE_FREQUENCY_MONTHLY"
            }
        }
    }
    targets {
        cloud_sql_target {
            filter {
                collection {
                    include_regexes {
                        patterns {
                            project_id_regex = ".*"
                            instance_regex = ".*"
                            database_regex = "do-not-scan.*"
                            database_resource_name_regex = ".*"
                        }
                    }
                }
            }
            disabled {}
        }
    }
    targets {
        cloud_sql_target {
            filter {
                others {}
            }
        }

    }
    inspect_templates = ["projects/%{project}/inspectTemplates/${google_data_loss_prevention_inspect_template.basic.name}"] 
}

resource "google_pubsub_topic" "<%= ctx[:primary_resource_id] %>" {
    name = "fake-topic"
}

resource "google_data_loss_prevention_inspect_template" "basic" {
	parent = "projects/<%= ctx[:test_env_vars]['project'] %>"
	description = "My description"
	display_name = "display_name"

	inspect_config {
		info_types {
			name = "EMAIL_ADDRESS"
		}
    }
}
