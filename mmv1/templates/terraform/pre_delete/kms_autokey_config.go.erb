// Custom pre_delete body for google_kms_autokey_config

var parent string
var updateMask string

if v, ok := d.GetOk("folder"); ok {
    parent = v.(string)
    if !strings.HasPrefix(parent, "folders/") {
        parent = "folders/" + parent
    }
    updateMask = "keyProject,keyProjectResolutionMode"
} else if v, ok := d.GetOk("project"); ok {
    parent = v.(string)
    if !strings.HasPrefix(parent, "projects/") {
        parent = "projects/" + parent
    }
    updateMask = "keyProjectResolutionMode"
} else {
    return fmt.Errorf("either folder or project must be set")
}

// Reuse scaffold variables: assign to `url` and `obj` rather than redeclaring locals.
url = config.KMSBasePath + parent + "/autokeyConfig?update_mask=" + updateMask
obj = make(map[string]interface{})
if strings.HasPrefix(parent, "folders/") {
    obj["keyProject"] = nil
    obj["keyProjectResolutionMode"] = nil
} else {
    obj["keyProjectResolutionMode"] = nil
}

_, err = transport_tpg.SendRequest(transport_tpg.SendRequestOptions{
    Config:    config,
    Method:    "PATCH",
    Project:   billingProject,
    RawURL:    url,
    UserAgent: userAgent,
    Body:      obj,
    Timeout:   d.Timeout(schema.TimeoutDelete),
    Headers:   headers,
})
if err != nil {
    return fmt.Errorf("Error clearing AutokeyConfig for %s: %s", parent, err)
}

return nil