# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: 'SchemaBundle'
kind: 'bigtable#schemaBundle'
description: |
  A schema bundle object that can be referenced in SQL queries.
references:
  guides:
  api: 'https://cloud.google.com/bigtable/docs/reference/admin/rest/v2/projects.instances.tables.schemaBundles'
docs:
id_format: 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles/{{schema_bundle_id}}'
base_url: 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles?schemaBundleId={{schema_bundle_id}}'
self_link: 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles/{{schema_bundle_id}}'
create_url: 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles?schemaBundleId={{schema_bundle_id}}'
update_url: 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles/{{schema_bundle_id}}?ignoreWarnings={{ignore_warnings}}'
update_verb: 'PATCH'
update_mask: true
delete_url: 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles/{{schema_bundle_id}}'
import_format:
  - 'projects/{{project}}/instances/{{instance}}/tables/{{table}}/schemaBundles/{{schema_bundle_id}}'
timeouts:
  insert_minutes: 10
  update_minutes: 10
  delete_minutes: 10
exclude_sweeper: true
examples:
  - name: 'bigtable_schema_bundle'
    primary_resource_id: 'schema_bundle'
    vars:
      instance_name: 'bt-instance'
      table_name: 'bt-table'
      schema_bundle_name: 'bt-schema-bundle'
    ignore_read_extra:
      - 'ignore_warnings'
    # bigtable instance does not use the shared HTTP client, this test creates an instance
    skip_vcr: true
parameters:
  - name: 'schemaBundleId'
    type: String
    description:
      'The unique name of the schema bundle in the form
      `[_a-zA-Z0-9][-_.a-zA-Z0-9]*`.'
    url_param_only: true
    required: true
    immutable: true
  - name: 'instance'
    type: String
    description: 'The name of the instance to create the schema bundle within.'
    url_param_only: true
    immutable: true
    diff_suppress_func: 'tpgresource.CompareResourceNames'
  - name: 'table'
    type: String
    description: 'The name of the table to create the schema bundle within.'
    url_param_only: true
    immutable: true
    diff_suppress_func: 'tpgresource.CompareResourceNames'
  - name: 'ignoreWarnings'
    type: Boolean
    description:
      'If true, allow backwards incompatible changes.'
    url_param_only: true
    default_value: false
properties:
  - name: 'name'
    type: String
    description:
      'The unique name of the requested schema bundle. Values are of the form
      `projects/<project>/instances/<instance>/tables/<table>/schemaBundles/<schemaBundleId>`.'
    output: true
  - name: 'protoSchema'
    type: NestedObject
    description: |
            File descriptor set, generated by protoc.
            To generate, use protoc with imports and source info included. For an example test.proto file, the following command would put the value in a new file named out.pb.

            $ protoc --include_imports --include_source_info test.proto -o out.pb
    required: true
    properties:
      - name: 'protoDescriptors'
        type: String
        description: |
          Base64 encoded content of the file.
        required: true
        validation:
          function: 'verify.ValidateBase64String'
