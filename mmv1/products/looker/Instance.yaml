# Copyright 2023 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
name: 'Instance'
base_url: projects/{{project}}/locations/{{region}}/instances
create_url: projects/{{project}}/locations/{{region}}/instances?instanceId={{name}}
update_verb: :PATCH
update_mask: true
description: |
  A Google Cloud Looker instance.
timeouts: !ruby/object:Api::Timeouts
  insert_minutes: 90
  update_minutes: 90
  delete_minutes: 60
autogen_async: true
parameters:
  # TODO: resourceref?
  - !ruby/object:Api::Type::String
    name: 'region'
    description: |
      The name of the Looker region of the instance.
    required: false
    immutable: true
    url_param_only: true
    ignore_read: true
    default_from_api: true
properties:
  - !ruby/object:Api::Type::String
    name: consumerNetwork
    description: |
      Network name in the consumer project in the format of: projects/{project}/global/networks/{network}
      Note that the consumer network may be in a different GCP project than the consumer 
      project that is hosting the Looker Instance.
  - !ruby/object:Api::Type::Time
    name: createTime
    description: |
      The time the instance was created in RFC3339 UTC "Zulu" format,
      accurate to nanoseconds.
    output: true
  - !ruby/object:Api::Type::String
    name: egressPublicIp
    description: |
      Public Egress IP (IPv4).
    output: true
  - !ruby/object:Api::Type::String
    name: ingressPrivateIp
    description: |
      Private Ingress IP (IPv4).
    output: true
  - !ruby/object:Api::Type::String
    name: ingressPublicIp
    description: |
      Public Ingress IP (IPv4).
    output: true
  - !ruby/object:Api::Type::String
    name: lookerVersion
    description: |
      The Looker version that the instance is using.
    output: true
  - !ruby/object:Api::Type::String
    name: lookerUri
    description: |
      Looker instance URI which can be used to access the Looker Instance UI.
    output: true

  # Maintenance Window Object
  - !ruby/object:Api::Type::NestedObject
    name: maintenanceWindow
    description: Maintenance window for an instance.
    properties:
      - !ruby/object:Api::Type::Enum
        name: 'dayOfweek'
        required: true
        description: |
          Required. Day of the week for this MaintenanceWindow (in UTC).

          - DAY_OF_WEEK_UNSPECIFIED: The day of the week is unspecified.
          - MONDAY: Monday
          - TUESDAY: Tuesday
          - WEDNESDAY: Wednesday
          - THURSDAY: Thursday
          - FRIDAY: Friday
          - SATURDAY: Saturday
          - SUNDAY: Sunday
        values:
          - :DAY_OF_WEEK_UNSPECIFIED
          - :MONDAY
          - :TUESDAY
          - :WEDNESDAY
          - :THURSDAY
          - :FRIDAY
          - :SATURDAY
          - :SUNDAY
      - !ruby/object:Api::Type::NestedObject
        name: 'startTime'
        required: true
        description: |
          Required. Start time of the window in UTC time.
        properties:
          - !ruby/object:Api::Type::Integer
            name: 'hours'
            description: |
              Hours of day in 24 hour format. Should be from 0 to 23.
            validation: !ruby/object:Provider::Terraform::Validation
              function: 'validation.IntBetween(0,23)'
          - !ruby/object:Api::Type::Integer
            name: 'minutes'
            description: |
              Minutes of hour of day. Must be from 0 to 59.
            validation: !ruby/object:Provider::Terraform::Validation
              function: 'validation.IntBetween(0,60)'
          - !ruby/object:Api::Type::Integer
            name: 'seconds'
            description: |
              Seconds of minutes of the time. Must normally be from 0 to 59.
            validation: !ruby/object:Provider::Terraform::Validation
              function: 'validation.IntBetween(0,60)'
          - !ruby/object:Api::Type::Integer
            name: 'nanos'
            description: |
              Fractions of seconds in nanoseconds. Must be from 0 to 999,999,999.
            validation: !ruby/object:Provider::Terraform::Validation
              function: 'validation.IntBetween(0,999999999)'
  # Maintenance Window Object - End
  - !ruby/object:Api::Type::String
    name: name
    description: |
      The ID of the instance or a fully qualified identifier for the instance.
    required: true
    immutable: true
    custom_expand: 'templates/terraform/custom_expand/shortname_to_url.go.erb'
    custom_flatten: 'templates/terraform/custom_flatten/name_from_self_link.erb'
    validation: !ruby/object:Provider::Terraform::Validation
      regex: '^[a-z][a-z0-9-]{0,39}[a-z0-9]$'
  - !ruby/object:Api::Type::Enum
    name: platformEdition
    description: |
      Platform editions for a Looker instance. Each edition maps to a set of instance features, like its size. Must be one of these values:
      - LOOKER_CORE_TRIAL: trial instance
      - LOOKER_CORE_STANDARD: pay as you go standard instance
      - LOOKER_CORE_STANDARD_ANNUAL: subscription standard instance
      - LOOKER_CORE_ENTERPRISE_ANNUAL: subscription enterprise instance
      - LOOKER_CORE_EMBED_ANNUAL: subscription embed instance
      - LOOKER_MODELER: standalone modeling service
    values:
      - :LOOKER_CORE_TRIAL
      - :LOOKER_CORE_STANDARD
      - :LOOKER_CORE_STANDARD_ANNUAL
      - :LOOKER_CORE_ENTERPRISE_ANNUAL
      - :LOOKER_CORE_EMBED_ANNUAL
      - :LOOKER_MODELER
    default_value: :LOOKER_CORE_TRIAL
    immutable: true
  - !ruby/object:Api::Type::Boolean
    name: privateIpEnabled
    description: |
      Whether private IP is enabled on the Looker instance.
    default_value: false
  - !ruby/object:Api::Type::Boolean
    name: publicIpEnabled
    description: |
      Whether public IP is enabled on the Looker instance.
    default_value: true
  - !ruby/object:Api::Type::String
    name: reservedRange
    description: |
      Name of a reserved IP address range within the consumer network, to be used for 
      private servicie access connection. User may or may not specify this in a request.
  - !ruby/object:Api::Type::Time
    name: updateTime
    description: |
      The time the instance was updated in RFC3339 UTC "Zulu" format,
      accurate to nanoseconds.
    output: true
