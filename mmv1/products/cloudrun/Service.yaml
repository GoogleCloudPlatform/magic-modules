# Copyright 2023 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
name: Service
kind: Service
base_url: apis/serving.knative.dev/v1/namespaces/{{project}}/services
cai_base_url: projects/{{project}}/locations/{{location}}/services
references: !ruby/object:Api::Resource::ReferenceLinks
  guides:
    'Official Documentation': 'https://cloud.google.com/run/docs/'
  api: 'https://cloud.google.com/run/docs/reference/rest/v1/namespaces.services'
description: |-
  A Cloud Run service has a unique endpoint and autoscales containers.
iam_policy: !ruby/object:Api::Resource::IamPolicy
  method_name_separator: ':'
  parent_resource_attribute: 'service'
  base_url: v1/projects/{{project}}/locations/{{location}}/services/{{service}}
  import_format:
    [
      'projects/{{project}}/locations/{{location}}/services/{{service}}',
      '{{service}}',
    ]
docs: !ruby/object:Provider::Terraform::Docs
  warning: |
    We recommend using the `google_cloud_run_v2_service` resource which offers a better
    developer experience and broader support of Cloud Run features.
id_format: 'locations/{{location}}/namespaces/{{project}}/services/{{name}}'
import_format:
  ['locations/{{location}}/namespaces/{{project}}/services/{{name}}']
error_retry_predicates: ['transport_tpg.IsCloudRunCreationConflict']
async: !ruby/object:Provider::Terraform::PollAsync
  check_response_func_existence: PollCheckKnativeStatusFunc(res)
  actions: ['create', 'update']
examples:
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_basic'
    primary_resource_id: 'default'
    primary_resource_name: "fmt.Sprintf(\"tf-test-cloudrun-srv%s\",
      context[\"random_suffix\"\
      ])"
    vars:
      cloud_run_service_name: 'cloudrun-srv'
    test_env_vars:
      project: :PROJECT_NAME
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_sql'
    primary_resource_id: 'default'
    primary_resource_name: "fmt.Sprintf(\"tf-test-cloudrun-srv%s\",
      context[\"random_suffix\"\
      ])"
    vars:
      cloud_run_service_name: 'cloudrun-srv'
      cloud_run_sql_name: 'cloudrun-sql'
      deletion_protection: 'true'
    test_vars_overrides:
      deletion_protection: 'false'
    oics_vars_overrides:
      deletion_protection: 'false'
    ignore_read_extra:
      - 'autogenerate_revision_name'
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_noauth'
    primary_resource_id: 'default'
    primary_resource_name: "fmt.Sprintf(\"tf-test-cloudrun-srv%s\",
      context[\"random_suffix\"\
      ])"
    vars:
      cloud_run_service_name: 'cloudrun-srv'
    test_env_vars:
      project: :PROJECT_NAME
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_multiple_environment_variables'
    primary_resource_id: 'default'
    primary_resource_name: "fmt.Sprintf(\"tf-test-cloudrun-srv%s\",
      context[\"random_suffix\"\
      ])"
    vars:
      cloud_run_service_name: 'cloudrun-srv'
    test_env_vars:
      project: :PROJECT_NAME
    ignore_read_extra:
      - 'autogenerate_revision_name'
    skip_docs: true
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_secret_environment_variables'
    primary_resource_id: 'default'
    primary_resource_name: "fmt.Sprintf(\"tf-test-cloudrun-srv%s\",
      context[\"random_suffix\"\
      ])"
    vars:
      cloud_run_service_name: 'cloudrun-srv'
      secret_id: 'secret'
    test_env_vars:
      project: :PROJECT_NAME
    ignore_read_extra:
      - 'autogenerate_revision_name'
    skip_docs: true
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_secret_volumes'
    primary_resource_id: 'default'
    primary_resource_name: "fmt.Sprintf(\"tf-test-cloudrun-srv%s\",
      context[\"random_suffix\"\
      ])"
    vars:
      cloud_run_service_name: 'cloudrun-srv'
      secret_id: 'secret'
    test_env_vars:
      project: :PROJECT_NAME
    ignore_read_extra:
      - 'autogenerate_revision_name'
    skip_docs: true
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_probes'
    primary_resource_id: 'default'
    vars:
      cloud_run_service_name: 'cloudrun-srv'
    test_env_vars:
      project: :PROJECT_NAME
  - !ruby/object:Provider::Terraform::Examples
    name: 'cloud_run_service_multicontainer'
    min_version: beta
    primary_resource_id: 'default'
    vars:
      cloud_run_service_name: 'cloudrun-srv'
    test_env_vars:
      project: :PROJECT_NAME
virtual_fields:
  - !ruby/object:Api::Type::Boolean
    name: 'autogenerate_revision_name'
    default_value: false
    description: |
      If set to `true`, the revision name (template.metadata.name) will be omitted and
      autogenerated by Cloud Run. This cannot be set to `true` while `template.metadata.name`
      is also set.
      (For legacy support, if `template.metadata.name` is unset in state while
      this field is set to false, the revision name will still autogenerate.)
custom_code: !ruby/object:Provider::Terraform::CustomCode
  encoder: 'templates/terraform/encoders/cloud_run_service.go.erb'
  decoder: 'templates/terraform/decoders/cloud_run.go.erb'
  constants: templates/terraform/constants/cloud_run_service.go.erb
custom_diff: [
  'revisionNameCustomizeDiff',
]
state_upgraders: true
state_upgrade_base_schema_version: 1
schema_version: 2
parameters:
  - !ruby/object:Api::Type::String
    name: location
    description: The location of the cloud run instance. eg us-central1
    url_param_only: true
    required: true
    immutable: true
properties:
  - !ruby/object:Api::Type::String
    name: name
    # This is a convenience field as terraform expects `name` to be a top level property
    url_param_only: true
    immutable: true
    description: |-
      Name must be unique within a Google Cloud project and region.
      Is required when creating resources. Name is primarily intended
      for creation idempotence and configuration definition. Cannot be updated.
      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
    required: true
  - !ruby/object:Api::Type::NestedObject
    name: spec
    required: true
    description: Spec holds the desired state of the Service (from the client).
    flatten_object: true
    properties:
      - !ruby/object:Api::Type::Array
        name: traffic
        description: |-
          Traffic specifies how to distribute traffic over a collection of Knative Revisions
          and Configurations
        default_from_api: true
        item_type: !ruby/object:Api::Type::NestedObject
          properties:
            - !ruby/object:Api::Type::String
              name: revisionName
              description: |-
                RevisionName of a specific revision to which to send this portion of traffic.
            - !ruby/object:Api::Type::Integer
              name: percent
              required: true
              description: |-
                Percent specifies percent of the traffic to this Revision or Configuration.
            - !ruby/object:Api::Type::String
              name: tag
              description: |-
                Tag is optionally used to expose a dedicated url for referencing this target exclusively.
            - !ruby/object:Api::Type::Boolean
              name: latestRevision
              description: |-
                LatestRevision may be optionally provided to indicate that the latest ready
                Revision of the Configuration should be used for this traffic target. When
                provided LatestRevision must be true if RevisionName is empty; it must be
                false when RevisionName is non-empty.
            - !ruby/object:Api::Type::String
              name: url
              output: true
              description: |-
                URL displays the URL for accessing tagged traffic targets. URL is displayed in status,
                and is disallowed on spec. URL must contain a scheme (e.g. http://) and a hostname,
                but may not contain anything else (e.g. basic auth, url path, etc.)
      - !ruby/object:Api::Type::NestedObject
        name: template
        description: |-
          template holds the latest specification for the Revision to
          be stamped out. The template references the container image, and may also
          include labels and annotations that should be attached to the Revision.
          To correlate a Revision, and/or to force a Revision to be created when the
          spec doesn't otherwise change, a nonce label may be provided in the
          template metadata. For more details, see:
          https://github.com/knative/serving/blob/main/docs/client-conventions.md#associate-modifications-with-revisions

          Cloud Run does not currently support referencing a build that is
          responsible for materializing the container image from source.
        properties:
          - !ruby/object:Api::Type::NestedObject
            name: metadata
            description: |-
              Optional metadata for this Revision, including labels and annotations.
              Name will be generated by the Configuration. To set minimum instances
              for this revision, use the "autoscaling.knative.dev/minScale" annotation
              key. To set maximum instances for this revision, use the
              "autoscaling.knative.dev/maxScale" annotation key. To set Cloud SQL
              connections for the revision, use the "run.googleapis.com/cloudsql-instances"
              annotation key.
            default_from_api: true
            properties:
              - !ruby/object:Api::Type::KeyValuePairs
                name: 'labels'
                description: |-
                  Map of string keys and values that can be used to organize and categorize
                  (scope and select) objects.
                default_from_api: true
                diff_suppress_func: 'cloudrunTemplateLabelDiffSuppress'
              - !ruby/object:Api::Type::Integer
                name: generation
                description: |-
                  A sequence number representing a specific generation of the desired state.
                output: true
              - !ruby/object:Api::Type::String
                name: resourceVersion
                description: |-
                  An opaque value that represents the internal version of this object that
                  can be used by clients to determine when objects have changed. May be used
                  for optimistic concurrency, change detection, and the watch operation on a
                  resource or set of resources. They may only be valid for a
                  particular resource or set of resources.
                output: true
              - !ruby/object:Api::Type::String
                name: selfLink
                description: |-
                  SelfLink is a URL representing this object.
                output: true
              - !ruby/object:Api::Type::String
                name: uid
                description: |-
                  UID is a unique id generated by the server on successful creation of a resource and is not
                  allowed to change on PUT operations.
                output: true
              - !ruby/object:Api::Type::String
                name: namespace
                description: |-
                  In Cloud Run the namespace must be equal to either the
                  project ID or project number. It will default to the resource's project.
                default_from_api: true
                custom_expand: 'templates/terraform/custom_expand/default_to_project.go.erb'
              - !ruby/object:Api::Type::KeyValuePairs
                name: 'annotations'
                description: |-
                  Annotations is a key value map stored with a resource that
                  may be set by external tools to store and retrieve arbitrary metadata.
                  More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations

                  **Note**: The Cloud Run API may add additional annotations that were not provided in your config.
                  If terraform plan shows a diff where a server-side annotation is added, you can add it to your config
                  or apply the lifecycle.ignore_changes rule to the metadata.0.annotations field.

                  Annotations with `run.googleapis.com/` and `autoscaling.knative.dev` are restricted. Use the following annotation
                  keys to configure features on a Revision template:

                  - `autoscaling.knative.dev/maxScale` sets the [maximum number of container
                    instances](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--max-instances) of the Revision to run.
                  - `autoscaling.knative.dev/minScale` sets the [minimum number of container
                    instances](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--min-instances) of the Revision to run.
                  - `run.googleapis.com/client-name` sets the client name calling the Cloud Run API.
                  - `run.googleapis.com/cloudsql-instances` sets the [Cloud SQL
                    instances](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--add-cloudsql-instances) the Revision connects to.
                  - `run.googleapis.com/cpu-throttling` sets whether to throttle the CPU when the container is not actively serving
                    requests. See https://cloud.google.com/sdk/gcloud/reference/run/deploy#--[no-]cpu-throttling.
                  - `run.googleapis.com/encryption-key-shutdown-hours` sets the number of hours to wait before an automatic shutdown
                    server after CMEK key revocation is detected.
                  - `run.googleapis.com/encryption-key` sets the [CMEK key](https://cloud.google.com/run/docs/securing/using-cmek)
                    reference to encrypt the container with.
                  - `run.googleapis.com/execution-environment` sets the [execution
                    environment](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--execution-environment)
                    where the application will run.
                  - `run.googleapis.com/post-key-revocation-action-type` sets the
                    [action type](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--post-key-revocation-action-type)
                    after CMEK key revocation.
                  - `run.googleapis.com/secrets` sets a list of key-value pairs to set as
                    [secrets](https://cloud.google.com/run/docs/configuring/secrets#yaml).
                  - `run.googleapis.com/sessionAffinity` sets whether to enable
                    [session affinity](https://cloud.google.com/sdk/gcloud/reference/beta/run/deploy#--[no-]session-affinity)
                    for connections to the Revision.
                  - `run.googleapis.com/startup-cpu-boost` sets whether to allocate extra CPU to containers on startup.
                    See https://cloud.google.com/sdk/gcloud/reference/run/deploy#--[no-]cpu-boost.
                  - `run.googleapis.com/vpc-access-connector` sets a [VPC connector](https://cloud.google.com/run/docs/configuring/connecting-vpc#terraform_1)
                    for the Revision.
                  - `run.googleapis.com/vpc-access-egress` sets the outbound traffic to send through the VPC connector for this resource.
                    See https://cloud.google.com/sdk/gcloud/reference/run/deploy#--vpc-egress.
                default_from_api: true
                diff_suppress_func: 'cloudrunTemplateAnnotationDiffSuppress'
              - !ruby/object:Api::Type::String
                name: name
                description: |-
                  Name must be unique within a Google Cloud project and region.
                  Is required when creating resources. Name is primarily intended
                  for creation idempotence and configuration definition. Cannot be updated.
                custom_expand: 'templates/terraform/custom_expand/cloud_run_service_revision_name.erb'
                default_from_api: true
          - !ruby/object:Api::Type::NestedObject
            name: spec
            required: true
            description:
              RevisionSpec holds the desired state of the Revision (from the
              client).
            default_from_api: true
            properties:
              - !ruby/object:Api::Type::Array
                name: containers
                update_verb: :PUT
                required: true
                description: |-
                  Containers defines the unit of execution for this Revision.
                default_from_api: true
                item_type: !ruby/object:Api::Type::NestedObject
                  properties:
                    - !ruby/object:Api::Type::String
                      name: name
                      description: Name of the container
                      default_from_api: true
                    - !ruby/object:Api::Type::String
                      deprecation_message: >-
                        `working_dir` is deprecated and will be removed in a future major release. This field is not supported by the Cloud Run API.
                      name: workingDir
                      immutable: true
                      description: |-
                        Container's working directory.
                        If not specified, the container runtime's default will be used, which
                        might be configured in the container image.
                    - !ruby/object:Api::Type::Array
                      name: args
                      description: |-
                        Arguments to the entrypoint.
                        The docker image's CMD is used if this is not provided.
                      item_type: Api::Type::String
                    - !ruby/object:Api::Type::Array
                      name: envFrom
                      deprecation_message: >-
                        `env_from` is deprecated and will be removed in a future major release. This field is not supported by the Cloud Run API.
                      immutable: true
                      description: |-
                        List of sources to populate environment variables in the container.
                        All invalid keys will be reported as an event when the container is starting.
                        When a key exists in multiple sources, the value associated with the last source will
                        take precedence. Values defined by an Env with a duplicate key will take
                        precedence.
                      item_type: !ruby/object:Api::Type::NestedObject
                        properties:
                          - !ruby/object:Api::Type::String
                            name: prefix
                            description: |-
                              An optional identifier to prepend to each key in the ConfigMap.
                          - !ruby/object:Api::Type::NestedObject
                            name: configMapRef
                            description: |-
                              The ConfigMap to select from.
                            properties:
                              - !ruby/object:Api::Type::Boolean
                                name: optional
                                description: |-
                                  Specify whether the ConfigMap must be defined
                              - !ruby/object:Api::Type::NestedObject
                                name: localObjectReference
                                description: The ConfigMap to select from.
                                properties:
                                  - !ruby/object:Api::Type::String
                                    name: name
                                    required: true
                                    description: |-
                                      Name of the referent.
                          - !ruby/object:Api::Type::NestedObject
                            name: secretRef
                            description: |-
                              The Secret to select from.
                            properties:
                              - !ruby/object:Api::Type::NestedObject
                                name: localObjectReference
                                description: The Secret to select from.
                                properties:
                                  - !ruby/object:Api::Type::String
                                    name: name
                                    required: true
                                    description: |-
                                      Name of the referent.
                              - !ruby/object:Api::Type::Boolean
                                name: optional
                                description: |-
                                  Specify whether the Secret must be defined
                    - !ruby/object:Api::Type::String
                      name: image
                      required: true
                      description: |-
                        Docker image name. This is most often a reference to a container located
                        in the container registry, such as gcr.io/cloudrun/hello
                    - !ruby/object:Api::Type::Array
                      name: command
                      description: |-
                        Entrypoint array. Not executed within a shell.
                        The docker image's ENTRYPOINT is used if this is not provided.
                      item_type: Api::Type::String
                    - !ruby/object:Api::Type::Array
                      name: env
                      description: |-
                        List of environment variables to set in the container.
                      is_set: true
                      item_type: !ruby/object:Api::Type::NestedObject
                        properties:
                          - !ruby/object:Api::Type::String
                            name: name
                            description: Name of the environment variable.
                          - !ruby/object:Api::Type::String
                            name: value
                            description: |-
                              Defaults to "".
                          - !ruby/object:Api::Type::NestedObject
                            name: valueFrom
                            description: |-
                              Source for the environment variable's value. Only supports secret_key_ref.
                            properties:
                              - !ruby/object:Api::Type::NestedObject
                                name: secretKeyRef
                                required: true
                                description: |-
                                  Selects a key (version) of a secret in Secret Manager.
                                properties:
                                  - !ruby/object:Api::Type::String
                                    name: key
                                    required: true
                                    description: |-
                                      A Cloud Secret Manager secret version. Must be 'latest' for the latest
                                      version or an integer for a specific version.
                                  - !ruby/object:Api::Type::String
                                    name: name
                                    required: true
                                    description: |-
                                      The name of the secret in Cloud Secret Manager. By default, the secret is assumed to be in the same project.
                                      If the secret is in another project, you must define an alias.
                                      An alias definition has the form: :projects/{project-id|project-number}/secrets/.
                                      If multiple alias definitions are needed, they must be separated by commas.
                                      The alias definitions must be set on the run.googleapis.com/secrets annotation.
                    - !ruby/object:Api::Type::Array
                      name: ports
                      description: |-
                        List of open ports in the container.
                      default_from_api: true
                      item_type: !ruby/object:Api::Type::NestedObject
                        properties:
                          - !ruby/object:Api::Type::String
                            name: name
                            description:
                              If specified, used to specify which protocol to
                              use. Allowed values are "http1" (HTTP/1) and "h2c"
                              (HTTP/2 end-to-end). Defaults to "http1".
                            default_from_api: true
                          - !ruby/object:Api::Type::String
                            name: protocol
                            description:
                              Protocol for port. Must be "TCP". Defaults to
                              "TCP".
                          - !ruby/object:Api::Type::Integer
                            name: containerPort
                            description:
                              Port number the container listens on. This must be
                              a valid port number (between 1 and 65535).
                              Defaults to "8080".
                    - !ruby/object:Api::Type::NestedObject
                      name: resources
                      description: |-
                        Compute Resources required by this container. Used to set values such as max memory
                      default_from_api: true
                      properties:
                        - !ruby/object:Api::Type::KeyValuePairs
                          name: limits
                          description: |-
                            Limits describes the maximum amount of compute resources allowed.
                            The values of the map is string form of the 'quantity' k8s type:
                            https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apimachinery/pkg/api/resource/quantity.go
                          default_from_api: true
                        - !ruby/object:Api::Type::KeyValuePairs
                          name: requests
                          description: |-
                            Requests describes the minimum amount of compute resources required.
                            If Requests is omitted for a container, it defaults to Limits if that is
                            explicitly specified, otherwise to an implementation-defined value.
                            The values of the map is string form of the 'quantity' k8s type:
                            https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apimachinery/pkg/api/resource/quantity.go
                    - !ruby/object:Api::Type::Array
                      name: volumeMounts
                      description: |-
                        Volume to mount into the container's filesystem.
                        Only supports SecretVolumeSources.
                      item_type: !ruby/object:Api::Type::NestedObject
                        properties:
                          - !ruby/object:Api::Type::String
                            name: mountPath
                            required: true
                            description: |-
                              Path within the container at which the volume should be mounted.  Must
                              not contain ':'.
                          - !ruby/object:Api::Type::String
                            name: name
                            required: true
                            description: |-
                              This must match the Name of a Volume.
                    - !ruby/object:Api::Type::NestedObject
                      name: startupProbe
                      description: |-
                        Startup probe of application within the container.
                        All other probes are disabled if a startup probe is provided, until it
                        succeeds. Container will not be added to service endpoints if the probe fails.
                      default_from_api: true
                      properties:
                        - !ruby/object:Api::Type::Integer
                          name: initialDelaySeconds
                          description: |-
                            Number of seconds after the container has started before the probe is
                            initiated.
                            Defaults to 0 seconds. Minimum value is 0. Maximum value is 240.
                          default_value: 0
                        - !ruby/object:Api::Type::Integer
                          name: timeoutSeconds
                          description: |-
                            Number of seconds after which the probe times out.
                            Defaults to 1 second. Minimum value is 1. Maximum value is 3600.
                            Must be smaller than periodSeconds.
                          default_value: 1
                        - !ruby/object:Api::Type::Integer
                          name: periodSeconds
                          description: |-
                            How often (in seconds) to perform the probe.
                            Default to 10 seconds. Minimum value is 1. Maximum value is 240.
                          default_value: 10
                        - !ruby/object:Api::Type::Integer
                          name: failureThreshold
                          description: |-
                            Minimum consecutive failures for the probe to be considered failed after
                            having succeeded. Defaults to 3. Minimum value is 1.
                          default_value: 3
                        - !ruby/object:Api::Type::NestedObject
                          name: tcpSocket
                          description: |-
                            TcpSocket specifies an action involving a TCP port.
                          exactly_one_of:
                            - template.0.spec.0.containers.0.startup_probe.0.tcp_socket
                            - template.0.spec.0.containers.0.startup_probe.0.http_get
                            - template.0.spec.0.containers.0.startup_probe.0.grpc
                          send_empty_value: true
                          allow_empty_object: true
                          properties:
                            - !ruby/object:Api::Type::Integer
                              name: port
                              description: |-
                                Port number to access on the container. Number must be in the range 1 to 65535.
                                If not specified, defaults to the same value as container.ports[0].containerPort.
                              default_from_api: true
                        - !ruby/object:Api::Type::NestedObject
                          name: httpGet
                          description: |-
                            HttpGet specifies the http request to perform.
                          exactly_one_of:
                            - template.0.spec.0.containers.0.startup_probe.0.tcp_socket
                            - template.0.spec.0.containers.0.startup_probe.0.http_get
                            - template.0.spec.0.containers.0.startup_probe.0.grpc
                          send_empty_value: true
                          allow_empty_object: true
                          properties:
                            - !ruby/object:Api::Type::String
                              name: path
                              description: |-
                                Path to access on the HTTP server. If set, it should not be empty string.
                              default_value: '/'
                            - !ruby/object:Api::Type::Integer
                              name: port
                              description: |-
                                Port number to access on the container. Number must be in the range 1 to 65535.
                                If not specified, defaults to the same value as container.ports[0].containerPort.
                              default_from_api: true
                            - !ruby/object:Api::Type::Array
                              name: httpHeaders
                              description: |-
                                Custom headers to set in the request. HTTP allows repeated headers.
                              item_type: !ruby/object:Api::Type::NestedObject
                                properties:
                                  - !ruby/object:Api::Type::String
                                    name: name
                                    description: |-
                                      The header field name.
                                    required: true
                                  - !ruby/object:Api::Type::String
                                    name: value
                                    description: |-
                                      The header field value.
                                    default_value: ''
                                    send_empty_value: true
                        - !ruby/object:Api::Type::NestedObject
                          name: grpc
                          description: |-
                            GRPC specifies an action involving a GRPC port.
                          exactly_one_of:
                            - template.0.spec.0.containers.0.startup_probe.0.tcp_socket
                            - template.0.spec.0.containers.0.startup_probe.0.http_get
                            - template.0.spec.0.containers.0.startup_probe.0.grpc
                          send_empty_value: true
                          allow_empty_object: true
                          properties:
                            - !ruby/object:Api::Type::Integer
                              name: port
                              description: |-
                                Port number to access on the container. Number must be in the range 1 to 65535.
                                If not specified, defaults to the same value as container.ports[0].containerPort.
                              default_from_api: true
                            - !ruby/object:Api::Type::String
                              name: service
                              description: |-
                                The name of the service to place in the gRPC HealthCheckRequest
                                (see https://github.com/grpc/grpc/blob/master/doc/health-checking.md).
                                If this is not specified, the default behavior is defined by gRPC.
                    - !ruby/object:Api::Type::NestedObject
                      name: livenessProbe
                      description: |-
                        Periodic probe of container liveness. Container will be restarted if the probe fails.
                      properties:
                        - !ruby/object:Api::Type::Integer
                          name: initialDelaySeconds
                          description: |-
                            Number of seconds after the container has started before the probe is
                            initiated.
                            Defaults to 0 seconds. Minimum value is 0. Maximum value is 3600.
                          default_value: 0
                        - !ruby/object:Api::Type::Integer
                          name: timeoutSeconds
                          description: |-
                            Number of seconds after which the probe times out.
                            Defaults to 1 second. Minimum value is 1. Maximum value is 3600.
                            Must be smaller than period_seconds.
                          default_value: 1
                        - !ruby/object:Api::Type::Integer
                          name: periodSeconds
                          description: |-
                            How often (in seconds) to perform the probe.
                            Default to 10 seconds. Minimum value is 1. Maximum value is 3600.
                          default_value: 10
                        - !ruby/object:Api::Type::Integer
                          name: failureThreshold
                          description: |-
                            Minimum consecutive failures for the probe to be considered failed after
                            having succeeded. Defaults to 3. Minimum value is 1.
                          default_value: 3
                        - !ruby/object:Api::Type::NestedObject
                          name: httpGet
                          description: |-
                            HttpGet specifies the http request to perform.
                          exactly_one_of:
                            - template.0.spec.0.containers.0.liveness_probe.0.http_get
                            - template.0.spec.0.containers.0.liveness_probe.0.grpc
                          send_empty_value: true
                          allow_empty_object: true
                          properties:
                            - !ruby/object:Api::Type::String
                              name: path
                              description: |-
                                Path to access on the HTTP server. If set, it should not be empty string.
                              default_value: '/'
                            - !ruby/object:Api::Type::Integer
                              name: port
                              description: |-
                                Port number to access on the container. Number must be in the range 1 to 65535.
                                If not specified, defaults to the same value as container.ports[0].containerPort.
                              default_from_api: true
                            - !ruby/object:Api::Type::Array
                              name: httpHeaders
                              description: |-
                                Custom headers to set in the request. HTTP allows repeated headers.
                              item_type: !ruby/object:Api::Type::NestedObject
                                properties:
                                  - !ruby/object:Api::Type::String
                                    name: name
                                    description: |-
                                      The header field name.
                                    required: true
                                  - !ruby/object:Api::Type::String
                                    name: value
                                    description: |-
                                      The header field value.
                                    default_value: ''
                                    send_empty_value: true
                        - !ruby/object:Api::Type::NestedObject
                          name: grpc
                          description: |-
                            GRPC specifies an action involving a GRPC port.
                          exactly_one_of:
                            - template.0.spec.0.containers.0.liveness_probe.0.http_get
                            - template.0.spec.0.containers.0.liveness_probe.0.grpc
                          send_empty_value: true
                          allow_empty_object: true
                          properties:
                            - !ruby/object:Api::Type::Integer
                              name: port
                              description: |-
                                Port number to access on the container. Number must be in the range 1 to 65535.
                                If not specified, defaults to the same value as container.ports[0].containerPort.
                              default_from_api: true
                            - !ruby/object:Api::Type::String
                              name: service
                              description: |-
                                The name of the service to place in the gRPC HealthCheckRequest
                                (see https://github.com/grpc/grpc/blob/master/doc/health-checking.md).
                                If this is not specified, the default behavior is defined by gRPC.

              - !ruby/object:Api::Type::Integer
                name: containerConcurrency
                description: |-
                  ContainerConcurrency specifies the maximum allowed in-flight (concurrent)
                  requests per container of the Revision. If not specified or 0, defaults to 80 when
                  requested CPU >= 1 and defaults to 1 when requested CPU < 1.
                default_from_api: true
              - !ruby/object:Api::Type::Integer
                name: timeoutSeconds
                description: |-
                  TimeoutSeconds holds the max duration the instance is allowed for responding to a request.
                default_from_api: true
              - !ruby/object:Api::Type::String
                name: serviceAccountName
                description: |-
                  Email address of the IAM service account associated with the revision of the
                  service. The service account represents the identity of the running revision,
                  and determines what permissions the revision has. If not provided, the revision
                  will use the project's default service account.
                default_from_api: true
              - !ruby/object:Api::Type::Array
                name: volumes
                description: |-
                  Volume represents a named volume in a container.
                item_type: !ruby/object:Api::Type::NestedObject
                  properties:
                    - !ruby/object:Api::Type::String
                      name: name
                      required: true
                      description: |-
                        Volume's name.
                    - !ruby/object:Api::Type::NestedObject
                      name: secret
                      description: |-
                        The secret's value will be presented as the content of a file whose
                        name is defined in the item path. If no items are defined, the name of
                        the file is the secret_name.
                      properties:
                        - !ruby/object:Api::Type::String
                          name: secretName
                          required: true
                          description: |-
                            The name of the secret in Cloud Secret Manager. By default, the secret
                            is assumed to be in the same project.
                            If the secret is in another project, you must define an alias.
                            An alias definition has the form:
                            {alias}:projects/{project-id|project-number}/secrets/{secret-name}.
                            If multiple alias definitions are needed, they must be separated by
                            commas.
                            The alias definitions must be set on the run.googleapis.com/secrets
                            annotation.
                        - !ruby/object:Api::Type::Integer
                          name: defaultMode
                          description: |-
                            Mode bits to use on created files by default. Must be a value between 0000
                            and 0777. Defaults to 0644. Directories within the path are not affected by
                            this setting. This might be in conflict with other options that affect the
                            file mode, like fsGroup, and the result can be other mode bits set.
                        - !ruby/object:Api::Type::Array
                          name: items
                          description: |-
                            If unspecified, the volume will expose a file whose name is the
                            secret_name.
                            If specified, the key will be used as the version to fetch from Cloud
                            Secret Manager and the path will be the name of the file exposed in the
                            volume. When items are defined, they must specify a key and a path.
                          item_type: !ruby/object:Api::Type::NestedObject
                            properties:
                              - !ruby/object:Api::Type::String
                                name: key
                                required: true
                                description: |-
                                  The Cloud Secret Manager secret version.
                                  Can be 'latest' for the latest value or an integer for a specific version.
                              - !ruby/object:Api::Type::String
                                name: path
                                required: true
                                description: |-
                                  The relative path of the file to map the key to.
                                  May not be an absolute path.
                                  May not contain the path element '..'.
                                  May not start with the string '..'.
                              - !ruby/object:Api::Type::Integer
                                name: mode
                                description: |-
                                  Mode bits to use on this file, must be a value between 0000 and 0777. If
                                  not specified, the volume defaultMode will be used. This might be in
                                  conflict with other options that affect the file mode, like fsGroup, and
                                  the result can be other mode bits set.
                    - !ruby/object:Api::Type::NestedObject
                      name: emptyDir
                      description: |-
                        Ephemeral storage which can be backed by real disks (HD, SSD), network storage or memory (i.e. tmpfs). For now only in memory (tmpfs) is supported. It is ephemeral in the sense that when the sandbox is taken down, the data is destroyed with it (it does not persist across sandbox runs).
                      min_version: beta
                      properties:
                        - !ruby/object:Api::Type::String
                          name: 'medium'
                          description: |-
                            The medium on which the data is stored. The default is "" which means to use the node's default medium. Must be an empty string (default) or Memory.
                        - !ruby/object:Api::Type::String
                          name: 'sizeLimit'
                          description: |-
                            Limit on the storage usable by this EmptyDir volume. The size limit is also applicable for memory medium. The maximum usage on memory medium EmptyDir would be the minimum value between the SizeLimit specified here and the sum of memory limits of all containers in a pod. This field's values are of the 'Quantity' k8s type: https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/quantity/. The default is nil which means that the limit is undefined. More info: https://kubernetes.io/docs/concepts/storage/volumes/#emptydir.
                    - !ruby/object:Api::Type::NestedObject
                      name: csi
                      description: |-
                        A filesystem specified by the Container Storage Interface (CSI).
                      min_version: beta
                      properties:
                        - !ruby/object:Api::Type::String
                          name: 'driver'
                          required: true
                          description: |-
                            Unique name representing the type of file system to be created. Cloud Run supports the following values:
                              * gcsfuse.run.googleapis.com: Mount a Google Cloud Storage bucket using GCSFuse. This driver requires the
                                run.googleapis.com/execution-environment annotation to be set to "gen2" and
                                run.googleapis.com/launch-stage set to "BETA" or "ALPHA".
                        - !ruby/object:Api::Type::Boolean
                          name: 'readOnly'
                          default_from_api: true
                          description: |-
                            If true, all mounts created from this volume will be read-only.
                        - !ruby/object:Api::Type::KeyValuePairs
                          name: 'volumeAttributes'
                          description: |-
                            Driver-specific attributes. The following options are supported for available drivers:
                              * gcsfuse.run.googleapis.com
                                * bucketName: The name of the Cloud Storage Bucket that backs this volume. The Cloud Run Service identity must have access to this bucket.
                    - !ruby/object:Api::Type::NestedObject
                      name: nfs
                      description: |-
                        A filesystem backed by a Network File System share. This filesystem requires the
                        run.googleapis.com/execution-environment annotation to be set to "gen2" and
                        run.googleapis.com/launch-stage set to "BETA" or "ALPHA".
                      min_version: beta
                      properties:
                        - !ruby/object:Api::Type::String
                          name: server
                          required: true
                          description: |-
                            IP address or hostname of the NFS server
                        - !ruby/object:Api::Type::String
                          name: path
                          required: true
                          description: |-
                            Path exported by the NFS server
                        - !ruby/object:Api::Type::Boolean
                          name: readOnly
                          description: |-
                            If true, mount the NFS volume as read only in all mounts. Defaults to false.
              - !ruby/object:Api::Type::Enum
                name: servingState
                deprecation_message: >-
                  `serving_state` is deprecated and will be removed in a future major release. This field is not supported by the Cloud Run API.
                description: |-
                  ServingState holds a value describing the state the resources
                  are in for this Revision.
                  It is expected
                  that the system will manipulate this based on routability and load.
                output: true
                values:
                  - :ACTIVE
                  - :RESERVE
                  - :RETIRED

  - !ruby/object:Api::Type::NestedObject
    name: status
    description: The current status of the Service.
    output: true
    properties:
      - !ruby/object:Api::Type::Array
        name: conditions
        description: |-
          Array of observed Service Conditions, indicating the current ready state of the service.
        output: true
        item_type: !ruby/object:Api::Type::NestedObject
          properties:
            - !ruby/object:Api::Type::String
              name: message
              output: true
              description: |-
                Human readable message indicating details about the current status.
            - !ruby/object:Api::Type::String
              name: status
              output: true
              description: Status of the condition, one of True, False, Unknown.
            - !ruby/object:Api::Type::String
              name: reason
              output: true
              description: |-
                One-word CamelCase reason for the condition's current status.
            - !ruby/object:Api::Type::String
              name: type
              output: true
              description: Type of domain mapping condition.
      - !ruby/object:Api::Type::String
        name: url
        description: |-
          From RouteStatus. URL holds the url that will distribute traffic over the provided traffic
          targets. It generally has the form
          https://{route-hash}-{project-hash}-{cluster-level-suffix}.a.run.app
        output: true
      - !ruby/object:Api::Type::Integer
        name: observedGeneration
        description: |-
          ObservedGeneration is the 'Generation' of the Route that was last processed by the
          controller.

          Clients polling for completed reconciliation should poll until observedGeneration =
          metadata.generation and the Ready condition's status is True or False.
        output: true
      - !ruby/object:Api::Type::String
        name: latestCreatedRevisionName
        description: |-
          From ConfigurationStatus. LatestCreatedRevisionName is the last revision that was created
          from this Service's Configuration. It might not be ready yet, for that use
          LatestReadyRevisionName.
        output: true
      - !ruby/object:Api::Type::String
        name: latestReadyRevisionName
        description: |-
          From ConfigurationStatus. LatestReadyRevisionName holds the name of the latest Revision
          stamped out from this Service's Configuration that has had its "Ready" condition become
          "True".
        output: true
      - !ruby/object:Api::Type::Array
        name: traffic
        description: |-
          Traffic specifies how to distribute traffic over a collection of Knative Revisions
          and Configurations
        output: true
        item_type: !ruby/object:Api::Type::NestedObject
          properties:
            - !ruby/object:Api::Type::String
              name: revisionName
              description: |-
                RevisionName of a specific revision to which to send this portion of traffic.
              output: true
            - !ruby/object:Api::Type::Integer
              name: percent
              output: true
              description: |-
                Percent specifies percent of the traffic to this Revision or Configuration.
            - !ruby/object:Api::Type::String
              name: tag
              output: true
              description: |-
                Tag is optionally used to expose a dedicated url for referencing this target exclusively.
            - !ruby/object:Api::Type::Boolean
              name: latestRevision
              output: true
              description: |-
                LatestRevision may be optionally provided to indicate that the latest ready
                Revision of the Configuration should be used for this traffic target. When
                provided LatestRevision must be true if RevisionName is empty; it must be
                false when RevisionName is non-empty.
            - !ruby/object:Api::Type::String
              name: url
              output: true
              description: |-
                URL displays the URL for accessing tagged traffic targets. URL is displayed in status,
                and is disallowed on spec. URL must contain a scheme (e.g. http://) and a hostname,
                but may not contain anything else (e.g. basic auth, url path, etc.)

  - !ruby/object:Api::Type::NestedObject
    name: metadata
    required: false
    description: |-
      Metadata associated with this Service, including name, namespace, labels,
      and annotations.
    default_from_api: true
    properties:
      - !ruby/object:Api::Type::KeyValueLabels
        name: 'labels'
        description: |-
          Map of string keys and values that can be used to organize and categorize
          (scope and select) objects. May match selectors of replication controllers
          and routes.
      - !ruby/object:Api::Type::Integer
        name: generation
        description: |-
          A sequence number representing a specific generation of the desired state.
        output: true
      - !ruby/object:Api::Type::String
        name: resourceVersion
        description: |-
          An opaque value that represents the internal version of this object that
          can be used by clients to determine when objects have changed. May be used
          for optimistic concurrency, change detection, and the watch operation on a
          resource or set of resources. They may only be valid for a
          particular resource or set of resources.
        output: true
      - !ruby/object:Api::Type::String
        name: selfLink
        description: |-
          SelfLink is a URL representing this object.
        output: true
      - !ruby/object:Api::Type::String
        name: uid
        description: |-
          UID is a unique id generated by the server on successful creation of a resource and is not
          allowed to change on PUT operations.
        output: true
      - !ruby/object:Api::Type::String
        name: namespace
        required: false
        description: |-
          In Cloud Run the namespace must be equal to either the
          project ID or project number.
        default_from_api: true
        custom_flatten: templates/terraform/custom_flatten/set_to_project.go.erb
        custom_expand: 'templates/terraform/custom_expand/default_to_project.go.erb'
      - !ruby/object:Api::Type::KeyValueAnnotations
        name: 'annotations'
        description: |-
          Annotations is a key value map stored with a resource that
          may be set by external tools to store and retrieve arbitrary metadata.
          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations

          **Note**: The Cloud Run API may add additional annotations that were not provided in your config.
          If terraform plan shows a diff where a server-side annotation is added, you can add it to your config
          or apply the lifecycle.ignore_changes rule to the metadata.0.annotations field.

          Annotations with `run.googleapis.com/` and `autoscaling.knative.dev` are restricted. Use the following annotation
          keys to configure features on a Service:

          - `run.googleapis.com/binary-authorization-breakglass` sets the [Binary Authorization breakglass](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--breakglass).
          - `run.googleapis.com/binary-authorization` sets the [Binary Authorization](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--binary-authorization).
          - `run.googleapis.com/client-name` sets the client name calling the Cloud Run API.
          - `run.googleapis.com/custom-audiences` sets the [custom audiences](https://cloud.google.com/sdk/gcloud/reference/alpha/run/deploy#--add-custom-audiences)
            that can be used in the audience field of ID token for authenticated requests.
          - `run.googleapis.com/description` sets a user defined description for the Service.
          - `run.googleapis.com/ingress` sets the [ingress settings](https://cloud.google.com/sdk/gcloud/reference/run/deploy#--ingress)
            for the Service. For example, `"run.googleapis.com/ingress" = "all"`.
          - `run.googleapis.com/launch-stage` sets the [launch stage](https://cloud.google.com/run/docs/troubleshooting#launch-stage-validation)
            when a preview feature is used. For example, `"run.googleapis.com/launch-stage": "BETA"`
