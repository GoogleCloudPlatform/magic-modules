# Copyright 2024 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: AnalysisRule
description: |
  The CCAI Insights project wide analysis rule.
  This rule will be applied to all conversations that match the filter defined in the rule.
  For a conversation matches the filter, the annotators specified in the rule will be run.
  If a conversation matches multiple rules, a union of all the annotators will be run.
  One project can have multiple analysis rules.
references:
  guides:
    'Configure analysis rules using the API': 'https://cloud.google.com/contact-center/insights/docs/analysis-rule'
  api: 'https://cloud.google.com/contact-center/insights/docs/reference/rest/v1/projects.locations.analysisRules'
base_url: projects/{{project}}/locations/{{location}}/analysisRules
self_link: projects/{{project}}/locations/{{location}}/analysisRules/{{name}}
create_url: projects/{{project}}/locations/{{location}}/analysisRules
delete_url: projects/{{project}}/locations/{{location}}/analysisRules/{{name}}
update_verb: 'PATCH'
update_mask: true
id_format: projects/{{project}}/locations/{{location}}/analysisRules/{{name}}
import_format:
  - projects/{{project}}/locations/{{location}}/analysisRules/{{name}}
examples:
  - name: 'contact_center_insights_analysis_rule_basic'
    primary_resource_id: 'basic_analysis_rule'
    test_env_vars:
      project_name: 'PROJECT_NAME'
  - name: 'contact_center_insights_analysis_rule_full'
    primary_resource_id: 'basic_analysis_full'
    test_env_vars:
      project_name: 'PROJECT_NAME'
  - name: 'contact_center_insights_analysis_rule_profile'
    primary_resource_id: 'basic_analysis_profile'
    test_env_vars:
      project_name: 'PROJECT_NAME'
parameters:
  - name: location
    type: String
    description: Location of the resource.
    immutable: true
    url_param_only: true
    required: true
properties:
  - name: name
    type: String
    description: |-
      The resource name of the analysis rule. Randomly generated by Insights.
    output: true
    custom_flatten: 'templates/terraform/custom_flatten/name_from_self_link.tmpl'
  - name: createTime
    type: String
    description: Output only. The time at which this analysis rule was created.
    output: true
  - name: updateTime
    type: String
    description: Output only. The most recent time at which this analysis rule was updated.
    output: true
  - name: displayName
    type: String
    description: Display Name of the analysis rule.
  - name: conversationFilter
    type: String
    description: |-
      Filter for the conversations that should apply this analysis
      rule. An empty filter means this analysis rule applies to all
      conversations.
      Refer to https://cloud.google.com/contact-center/insights/docs/filtering
      for details.
  - name: annotatorSelector
    type: NestedObject
    description: Selector of all available annotators and phrase matchers to run.
    properties:
      - name: runInterruptionAnnotator
        type: Boolean
        description: Whether to run the interruption annotator.
      - name: phraseMatchers
        type: Array
        description: |-
          The list of phrase matchers to run. If not provided, all active phrase
          matchers will be used. If inactive phrase matchers are provided, they will
          not be used. Phrase matchers will be run only if
          run_phrase_matcher_annotator is set to true. Format:
          projects/{project}/locations/{location}/phraseMatchers/{phrase_matcher}
        item_type:
          type: String
      - name: runEntityAnnotator
        type: Boolean
        description: Whether to run the entity annotator.
      - name: issueModels
        type: Array
        description: |-
          The issue model to run. If not provided, the most recently deployed topic
          model will be used. The provided issue model will only be used for
          inference if the issue model is deployed and if run_issue_model_annotator
          is set to true. If more than one issue model is provided, only the first
          provided issue model will be used for inference.
        item_type:
          type: String
      - name: runQaAnnotator
        type: Boolean
        description: Whether to run the QA annotator.
      - name: runSilenceAnnotator
        type: Boolean
        description: Whether to run the silence annotator.
      - name: runPhraseMatcherAnnotator
        type: Boolean
        description: Whether to run the active phrase matcher annotator(s).
      - name: runSentimentAnnotator
        type: Boolean
        description: Whether to run the sentiment annotator.
      - name: runIntentAnnotator
        type: Boolean
        description: Whether to run the intent annotator.
      - name: runIssueModelAnnotator
        type: Boolean
        description: |-
          Whether to run the issue model annotator. A model should have already been
          deployed for this to take effect.
      - name: runSummarizationAnnotator
        type: Boolean
        description: Whether to run the summarization annotator.
      - name: summarizationConfig
        type: NestedObject
        description: Configuration for summarization.
        properties:
          - name: conversationProfile
            type: String
            description: |-
              Resource name of the Dialogflow conversation profile.
              Format:
              projects/{project}/locations/{location}/conversationProfiles/{conversation_profile}
          - name: summarizationModel
            type: String
            description: |-
              Default summarization model to be used.
              Possible values:
              SUMMARIZATION_MODEL_UNSPECIFIED
              BASELINE_MODEL
              BASELINE_MODEL_V2_0
      - name: qaConfig
        type: NestedObject
        description: Configuration for the QA feature.
        properties:
          - name: scorecardList
            type: NestedObject
            description: Container for a list of scorecards.
            properties:
              - name: qaScorecardRevisions
                type: Array
                description: List of QaScorecardRevisions.
                item_type:
                  type: String
  - name: analysisPercentage
    type: Double
    description: |-
      Percentage of conversations that we should apply this analysis setting
      automatically, between [0, 1]. For example, 0.1 means 10%. Conversations
      are sampled in a determenestic way. The original runtime_percentage &
      upload percentage will be replaced by defining filters on the conversation.
  - name: active
    type: Boolean
    description: |-
      If true, apply this rule to conversations. Otherwise, this rule is
      inactive and saved as a draft.
