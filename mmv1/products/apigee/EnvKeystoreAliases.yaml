# Copyright 2023 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
    name: 'EnvKeystoreAliases'
    base_url: '{{keystore_id}}/aliases/{{alias}}'
    create_url: '{{keystore_id}}/aliases?alias={{alias}}&format={{format}}'
    # get_csr_url: '{{keystore_id}}/aliases/{{alias}}/csr'
    # get_cert_url: '{{keystore_id}}/aliases/{{alias}}/certificate'
    self_link: '{{keystore_id}}/aliases/{{alias}}'
    delete_url: '{{keystore_id}}/aliases/{{alias}}'
    # get_aliases: '{{keystore_id}}/aliases'
    input: true 
    description: |
      An Environment Alias in Apigee
    parameters: 
      - !ruby/object:Api::Type::String
        name: 'contentType'
        input: true 
        description: |
          Pass Content Type  
      - !ruby/object:Api::Type::String
        name: 'keystoreId'
        description: |
          The Apigee environment group associated with the Apigee environment,
          in the format `organizations/{{org_name}}/environments/{{env_name}}`.
        required: true
        input: true
        url_param_only: true
      - !ruby/object:Api::Type::String
        name: 'alias'
        input: true
        description: |
          Alias for the key/certificate pair. Values must match the regular expression [\w\s-.]{1,255}. 
          This must be provided for all formats except selfsignedcert; self-signed certs may specify the alias in either 
          this parameter or the JSON body.
      - !ruby/object:Api::Type::String
        name: 'password'
        input: true 
        description: |
          Pass password
      - !ruby/object:Api::Type::String
        name: 'keyFile'
        input: true 
        description: |
          When key format is keycertfile, pass keyfile
      - !ruby/object:Api::Type::String
        name: 'certFile'
        input: true 
        description: |
          When key format is keycertfile, pass certfile
      - !ruby/object:Api::Type::String
        name: 'format'
        input: true
        required: true
        url_param_only: true
        description: | 
          Required. Format of the data. Valid values include: selfsignedcert, keycertfile, or pkcs12
    properties:
      - !ruby/object:Api::Type::NestedObject
        name: 'certsInfo'
        description: Chain of certificates under this alias.
        properties:
          - !ruby/object:Api::Type::Array
            name: 'certInfo'
            description: List of all properties in the object.
            item_type: !ruby/object:Api::Type::NestedObject
              properties:
                - !ruby/object:Api::Type::Integer
                  name: 'version'
                  description: X.509 version.
                - !ruby/object:Api::Type::String
                  name: 'subject'
                  description: X.509 subject.
                  input: true
                - !ruby/object:Api::Type::String
                  name: 'issuer'
                  description: X.509 issuer.
                - !ruby/object:Api::Type::String
                  name: 'expiryDate'
                  description: X.509 notAfter validity period in milliseconds since epoch.
                - !ruby/object:Api::Type::String
                  name: 'validFrom'
                  description: X.509 notBefore validity period in milliseconds since epoch.
                - !ruby/object:Api::Type::String
                  name: 'isValid'
                  description: | 
                    Flag that specifies whether the certificate is valid. 
                    Flag is set to Yes if the certificate is valid, No if expired, or Not yet if not yet valid.
                - !ruby/object:Api::Type::Array
                  name: 'subjectAlternativeNames'
                  description: X.509 subject alternative names (SANs) extension.
                  item_type: Api::Type::String
                - !ruby/object:Api::Type::String
                  name: 'sigAlgName'
                  description: X.509 signatureAlgorithm.
                - !ruby/object:Api::Type::String
                  name: 'publicKey'
                  description: Public key component of the X.509 subject public key info.
                - !ruby/object:Api::Type::String
                  name: 'basicConstraints'
                  description: X.509 basic constraints extension.
                - !ruby/object:Api::Type::String
                  name: 'serialNumber'
                  description: X.509 serial number.
      - !ruby/object:Api::Type::Enum
        name: 'type'
        output: true
        description: |
          Optional.Type of Alias
        values:
          - "ALIAS_TYPE_UNSPECIFIED"
          - "CERT"
          - "KEY_CERT"
    references: !ruby/object:Api::Resource::ReferenceLinks
      guides:
        'Creating an environment':
          'https://cloud.google.com/apigee/docs/api-platform/get-started/create-environment'
      api: 'https://cloud.google.com/apigee/docs/reference/apis/apigee/rest/v1/organizations.environments.keystores/create'