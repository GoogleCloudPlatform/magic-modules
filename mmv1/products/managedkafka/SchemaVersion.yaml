# Copyright 2024 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: 'SchemaVersion'
min_version: beta
description: A Managed Service for Apache Kafka schema registry version.
base_url: 'projects/{{project}}/locations/{{location}}/schemaRegistries/{{schema_registry_id}}/subjects/{{subject}}/versions?deleted={{deleted}}'
self_link: 'projects/{{project}}/locations/{{location}}/schemaRegistries/{{schema_registry_id}}/subjects/{{subject}}/versions/{{version}}?deleted={{deleted}}'

create_url: 'projects/{{project}}/locations/{{location}}/schemaRegistries/{{schema_registry_id}}/subjects/{{subject}}/versions'

delete_url: 'projects/{{project}}/locations/{{location}}/schemaRegistries/{{schema_registry_id}}/subjects/{{subject}}/versions/{{version}}?permanent={{permanent}}'

immutable: true

# We'll need to modify the url before making the request if a context is present
custom_code:
  pre_create: templates/terraform/pre_create/managedkafka_schema_version.go.tmpl
  pre_read: templates/terraform/pre_read/managedkafka_schema_version.go.tmpl
  pre_update: templates/terraform/pre_update/managedkafka_schema_version.go.tmpl
  pre_delete: templates/terraform/pre_delete/managedkafka_schema_version.go.tmpl

parameters:
  - name: 'location'
    type: String
    required: true
    immutable: true
    url_param_only: true
    description: "ID of the location of the Kafka resource. See
      https://cloud.google.com/managed-kafka/docs/locations for a list of
      supported locations."
  - name: 'schemaRegistryId'
    type: String
    required: true
    immutable: true
    url_param_only: true
    description: "ID of the schema_registry."
  - name: 'context'
    type: String
    required: false
    immutable: true
    url_param_only: true
    description: "Name of the context. It is optional. If not specified, it will use the default context."
  - name: 'subject'
    type: String
    required: true
    immutable: true
    url_param_only: true
    description: "Name of the subject."
  - name: 'version'
    type: Integer
    required: true
    immutable: true
    url_param_only: false
    description: "The version to create. It is optional. If not specified, the version will
      be created with the max version ID of the subject increased by 1. If the
      version ID is specified, it will be used as the new version ID and must not
      be used by an existing version of the subject."
  - name: 'deleted'
    type: Boolean
    url_param_only: true
    # Keep in mind changing the default_value is considered a breaking change.
    default_value: false
    description: "If true, the Get and List response will include soft-deleted versions. The default is false."
  - name: 'permanent'
    type: Boolean
    url_param_only: true
    default_value: false
    description: "If true, both the version and the referenced schema ID will be permanently
      deleted. The default is false."

properties:
  - name: 'schema_id'
    api_name: 'id'
    type: Integer
    description: "The schema ID of the schema. If not specified, the schema ID will be
      generated by the server. If the schema ID is specified, it must not be used
      by an existing schema that is different from the schema to be created."
  - name: 'schema_type'
    type: String
    description: "The type of the schema. It is optional. If not specified, the schema type will be AVRO."
  - name: 'schema'
    type: String
    description: "The schema payload."
    required: true
  - name: 'references'
    type: Array
    description: "The schema references used by the schema."
    item_type:
      type: String
  - name: 'normalize'
    type: Boolean
    description: "If true, the schema will be normalized before being stored. The default is false."
