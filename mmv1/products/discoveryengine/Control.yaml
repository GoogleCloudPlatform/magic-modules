# Copyright 2024 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: 'Control'
description: |
  Controls are rules that influence search results.
references:
  guides:
    'Configure serving controls': 'https://cloud.google.com/gemini/enterprise/docs/configure-serving-controls'
  api: 'https://cloud.google.com/gemini/enterprise/docs/reference/rest/v1/projects.locations.collections.engines.controls'
base_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/engines/{{engine_id}}/controls'
self_link: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/engines/{{engine_id}}/controls/{{control_id}}'
create_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/engines/{{engine_id}}/controls?controlId={{control_id}}'
update_verb: 'PATCH'
update_mask: true
import_format:
  - 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/engines/{{engine_id}}/controls/{{control_id}}'
timeouts:
  insert_minutes: 5
  update_minutes: 5
  delete_minutes: 5
examples:
  - name: 'discoveryengine_control_basic'
    primary_resource_id: 'basic'
    primary_resource_name: 'fmt.Sprintf("tf_test_control%s", context["random_suffix"])'
    vars:
      control_id: 'control-id'
      data_store_id: 'data-store-id'
      engine_id: 'engine-id'
parameters:
  - name: 'location'
    type: String
    description: |
      The geographic location where the data store should reside. The value can
      only be one of "global", "us" and "eu".
    url_param_only: true
    required: true
    immutable: true
  - name: 'collectionId'
    type: String
    description: 'The collection ID. Currently only accepts "default_collection".'
    url_param_only: true
    immutable: true
    default_value: 'default_collection'
  - name: 'engineId'
    type: String
    description: 'The engine to add the control to.'
    url_param_only: true
    required: true
    immutable: true
  - name: 'controlId'
    type: String
    description: 'The unique id of the control.'
    url_param_only: true
    required: true
    immutable: true
properties:
  - name: 'name'
    type: String
    description: |
      The unique full resource name of the control. Values are of the format
      `projects/{project}/locations/{location}/collections/{collection_id}/engines/{engine_id}/controls/{control_id}`.
      This field must be a UTF-8 encoded string with a length limit of 1024
      characters.
    output: true
  - name: 'displayName'
    type: String
    description: |
      The display name of the control. This field must be a UTF-8 encoded
      string with a length limit of 128 characters.
    required: true
  - name: 'solutionType'
    type: Enum
    description: |
      The solution type that the control belongs to.
    required: true
    immutable: true
    enum_values:
      - 'SOLUTION_TYPE_RECOMMENDATION'
      - 'SOLUTION_TYPE_SEARCH'
      - 'SOLUTION_TYPE_CHAT'
      - 'SOLUTION_TYPE_GENERATIVE_CHAT'
  - name: 'useCases'
    type: Array
    description: |
      The use cases that the control is used for.
    item_type:
      type: Enum
      enum_values:
        - 'SEARCH_USE_CASE_SEARCH'
        - 'SEARCH_USE_CASE_BROWSE'
  - name: 'conditions'
    type: Array
    description: |
      The conditions under which the control is active.
    item_type:
      type: NestedObject
      properties:
        - name: 'queryTerms'
          type: Array
          description: |
            The query terms that must be present in the search request for this condition to be met.
          item_type:
            type: NestedObject
            properties:
              - name: 'value'
                type: String
                description: 'The value of the query term.'
              - name: 'fullMatch'
                type: Boolean
                description: |
                  If true, the query term must be an exact match. Otherwise, the query term can be a partial match.
        - name: 'activeTimeRange'
          type: Array
          description: |
            The time range when the condition is active.
          item_type:
            type: NestedObject
            properties:
              - name: 'startTime'
                type: Time
                description: |
                  The start time of the active time range.
              - name: 'endTime'
                type: Time
                description: |
                  The end time of the active time range.
        - name: 'queryRegex'
          type: String
          description: |
            The regular expression that the query must match for this condition to be met.
  - name: 'boostAction'
    type: NestedObject
    description: |
      Changes the returned order of results.
    update_mask_fields:
      - 'boost_action.boost'
      - 'boost_action.filter'
      - 'boost_action.fixed_boost'
      - 'boost_action.interpolation_boost_spec'
    exactly_one_of:
      - 'boost_action'
      - 'filter_action'
      - 'redirect_action'
      - 'synonyms_action'
      - 'promote_action'
    properties:
      - name: 'filter'
        type: String
        description: |
          The filter to apply to the search results.
        required: true
      - name: 'dataStore'
        type: String
        description: |
          The data store to boost.
        required: true
      - name: 'fixedBoost'
        type: Double
        description: |
          The fixed boost value to apply to the search results. Positive values will increase the relevance of the results, while negative values will decrease the relevance. The value must be between -100 and 100.
        exactly_one_of:
          - 'boost_action.0.fixed_boost'
          - 'boost_action.0.interpolation_boost_spec'
      - name: 'interpolationBoostSpec'
        type: NestedObject
        description: |
          The interpolation boost specification to apply to the search results.
        exactly_one_of:
          - 'boost_action.0.fixed_boost'
          - 'boost_action.0.interpolation_boost_spec'
        properties:
          - name: 'fieldName'
            type: String
            description: |
              The name of the field whose value will be used to determine the boost amount.
          - name: 'attributeType'
            type: Enum
            description: |
              The attribute type to be used to determine the boost amount.
            enum_values:
              - 'NUMERICAL'
              - 'FRESHNESS'
          - name: 'interpolationType'
            type: Enum
            description: |
              The interpolation type to be applied to connect the control points.
            enum_values:
              - 'LINEAR'
          - name: 'controlPoint'
            type: NestedObject
            description: |
              The control points used to define the curve.
            properties:
              - name: 'attributeValue'
                type: String
                description: |
                  The attribute value of the control point.
              - name: 'boostAmount'
                type: Double
                description: |
                  The value between -1 to 1 by which to boost the score if the attributeValue
                  evaluates to the value specified above.
  - name: 'filterAction'
    type: NestedObject
    description: |
      Removes entries from returned results.
    update_mask_fields:
      - 'filter_action.filter'
    exactly_one_of:
      - 'boost_action'
      - 'filter_action'
      - 'redirect_action'
      - 'synonyms_action'
      - 'promote_action'
    properties:
      - name: 'filter'
        type: String
        description: |
          The filter to apply to the search results.
        required: true
      - name: 'dataStore'
        type: String
        description: |
          The data store to filter.
        required: true
  - name: 'redirectAction'
    type: NestedObject
    description: |
      Redirects to a specified URI.
    update_mask_fields:
      - 'redirect_action.redirect_uri'
    exactly_one_of:
      - 'boost_action'
      - 'filter_action'
      - 'redirect_action'
      - 'synonyms_action'
      - 'promote_action'
    properties:
      - name: 'redirectUri'
        type: String
        description: |
          The URI to redirect to.
        required: true
  - name: 'synonymsAction'
    type: NestedObject
    description: |
      Associates queries with each other.
    update_mask_fields:
      - 'synonyms_action.synonyms'
    exactly_one_of:
      - 'boost_action'
      - 'filter_action'
      - 'redirect_action'
      - 'synonyms_action'
      - 'promote_action'
    properties:
      - name: 'synonyms'
        type: Array
        description: |
          The synonyms to apply to the search results.
        item_type:
          type: String
  - name: 'promoteAction'
    type: NestedObject
    description: |
      Promotes a specified link for a query.
    exactly_one_of:
      - 'boost_action'
      - 'filter_action'
      - 'redirect_action'
      - 'synonyms_action'
      - 'promote_action'
    properties:
      - name: 'dataStore'
        type: String
        description: |
          The data store to promote.
        required: true
      - name: 'searchLinkPromotion'
        type: NestedObject
        description: |
          The search link promotion to apply to the search results.
        required: true
        update_mask_fields:
          - 'promote_action.search_link_promotion.title'
          - 'promote_action.search_link_promotion.uri'
          - 'promote_action.search_link_promotion.document'
          - 'promote_action.search_link_promotion.description'
          - 'promote_action.search_link_promotion.image_uri'
          - 'promote_action.search_link_promotion.enabled'
        properties:
          - name: 'title'
            type: String
            description: |
              The title of the promoted link.
            required: true
          - name: 'uri'
            type: String
            description: |
              The URI to promote.
          - name: 'document'
            type: String
            description: |
              The document to promote.
          - name: 'description'
            type: String
            description: |
              The description of the promoted link.
          - name: 'imageUri'
            type: String
            description: |
              The image URI of the promoted link.
          - name: 'enabled'
            type: Boolean
            description: |
              Return promotions for basic site search.
