# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: 'DataConnector'
api_variant_patterns:
  - 'projects/{project}/locations/{location}/collections/{collection}/dataConnector'
description: |
  DataConnector manages the connection to external data sources for all data stores grouped
  under a Collection. It's a singleton resource of Collection. The initialization is only
  supported through DataConnectorService.SetUpDataConnector method, which will create a new
  Collection and initialize its DataConnector.
references:
  guides:
    'Introduction': 'https://cloud.google.com/agentspace/docs/introduction-to-connectors-and-data-stores'
  api: 'https://cloud.google.com/generative-ai-app-builder/docs/reference/rpc/google.cloud.discoveryengine.v1alpha#dataconnectorservice'
base_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
self_link: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
create_url: 'projects/{{project}}/locations/{{location}}:setUpDataConnector'
update_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
update_verb: 'PATCH'
update_mask: true
delete_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id_url_param}}'
import_format:
  - 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
timeouts:
  insert_minutes: 20
  update_minutes: 5
  delete_minutes: 20
autogen_async: false
async:
  actions: ['create', 'delete']
  type: 'OpAsync'
  operation:
    base_url: '{{op_id}}'
  result:
    resource_inside_response: true
custom_code:
  post_read: 'templates/terraform/post_read/discoveryengine_dataconnector_use_declared_res.go.tmpl'
examples:
  - name: 'discoveryengine_dataconnector_jira_basic'
    primary_resource_id: 'jira-basic'
    vars:
      collection_id: 'collection-id'
parameters:
  - name: 'location'
    type: String
    description: |
      The geographic location where the data store should reside. The value can
      only be one of "global", "us" and "eu".
    url_param_only: true
    required: true
    immutable: true
  - name: 'collectionIdUrlParam'
    type: String
    description: |
      The ID to use for the Collection, which will become the final component
      of the Collection's resource name. A new Collection is created as
      part of the DataConnector setup. DataConnector is a singleton
      resource under Collection, managing all DataStores of the Collection.
      This field must conform to [RFC-1034](https://tools.ietf.org/html/rfc1034)
      standard with a length limit of 63 characters. Otherwise, an
      INVALID_ARGUMENT error is returned.
    url_param_only: true
    required: true
properties:
  - name: 'collectionId'
    type: String
    description: |
      The ID to use for the Collection, which will become the final component
      of the Collection's resource name. A new Collection is created as
      part of the DataConnector setup. DataConnector is a singleton
      resource under Collection, managing all DataStores of the Collection.
      This field must conform to [RFC-1034](https://tools.ietf.org/html/rfc1034)
      standard with a length limit of 63 characters. Otherwise, an
      INVALID_ARGUMENT error is returned.
    required: true
    ignore_read: true
  - name: 'collectionDisplayName'
    type: String
    description: |
      The display name of the Collection.
      Should be human readable, used to display collections in the Console
      Dashboard. UTF-8 encoded string with limit of 1024 characters.
    required: true
    ignore_read: true
  - name: 'dataConnector'
    type: NestedObject
    description: |
      The DataConnector to initialize in the newly created Collection.
    required: true
    ignore_read: true
    properties:
      - name: 'name'
        type: String
        description: |
          The full resource name of the Data Connector.
          Format: `projects/*/locations/*/collections/*/dataConnector`.
        output: true
      - name: 'state'
        type: Enum
        description: |
          The state of connector.
        output: true
        enum_values:
          - 'STATE_UNSPECIFIED'
          - 'CREATING'
          - 'ACTIVE'
          - 'FAILED'
          - 'RUNNING'
          - 'WARNING'
          - 'INITIALIZATION_FAILED'
          - 'UPDATING'
      - name: 'dataSource'
        type: String
        description: |
          The name of the data source.
          Supported values: `salesforce`, `jira`, `confluence`, `bigquery`.
        required: true
      - name: 'params'
        type: NestedObject
        description: |
          Params needed to access the source in the format of (Key, Value) pairs.
        required: true
        properties:
          - name: 'instance_uri'
            type: String
            description: |
              The uri to access the data source.
          - name: 'instance_id'
            type: String
            description: |
              The id to access the data source.
          - name: 'client_id'
            type: String
            description: |
              The client id for the third party service provider to identify your application.
          - name: 'client_secret'
            type: String
            description: |
              The client secret generated by the third party authorization server.
          - name: 'refresh_token'
            type: String
            description: |
              OAuth refresh token for UCS to obtain a new access token without user interaction.
          - name: 'access_token'
            type: String
            description: |
              OAuth token for UCS to access to the protected resource.
          - name: 'user_account'
            type: String
            description: |
              The username or email with the source.
          - name: 'api_token'
            type: String
            description: |
              The API token generated for the source account, that is used for authenticating
              anywhere where you would have used a password.
          - name: 'auth_type'
            type: String
            description: |
              The authorization type for the data source.
              Supported values: `BASIC_AUTH`, `OAUTH`, `OAUTH_ACCESS_TOKEN`,
              `OAUTH_TWO_LEGGED`, `OAUTH_JWT_BEARER`, `OAUTH_PASSWORD_GRANT`, `JWT`,
              `API_TOKEN`, `FEDERATED_CREDENTIAL`.
      - name: 'refreshInterval'
        type: NestedObject
        description: |
          The refresh interval for data sync. If duration is set to 0, the data will
          be synced in real time. The streaming feature is not supported yet. The
          minimum is 30 minutes and maximum is 7 days. When the refresh interval is
          set to the same value as the incremental refresh interval, incremental
          sync will be disabled.
        required: true
        properties:
          - name: 'seconds'
            type: Integer
            description: |
              Signed seconds of the span of time. Must be from -315,576,000,000
              to +315,576,000,000 inclusive. Note: these bounds are computed from:
              60 sec/min * 60 min/hr * 24 hr/day * 365.25 days/year * 10000 years
          - name: 'nanos'
            type: Integer
            description: |
              Signed fractions of a second at nanosecond resolution of the span
              of time. Durations less than one second are represented with a 0
              `seconds` field and a positive or negative `nanos` field. For durations
              of one second or more, a non-zero value for the `nanos` field must be
              of the same sign as the `seconds` field. Must be from -999,999,999
              to +999,999,999 inclusive.
      - name: 'entities'
        type: Array
        description: |
          List of entities from the connected data source to ingest.
        item_type:
          type: NestedObject
          properties:
            - name: 'entityName'
              type: String
              description: |
                The name of the entity. Supported values by data source:
                * Salesforce: `Lead`, `Opportunity`, `Contact`, `Account`, `Case`, `Contract`, `Campaign`
                * Jira: project, issue, attachment, comment, worklog
                * Confluence: `Content`, `Space`
      - name: 'create_time'
        type: Time
        description: |
          Timestamp when the DataConnector was created.
        output: true
      - name: 'latest_pause_time'
        type: Time
        description: |
          The most recent timestamp when this [DataConnector][] was paused,
          affecting all functionalities such as data synchronization.
          Pausing a connector has the following effects:
            - All functionalities, including data synchronization, are halted.
            - Any ongoing data synchronization job will be canceled.
            - No future data synchronization runs will be scheduled nor can be
          triggered.
        output: true
      - name: 'last_sync_time'
        type: Time
        description: |
          For periodic connectors only, the last time a data sync was completed.
        output: true
      - name: 'update_time'
        type: Time
        description: |
          Timestamp when the DataConnector was updated.
        output: true
      - name: 'errors'
        type: Array
        description: |
          The errors from initialization or from the latest connector run.
        output: true
        item_type:
          type: NestedObject
          properties:
            - name: 'code'
              type: Integer
              description: |
                The status code, which should be an enum value of google.rpc.Code.
              output: true
            - name: 'message'
              type: String
              description: |
                A developer-facing error message, which should be in English.
              output: true
      - name: 'kms_key_name'
        type: String
        description: |
          The KMS key to be used to protect the DataStores managed by this connector.
          Must be set for requests that need to comply with CMEK Org Policy
          protections.
          If this field is set and processed successfully, the DataStores created by
          this connector will be protected by the KMS key.
      - name: 'actionState'
        type: Enum
        description: |
          State of the action connector. This reflects whether the action connector
          is initializing, active or has encountered errors.
        output: true
        enum_values:
          - 'STATE_UNSPECIFIED'
          - 'CREATING'
          - 'ACTIVE'
          - 'FAILED'
          - 'RUNNING'
          - 'WARNING'
          - 'INITIALIZATION_FAILED'
          - 'UPDATING'
      - name: 'staticIpEnabled'
        type: Boolean
        description: |
          Whether customer has enabled static IP addresses for this connector.
      - name: 'staticIpAddresses'
        type: Array
        description: |
          The static IP addresses used by this connector.
        output: true
        item_type:
          type: String
      - name: 'blockingReasons'
        type: Array
        description: |
          User actions that must be completed before the connector can start syncing data.
        output: true
        item_type:
          type: Enum
          enum_values:
            - 'ALLOWLIST_STATIC_IP'
            - 'ALLOWLIST_IN_SERVICE_ATTACHMENT'
      - name: 'privateConnectivityProjectId'
        type: String
        description: |
          The tenant project ID associated with private connectivity connectors.
          This project must be allowlisted by in order for the connector to function.
        output: true
      - name: 'connectorType'
        type: Enum
        description: |
          The type of connector. Each source can only map to one type.
          For example, salesforce, confluence and jira have THIRD_PARTY connector
          type. It is not mutable once set by system.
        output: true
        enum_values:
          - 'CONNECTOR_TYPE_UNSPECIFIED'
          - 'THIRD_PARTY'
          - 'GCP_FHIR'
          - 'BIG_QUERY'
          - 'GCS'
          - 'GOOGLE_MAIL'
          - 'GOOGLE_CALENDAR'
          - 'GOOGLE_DRIVE'
          - 'NATIVE_CLOUD_IDENTITY'
          - 'THIRD_PARTY_FEDERATED'
          - 'THIRD_PARTY_EUA'
          - 'GCNV'
      - name: 'realtimeState'
        type: Enum
        description: |
          The real-time sync state.
        output: true
        enum_values:
          - 'STATE_UNSPECIFIED'
          - 'CREATING'
          - 'ACTIVE'
          - 'FAILED'
          - 'RUNNING'
          - 'WARNING'
          - 'INITIALIZATION_FAILED'
          - 'UPDATING'
