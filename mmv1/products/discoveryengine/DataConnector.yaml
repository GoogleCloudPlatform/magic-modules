# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: 'DataConnector'
api_variant_patterns:
  - 'projects/{project}/locations/{location}/collections/{collection}/dataConnector'
description: |
  DataConnector manages the connection to external data sources for all data stores grouped
  under a Collection. It's a singleton resource of Collection. The initialization is only
  supported through DataConnectorService.SetUpDataConnector method, which will create a new
  Collection and initialize its DataConnector.
references:
  guides:
    'Introduction': 'https://cloud.google.com/agentspace/docs/introduction-to-connectors-and-data-stores'
  api: 'https://cloud.google.com/generative-ai-app-builder/docs/reference/rpc/google.cloud.discoveryengine.v1alpha#dataconnectorservice'
base_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
self_link: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
create_url: 'projects/{{project}}/locations/{{location}}:setUpDataConnectorV2?collectionId={{collection_id}}&collectionDisplayName={{collection_display_name}}'
update_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
update_verb: 'PATCH'
update_mask: true
delete_url: 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}'
import_format:
  - 'projects/{{project}}/locations/{{location}}/collections/{{collection_id}}/dataConnector'
custom_code:
  constants: "templates/terraform/constants/discoveryengine_data_connector.go.tmpl"
state_upgraders: true
schema_version: 1
timeouts:
  insert_minutes: 20
  update_minutes: 5
  delete_minutes: 20
autogen_async: false
async:
  actions: ['create', 'delete']
  type: 'OpAsync'
  operation:
    base_url: '{{op_id}}'
  result:
    resource_inside_response: true
examples:
  - name: 'discoveryengine_dataconnector_servicenow_basic'
    primary_resource_id: 'servicenow-basic'
    vars:
      collection_id: 'collection-id'
parameters:
  - name: 'location'
    type: String
    description: |
      The geographic location where the data store should reside. The value can
      only be one of "global", "us" and "eu".
    url_param_only: true
    required: true
    immutable: true
  - name: 'collectionId'
    type: String
    description: |
      The ID to use for the Collection, which will become the final component
      of the Collection's resource name. A new Collection is created as
      part of the DataConnector setup. DataConnector is a singleton
      resource under Collection, managing all DataStores of the Collection.
      This field must conform to [RFC-1034](https://tools.ietf.org/html/rfc1034)
      standard with a length limit of 63 characters. Otherwise, an
      INVALID_ARGUMENT error is returned.
    url_param_only: true
    required: true
    immutable: true
  - name: 'collectionDisplayName'
    type: String
    description: |
      The display name of the Collection.
      Should be human readable, used to display collections in the Console
      Dashboard. UTF-8 encoded string with limit of 1024 characters.
    url_param_only: true
    required: true
    immutable: true
    ignore_read: true
properties:
  - name: 'name'
    type: String
    description: |
      The full resource name of the Data Connector.
      Format: `projects/*/locations/*/collections/*/dataConnector`.
    output: true
  - name: 'state'
    type: String
    description: |
      The state of connector. The possible value can be:
      'STATE_UNSPECIFIED', 'CREATING', 'ACTIVE', 'FAILED', 'RUNNING', 'WARNING',
      'INITIALIZATION_FAILED', 'UPDATING'.
    output: true
  - name: 'dataSource'
    type: String
    description: |
      The name of the data source.
      Supported values: `salesforce`, `jira`, `confluence`, `bigquery`.
    required: true
    immutable: true
  - name: 'params'
    type: KeyValuePairs
    description: |
      Params needed to access the source in the format of String-to-String (Key, Value) pairs.
    ignore_read: true
    exactly_one_of:
      - params
      - json_params
  - name: 'jsonParams'
    type: String
    description: |
      Params needed to access the source in the format of json string.
    ignore_read: true
    exactly_one_of:
      - params
      - json_params
  - name: 'refreshInterval'
    type: String
    description: |
      The refresh interval for data sync. If duration is set to 0, the data will
      be synced in real time. The streaming feature is not supported yet. The
      minimum is 30 minutes and maximum is 7 days. When the refresh interval is
      set to the same value as the incremental refresh interval, incremental
      sync will be disabled.
    required: true
  - name: 'entities'
    type: Array
    description: |
      List of entities from the connected data source to ingest.
    immutable: true
    item_type:
      type: NestedObject
      properties:
        - name: 'entityName'
          type: String
          description: |
            The name of the entity. Supported values by data source:
            * Salesforce: `Lead`, `Opportunity`, `Contact`, `Account`, `Case`, `Contract`, `Campaign`
            * Jira: project, issue, attachment, comment, worklog
            * Confluence: `Content`, `Space`
        - name: 'keyPropertyMappings'
          type: KeyValuePairs
          description: |
            Attributes for indexing.
            Key: Field name.
            Value: The key property to map a field to, such as `title`, and
            `description`. Supported key properties:
            * `title`: The title for data record. This would be displayed on search
              results.
            * `description`: The description for data record. This would be displayed
              on search results.
        - name: 'dataStore'
          type: String
          description: |
            The full resource name of the associated data store for the source
            entity.
            Format: `projects/*/locations/*/collections/*/dataStores/*`.
            When the connector is initialized by the DataConnectorService.SetUpDataConnector
            method, a DataStore is automatically created for each source entity.
          output: true
        - name: 'params'
          description: 'The parameters for the entity to facilitate data ingestion.'
          diff_suppress_func: 'DataConnectorEntitiesParamsDiffSuppress'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_schema.tmpl'
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          validation:
            function: 'validation.StringIsJSON'
  - name: 'createTime'
    type: Time
    description: |
      Timestamp when the DataConnector was created.
    output: true
  - name: 'latestPauseTime'
    type: Time
    description: |
      The most recent timestamp when this [DataConnector][] was paused,
      affecting all functionalities such as data synchronization.
      Pausing a connector has the following effects:
        - All functionalities, including data synchronization, are halted.
        - Any ongoing data synchronization job will be canceled.
        - No future data synchronization runs will be scheduled nor can be
      triggered.
    output: true
  - name: 'lastSyncTime'
    type: Time
    description: |
      For periodic connectors only, the last time a data sync was completed.
    output: true
  - name: 'updateTime'
    type: Time
    description: |
      Timestamp when the DataConnector was updated.
    output: true
  - name: 'errors'
    type: Array
    description: |
      The errors from initialization or from the latest connector run.
    output: true
    item_type:
      type: NestedObject
      properties:
        - name: 'code'
          type: Integer
          description: |
            The status code, which should be an enum value of google.rpc.Code.
          output: true
        - name: 'message'
          type: String
          description: |
            A developer-facing error message, which should be in English.
          output: true
  - name: 'kmsKeyName'
    type: String
    description: |
      The KMS key to be used to protect the DataStores managed by this connector.
      Must be set for requests that need to comply with CMEK Org Policy
      protections.
      If this field is set and processed successfully, the DataStores created by
      this connector will be protected by the KMS key.
    immutable: true
  - name: 'actionState'
    type: String
    description: |
      State of the action connector. This reflects whether the action connector
      is initializing, active or has encountered errors. The possible value can be:
      'STATE_UNSPECIFIED', 'CREATING', 'ACTIVE', 'FAILED', 'RUNNING', 'WARNING',
      'INITIALIZATION_FAILED', 'UPDATING'.
    output: true
  - name: 'staticIpEnabled'
    type: Boolean
    description: |
      Whether customer has enabled static IP addresses for this connector.
    immutable: true
  - name: 'staticIpAddresses'
    type: Array
    description: |
      The static IP addresses used by this connector.
    output: true
    item_type:
      type: String
  - name: 'blockingReasons'
    type: Array
    description: |
      User actions that must be completed before the connector can start syncing data.
      The possible values can be: 'ALLOWLIST_STATIC_IP', 'ALLOWLIST_IN_SERVICE_ATTACHMENT'.
    output: true
    item_type:
      type: String
  - name: 'privateConnectivityProjectId'
    type: String
    description: |
      The tenant project ID associated with private connectivity connectors.
      This project must be allowlisted by in order for the connector to function.
    output: true
  - name: 'connectorType'
    type: String
    description: |
      The type of connector. Each source can only map to one type.
      For example, salesforce, confluence and jira have THIRD_PARTY connector
      type. It is not mutable once set by system. The possible value can be:
      'CONNECTOR_TYPE_UNSPECIFIED', 'THIRD_PARTY', 'GCP_FHIR', 'BIG_QUERY',
      'GCS', 'GOOGLE_MAIL', 'GOOGLE_CALENDAR', 'GOOGLE_DRIVE',
      'NATIVE_CLOUD_IDENTITY', 'THIRD_PARTY_FEDERATED', 'THIRD_PARTY_EUA', 'GCNV'.
    output: true
  - name: 'realtimeState'
    type: String
    description: |
      The real-time sync state. The possible values can be:
      'STATE_UNSPECIFIED', 'CREATING', 'ACTIVE', 'FAILED', 'RUNNING', 'WARNING',
      'INITIALIZATION_FAILED', 'UPDATING'.
    output: true
  - name: 'connectorModes'
    type: Array
    description: |
      The modes enabled for this connector. The possible value can be:
      'DATA_INGESTION', 'ACTIONS', 'FEDERATED'
      'EUA', 'FEDERATED_AND_EUA'.
    item_type:
      type: String
  - name: 'syncMode'
    type: String
    description: |
      The data synchronization mode supported by the data connector. The possible value can be:
      'PERIODIC', 'STREAMING'.
    ignore_read: true
  - name: 'incrementalRefreshInterval'
    type: String
    description: |
      The refresh interval specifically for incremental data syncs. If unset,
      incremental syncs will use the default from env, set to 3hrs.
      The minimum is 30 minutes and maximum is 7 days. Applicable to only 3P
      connectors. When the refresh interval is
      set to the same value as the incremental refresh interval, incremental
      sync will be disabled.
  - name: 'autoRunDisabled'
    type: Boolean
    description: |
      Indicates whether full syncs are paused for this connector
    ignore_read: true
  - name: 'incrementalSyncDisabled'
    type: Boolean
    description: |
      Indicates whether incremental syncs are paused for this connector.
    ignore_read: true
