# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
name: App
description: Description
base_url: projects/{{project}}/locations/{{location}}/apps
update_mask: true
self_link: projects/{{project}}/locations/{{location}}/apps/{{name}}
create_url: projects/{{project}}/locations/{{location}}/apps?appId={{app_id}}
update_verb: PATCH
id_format: projects/{{project}}/locations/{{location}}/apps/{{name}}
import_format:
 - projects/{{project}}/locations/{{location}}/apps/{{name}}
examples:
 - name: "ces_app_basic"
   primary_resource_id: "ces_app_basic"
   vars:
    display_name: 'my-app'
    app_id: 'app-id'
 - name: "ces_app_ambient_sound_gcs_uri"
   primary_resource_id: "ces_app_ambient_sound_gcs_uri"
   vars:
    display_name: 'my-app-ambient-sound-gcs-uri'
    app_id: 'app-id'
autogen_async: true
async:
 operation:
  timeouts:
   insert_minutes: 20
   update_minutes: 20
   delete_minutes: 20
  base_url: '{{op_id}}'
 actions:
  - create
  - delete
 type: OpAsync
 result:
  resource_inside_response: true
 include_project: false
autogen_status: QXBw
parameters:
 - name: location
   type: String
   description: Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122.
   immutable: true
   url_param_only: true
   required: true
 - name: appId
   type: String
   description: |-
    The ID to use for the app, which will become the final component of
    the app's resource name. If not provided, a unique ID will be
    automatically assigned for the app.
   immutable: true
   url_param_only: true
   required: true
properties:
 - name: audioProcessingConfig
   type: NestedObject
   description: |-
    Configuration for how the input and output audio should be processed and
    delivered.
   properties:
    - name: ambientSoundConfig
      type: NestedObject
      description: |-
       Configuration for the ambient sound to be played with the synthesized agent
       response, to enhance the naturalness of the conversation.
      properties:
       - name: gcsUri
         type: String
         description: |-
          Ambient noise as a mono-channel, 16kHz WAV file stored in [Cloud
          Storage](https://cloud.google.com/storage).
          Note: Please make sure the CES service agent
          `service-@gcp-sa-ces.iam.gserviceaccount.com` has
          `storage.objects.get` permission to the Cloud Storage object.
       - name: prebuiltAmbientSound
         type: String
         description: |-
           Name of the prebuilt ambient sound.
           Valid values are: - "coffee_shop" - "keyboard" - "keypad" - "hum"
           -"office_1" - "office_2" - "office_3"
           -"room_1" - "room_2" - "room_3"
           -"room_4" - "room_5" - "air_conditioner"
       - name: volumeGainDb
         type: Double
         description: |-
          Volume gain (in dB) of the normal native volume supported by
          ambient noise, in the range [-96.0, 16.0]. If unset, or set to a value of
          0.0 (dB), will play at normal native signal amplitude. A value of -6.0 (dB)
          will play at approximately half the amplitude of the normal native signal
          amplitude. A value of +6.0 (dB) will play at approximately twice the
          amplitude of the normal native signal amplitude. We strongly recommend not
          to exceed +10 (dB) as there's usually no effective increase in loudness for
          any value greater than that.
    - name: bargeInConfig
      type: NestedObject
      description: Configuration for how the user barge-in activities should be handled.
      properties:
       - name: bargeInAwareness
         type: Boolean
         description: |-
           If enabled, the agent will adapt its next response based on the assumption
           that the user hasn't heard the full preceding agent message.
           This should not be used in scenarios where agent responses are displayed
           visually.
    - name: inactivityTimeout
      type: String
      description: |-
        The duration of user inactivity (no speech or interaction) before the agent
        prompts the user for reengagement. If not set, the agent will not prompt
        the user for reengagement.
    - name: synthesizeSpeechConfigs
      type: Map
      description: |-
        Configuration of how the agent response should be synthesized, mapping from
        the language code to SynthesizeSpeechConfig.
        If the configuration for the specified language code is not found, the
        configuration for the root language code will be used. For example, if the
        map contains "en-us" and "en", and the specified language code is "en-gb",
        then "en" configuration will be used.
        Note: Language code is case-insensitive.
      key_name: 'language_code'
      required: false
      value_type:
       type: NestedObject
       description: Configuration for speech synthesis for a specific language.
       properties:
        - name: voice
          type: String
          description: |-
            The name of the voice. If not set, the service will choose a
            voice based on the other parameters such as language_code.
            For the list of available voices, please refer to Supported voices and
            languages from Cloud Text-to-Speech.
          required: false
        - name: speakingRate
          type: Double
          description: |-
            The speaking rate/speed in the range [0.25, 2.0]. 1.0 is the normal native
            speed supported by the specific voice. 2.0 is twice as fast, and 0.5 is
            half as fast. Values outside of the range [0.25, 2.0] will return an error.
          required: false
 - name: createTime
   type: String
   description: Timestamp when the app was created.
   output: true
 - name: pinned
   type: Boolean
   description: Whether the app is pinned in the app list.
 - name: dataStoreSettings
   type: NestedObject
   description: Data store related settings for the app.
   properties:
    - name: engines
      type: Array
      description: The engines for the app.
      output: true
      item_type:
       type: NestedObject
       description: An engine to which the data stores are connected. See Vertex AI Search (https://cloud.google.com/generative-ai-app-builder/docs/enterprise-search-introduction).
       properties:
        - name: name
          type: String
          description: |-
           The resource name of the engine.
           Format:
           `projects/{project}/locations/{location}/collections/{collection}/engines/{engine}`
          output: true
        - name: type
          type: String
          description: |-
           The type of the engine.
           Possible values:
           ENGINE_TYPE_SEARCH
           ENGINE_TYPE_CHAT
          output: true
 - name: defaultChannelProfile
   type: NestedObject
   description: |-
    A ChannelProfile configures the agent's behavior for a specific communication
    channel, such as web UI or telephony.
   properties:
    - name: channelType
      type: String
      description: |-
       The type of the channel profile.
       Possible values:
       UNKNOWN
       WEB_UI
       API
       TWILIO
       GOOGLE_TELEPHONY_PLATFORM
       CONTACT_CENTER_AS_A_SERVICE
    - name: disableBargeInControl
      type: Boolean
      description: |-
       Whether to disable user barge-in in the conversation.
       - true: User interruptions are disabled while the agent is speaking.
       - false: The agent retains automatic control over when the user can interrupt.
    - name: disableDtmf
      type: Boolean
      description: Whether to disable DTMF (dual-tone multi-frequency).
    - name: personaProperty
      type: NestedObject
      description: Represents the persona property of a channel.
      properties:
       - name: persona
         type: String
         description: |-
          The persona of the channel.
          Possible values:
          UNKNOWN
          CONCISE
          CHATTY
    - name: profileId
      type: String
      description: The unique identifier of the channel profile.
    - name: webWidgetConfig
      type: NestedObject
      description: Message for configuration for the web widget.
      properties:
       - name: modality
         type: String
         description: |-
          The modality of the web widget.
          Possible values:
          UNKNOWN_MODALITY
          CHAT_AND_VOICE
          VOICE_ONLY
          CHAT_ONLY
       - name: theme
         type: String
         description: |-
          The theme of the web widget.
          Possible values:
          UNKNOWN_THEME
          LIGHT
          DARK
       - name: webWidgetTitle
         type: String
         description: The title of the web widget.
 - name: deploymentCount
   type: Integer
   description: Number of deployments in the app.
   output: true
 - name: description
   type: String
   description: Human-readable description of the app.
 - name: displayName
   type: String
   description: Display name of the app.
   required: true
 - name: etag
   type: String
   description: |-
    Etag used to ensure the object hasn't changed during a read-modify-write
    operation. If the etag is empty, the update will overwrite any concurrent
    changes.
   output: true
 - name: evaluationMetricsThresholds
   type: NestedObject
   description: Threshold settings for metrics in an Evaluation.
   properties:
    - name: goldenEvaluationMetricsThresholds
      type: NestedObject
      description: Settings for golden evaluations.
      properties:
       - name: expectationLevelMetricsThresholds
         type: NestedObject
         description: Expectation level metrics thresholds.
         properties:
          - name: toolInvocationParameterCorrectnessThreshold
            type: Double
            description: |-
             The success threshold for individual tool invocation parameter
             correctness. Must be a float between 0 and 1. Default is 1.0.
       - name: turnLevelMetricsThresholds
         type: NestedObject
         description: Turn level metrics thresholds.
         properties:
          - name: overallToolInvocationCorrectnessThreshold
            type: Double
            description: |-
             The success threshold for overall tool invocation correctness. Must be
             a float between 0 and 1. Default is 1.0.
          - name: semanticSimilaritySuccessThreshold
            type: Integer
            description: |-
             The success threshold for semantic similarity. Must be an integer
             between 0 and 4. Default is >= 3.
 - name: globalInstruction
   type: String
   description: |-
    Instructions for all the agents in the app.
    You can use this instruction to set up a stable identity or personality
    across all the agents.
 - name: guardrails
   type: Array
   description: |-
    List of guardrails for the app.
    Format:
    `projects/{project}/locations/{location}/apps/{app}/guardrails/{guardrail}`
   item_type:
    type: String
 - name: languageSettings
   type: NestedObject
   description: Language settings of the app.
   properties:
    - name: defaultLanguageCode
      type: String
      description: The default language code of the app.
    - name: enableMultilingualSupport
      type: Boolean
      description: |-
       Enables multilingual support. If true, agents in the app will use pre-built
       instructions to improve handling of multilingual input.
    - name: fallbackAction
      type: String
      description: |-
       The action to perform when an agent receives input in an unsupported
       language.
       This can be a predefined action or a custom tool call.
       Valid values are:
       - A tool's full resource name, which triggers a specific tool execution.
       - A predefined system action, such as "escalate" or "exit", which triggers
       an EndSession signal with corresponding metadata
       to terminate the conversation.
    - name: supportedLanguageCodes
      type: Array
      description: |-
       List of languages codes supported by the app, in addition to the
       `default_language_code`.
      item_type:
       type: String
 - name: loggingSettings
   type: NestedObject
   description: Settings to describe the logging behaviors for the app.
   properties:
    - name: audioRecordingConfig
      type: NestedObject
      description: Configuration for how the audio interactions should be recorded.
      properties:
       - name: gcsBucket
         type: String
         description: |-
          The [Cloud Storage](https://cloud.google.com/storage) bucket to store the
          session audio recordings. The URI must start with "gs://".
          Note: If the Cloud Storage bucket is in a different project from the app,
          you should grant `storage.objects.create` permission to the CES service
          agent `service-@gcp-sa-ces.iam.gserviceaccount.com`.
       - name: gcsPathPrefix
         type: String
         description: |-
          The Cloud Storage path prefix for audio recordings.
          This prefix can include the following placeholders, which will be
          dynamically substituted at serving time:
          - $project:   project ID
          - $location:  app location
          - $app:       app ID
          - $date:      session date in YYYY-MM-DD format
          - $session:   session ID
          If the path prefix is not specified, the default prefix
          `$project/$location/$app/$date/$session/` will be used.
    - name: bigqueryExportSettings
      type: NestedObject
      description: Settings to describe the BigQuery export behaviors for the app.
      properties:
       - name: dataset
         type: String
         description: The BigQuery dataset to export the data to.
       - name: enabled
         type: Boolean
         description: Indicates whether the BigQuery export is enabled.
       - name: project
         type: String
         description: |-
          The project ID of the BigQuery dataset to export the data to.
          Note: If the BigQuery dataset is in a different project from the app, you should grant
          roles/bigquery.admin role to the CES service agent service-<PROJECT-
          NUMBER>@gcp-sa-ces.iam.gserviceaccount.com.
    - name: cloudLoggingSettings
      type: NestedObject
      description: Settings to describe the Cloud Logging behaviors for the app.
      properties:
       - name: enableCloudLogging
         type: Boolean
         description: Whether to enable Cloud Logging for the sessions.
    - name: conversationLoggingSettings
      type: NestedObject
      description: Settings to describe the conversation logging behaviors for the app.
      properties:
       - name: disableConversationLogging
         type: Boolean
         description: Whether to disable conversation logging for the sessions.
    - name: redactionConfig
      type: NestedObject
      description: Configuration to instruct how sensitive data should be handled.
      properties:
       - name: deidentifyTemplate
         type: String
         description: |-
          [DLP](https://cloud.google.com/dlp/docs) deidentify template name to
          instruct on how to de-identify content.
          Format:
          `projects/{project}/locations/{location}/deidentifyTemplates/{deidentify_template}`
       - name: enableRedaction
         type: Boolean
         description: |-
           If true, redaction will be applied in various logging scenarios, including
           conversation history, Cloud Logging and audio recording.
       - name: inspectTemplate
         type: String
         description: |-
          [DLP](https://cloud.google.com/dlp/docs) inspect template name to configure
          detection of sensitive data types.
          Format:
          `projects/{project}/locations/{location}/inspectTemplates/{inspect_template}`
 - name: metadata
   type: KeyValuePairs
   description: |-
    Metadata about the app. This field can be used to store additional
    information relevant to the app's details or intended usages.
 - name: modelSettings
   type: NestedObject
   description: Model settings contains various configurations for the LLM model.
   properties:
    - name: model
      type: String
      description: |-
        The LLM model that the agent should use.
        If not set, the agent will inherit the model from its parent agent.
    - name: temperature
      type: Double
      description: |-
       If set, this temperature will be used for the LLM model. Temperature
       controls the randomness of the model's responses. Lower temperatures
       produce responses that are more predictable. Higher temperatures produce
       responses that are more creative.
 - name: name
   type: String
   description: |-
    Identifier. The unique identifier of the app.
    Format: `projects/{project}/locations/{location}/apps/{app}`
   output: true
   custom_flatten: 'templates/terraform/custom_flatten/name_from_self_link.tmpl'
 - name: rootAgent
   type: String
   description: |-
    The root agent is the entry point of the app.
    Format: `projects/{project}/locations/{location}/apps/{app}/agents/{agent}`
 - name: timeZoneSettings
   type: NestedObject
   description: "TimeZone settings of the app."
   properties:
    - name: timeZone
      type: String
      description: "The time zone of the app from the time zone database, e.g., America/Los_Angeles, Europe/Paris."
 - name: updateTime
   type: String
   description: Timestamp when the app was last updated.
   output: true
 - name: variableDeclarations
   type: Array
   description: The declarations of the variables.
   item_type:
    type: NestedObject
    properties:
     - name: description
       type: String
       description: The description of the variable.
       required: true
     - name: name
       type: String
       description: |-
        The name of the variable. The name must start with a letter or underscore
        and contain only letters, numbers, or underscores.
       required: true
     - name: schema
       type: NestedObject
       description: Represents a select subset of an OpenAPI 3.0 schema object.
       required: true
       properties:
        - name: title
          type: String
          description: The title of the schema.
        - name: description
          type: String
          description: The description of the data.
        - name: enum
          type: Array
          description: |-
           Possible values of the element of primitive type with enum format.
           Examples:
           1. We can define direction as :
           {type:STRING, format:enum, enum:["EAST", NORTH", "SOUTH", "WEST"]}
           2. We can define apartment number as :
           {type:INTEGER, format:enum, enum:["101", "201", "301"]}
          item_type:
           type: String
        - name: nullable
          type: Boolean
          description: Indicates if the value may be null.
        - name: ref
          type: String
          description: |-
           Allows indirect references between schema nodes. The value should be a
           valid reference to a child of the root `defs`.
           For example, the following schema defines a reference to a schema node
           named "Pet":
           type: object
           properties:
             pet:
               ref: #/defs/Pet
           defs:
             Pet:
               type: object
               properties:
                 name:
                   type: string
           The value of the "pet" property is a reference to the schema node
           named "Pet".
           See details in
           https://json-schema.org/understanding-json-schema/structuring.
        - name: required
          type: Array
          description: Required properties of Type.OBJECT.
          item_type:
           type: String
        - name: type
          type: String
          description: |-
           The type of the data.
           Possible values:
           STRING
           INTEGER
           NUMBER
           BOOLEAN
           OBJECT
           ARRAY
          required: true
        - name: uniqueItems
          type: Boolean
          description: Indicate the items in the array must be unique. Only applies to TYPE.ARRAY.
        - name: defs
          type: String
          description: A map of definitions for use by ref. Only allowed at the root of the schema.
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_value.tmpl'
          validation:
           function: 'validation.StringIsJSON'
        - name: default
          description: |-
           Optional. Default value of the data. Represents a dynamically typed value
           which can be either null, a number, a string, a boolean, a struct,
           or a list of values. The provided default value must be compatible
           with the defined 'type' and other schema constraints.
          required: false
        - name: additionalProperties
          type: String
          description: |-
           Optional. Defines the schema for additional properties allowed in an object.
           The value must be a valid JSON string representing the Schema object.
           (Note: OpenAPI also allows a boolean, this definition expects a Schema JSON).
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_value.tmpl'
          validation:
           function: 'validation.StringIsJSON'
          required: false
        - name: anyOf
          type: String
          description: Optional. The instance value should be valid against at least one of the schemas in this list.
          required: false
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_value.tmpl'
          validation:
           function: 'validation.StringIsJSON'
        - name: prefixItems
          type: String
          description: Optional. Schemas of initial elements of Type.ARRAY.
          required: false
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_value.tmpl'
          validation:
           function: 'validation.StringIsJSON'
        - name: properties
          type: String
          description: Properties of Type.OBJECT.
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_value.tmpl'
          validation:
           function: 'validation.StringIsJSON'
        - name: items
          type: String
          description: Schema of the elements of Type.ARRAY.
          state_func: 'func(v interface{}) string { s, _ := structure.NormalizeJsonString(v); return s }'
          custom_flatten: 'templates/terraform/custom_flatten/json_schema.tmpl'
          custom_expand: 'templates/terraform/custom_expand/json_value.tmpl'
          validation:
           function: 'validation.StringIsJSON'
 - name: clientCertificateSettings
   type: NestedObject
   description: |-
    The default client certificate settings for the app.
   properties:
    - name: tlsCertificate
      type: String
      description: |-
       The TLS certificate encoded in PEM format.
       This string must include the begin header and end footer lines.
      required: true
    - name: privateKey
      type: String
      description: |-
       The name of the SecretManager secret version resource
       storing the private key encoded in PEM format.
       Format: projects/{project}/secrets/{secret}/versions/{version}
      required: true
    - name: passphrase
      type: String
      description: |-
       The passphrase to decrypt the private key.
       Should be left unset if the private key is not encrypted.
