# Copyright 2023 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
name: 'Subscription'
base_url: 'projects/{{project}}/locations/{{location}}/subscriptions/{{subscription_id}}'
create_url: projects/{{project}}/locations/{{location}}/dataExchanges/{{data_exchange_id}}/listings/{{listing_id}}:subscribe
delete_url: 'projects/{{project}}/locations/{{location}}/subscriptions/{{subscription_id}}'
self_link: 'projects/{{project}}/locations/{{location}}/subscriptions/{{subscription_id}}'
immutable: true
update_mask: true
description: |
  A subscription represents a subscribers' access to a particular set of published data. It contains references to associated listings, data exchanges, and linked datasets.
references: !ruby/object:Api::Resource::ReferenceLinks
  guides:
    'Introduction to Subscriptions': 'https://cloud.google.com/bigquery/docs/analytics-hub-manage-subscriptions'
  api: 'https://cloud.google.com/bigquery/docs/reference/analytics-hub/rest/v1/projects.locations.subscriptions'
id_format: 'projects/{{project}}/locations/{{location}}/subscriptions/{{subscription_id}}'
import_format:
  [
    'projects/{{project}}/locations/{{location}}/subscriptions/{{subscription_id}}'
  ]
custom_code: !ruby/object:Provider::Terraform::CustomCode
  post_create: templates/terraform/post_create/bigquery_analytics_hub_subscription.go.erb
examples:
  - !ruby/object:Provider::Terraform::Examples
    name: 'bigquery_analyticshub_subscription_basic'
    pull_external: true
    skip_docs: true
    primary_resource_id: 'subscription'
    region_override: 'US'
    vars:
      data_exchange_id: 'my_data_exchange'
      listing_id: 'my_listing'
      subscription_dataset_id: 'my_subscription_dataset'
      exchange_description: 'example data exchange'
    test_env_vars:
      project: :PROJECT_NAME
    ignore_read_extra:
      - 'project'

parameters:
  - !ruby/object:Api::Type::String
    name: 'location'
    url_param_only: true
    immutable: true
    default_value: US
    description: |
      The geographic location where the transfer config should reside.
      Examples: US, EU, asia-northeast1. The default value is US.
  - !ruby/object:Api::Type::String
    name: 'data_exchange_id'
    description: |
      The ID of the data exchange for subscription. Must contain only Unicode letters, numbers (0-9), underscores (_). Should not use characters that require URL-escaping, or characters outside of ASCII, spaces.
    required: true
    immutable: true
    url_param_only: true
  - !ruby/object:Api::Type::String
    name: 'listing_id'
    description: |
      The ID of the listing for subscription. Must contain only Unicode letters, numbers (0-9), underscores (_). Should not use characters that require URL-escaping, or characters outside of ASCII, spaces.
    required: true
    immutable: true
    url_param_only: true
  - !ruby/object:Api::Type::NestedObject
    name: 'destinationDataset'
    description: |
      BigQuery destination dataset to create for the subscriber.
    required: true
    ignore_read: true
    properties:
      - !ruby/object:Api::Type::NestedObject
        name: 'datasetReference'
        description: |
          Required. A reference that identifies the destination dataset.
        required: true
        ignore_read: true
        properties:
          - !ruby/object:Api::Type::String
            name: 'datasetId'
            description: |
              Required. A unique ID for this dataset, without the project name. The ID must contain only letters (a-z, A-Z), numbers (0-9), or underscores (_). The maximum length is 1,024 characters.
            required: true
          - !ruby/object:Api::Type::String
            name: 'projectId'
            description: |
              Required. The ID of the project containing this dataset.
            required: true
      - !ruby/object:Api::Type::String
        name: 'friendlyName'
        description: |
          Optional. A descriptive name for the dataset.
      - !ruby/object:Api::Type::String
        name: 'description'
        description: |
          Optional. A user-friendly description of the dataset.
      - !ruby/object:Api::Type::String
        name: 'location'
        description: |
          Required. The geographic location where the dataset should reside. See https://cloud.google.com/bigquery/docs/locations for supported locations.
        required: true
  - !ruby/object:Api::Type::String
    name: subscription_id
    description: |
      ID of the created subscription
    immutable: true
    output: true
    ignore_read: true
properties:
  - !ruby/object:Api::Type::String
    name: 'name'
    output: true
    description: |
      Output only. The resource name of the subscription. e.g. projects/myproject/locations/US/subscriptions/123.
  - !ruby/object:Api::Type::Time
    name: 'creationTime'
    output: true
    description: |
      Output only. Timestamp when the subscription was created.

      A timestamp in RFC3339 UTC "Zulu" format, with nanosecond resolution and up to nine fractional digits. Examples: "2014-10-02T15:01:23Z" and "2014-10-02T15:01:23.045123456Z".
  - !ruby/object:Api::Type::Time
    name: 'lastModifyTime'
    output: true
    description: |
      Output only. Timestamp when the subscription was last modified.

      A timestamp in RFC3339 UTC "Zulu" format, with nanosecond resolution and up to nine fractional digits. Examples: "2014-10-02T15:01:23Z" and "2014-10-02T15:01:23.045123456Z".
  - !ruby/object:Api::Type::String
    name: 'organizationId'
    output: true
    description: |
      Output only. Organization of the project this subscription belongs to.
  - !ruby/object:Api::Type::String
    name: 'organizationDisplayName'
    output: true
    description: |
      Output only. Display name of the project of this subscription.
  - !ruby/object:Api::Type::Enum
    name: 'state'
    output: true
    description: |
      Output only. Current state of the subscription.
    values:
      - :STATE_UNSPECIFIED
      - :STATE_ACTIVE
      - :STATE_STALE
      - :STATE_INACTIVE
  - !ruby/object:Api::Type::Map
    name: 'linkedDatasetMap'
    output: true
    description: |
      Output only. Map of listing resource names to associated linked resource, e.g. projects/123/locations/US/dataExchanges/456/listings/789 -> projects/123/datasets/my_dataset

      For listing-level subscriptions, this is a map of size 1. Only contains values if state == STATE_ACTIVE.

      An object containing a list of "key": value pairs. Example: { "name": "wrench", "mass": "1.3kg", "count": "3" }.
    key_name: name
    value_type: !ruby/object:Api::Type::NestedObject
      name: linkedResource
      properties:
        - !ruby/object:Api::Type::String
          name: linkedDataset
          output: true
          description: Output only. Name of the linked dataset, e.g. projects/subscriberproject/datasets/linkedDataset
  - !ruby/object:Api::Type::String
    name: 'subscriberContact'
    output: true
    description: |
      Output only. Email of the subscriber.
  - !ruby/object:Api::Type::String
    name: 'listing'
    output: true
    description: |
      Output only. Resource name of the source Listing. e.g. projects/123/locations/US/dataExchanges/456/listings/789
  - !ruby/object:Api::Type::String
    name: 'dataExchange'
    output: true
    description: |
      Output only. Resource name of the source Data Exchange. e.g. projects/123/locations/US/dataExchanges/456
