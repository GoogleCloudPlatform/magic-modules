# Copyright 2023 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
name: 'AcmeRegistration'
base_url: 'projects/{{project}}/locations/global/acmeRegistrations/{{name}}'
id_format: 'projects/{{project}}/locations/global/acmeRegistrations/{{name}}'
exclude_import: true
immutable: true
exclude_validator: true
skip_read: true
description: |
  Register an account with ACME with EAB key ID and HMAC key.
examples:
  - !ruby/object:Provider::Terraform::Examples
    name: 'public_ca_acme_registration'
    primary_resource_id: 'test'
    skip_import_test: true
    pull_external: true
    test_env_vars:
      project: :PROJECT_NAME
custom_code: !ruby/object:Provider::Terraform::CustomCode
  custom_create: templates/terraform/custom_create/public_ca_acme_registration.go
  custom_delete: templates/terraform/custom_delete/public_ca_acme_registration_delete.go.erb
docs: !ruby/object:Provider::Terraform::Docs
  warning: |
    Register an ACME account, and provide the EAB key ID and HMAC while registering.
    You can only register one ACME account with an EAB secret.
    After you have registered an ACME account by using an EAB secret, the EAB secret becomes invalid and you can't reuse it.
    If you want to register multiple ACME accounts, you must request a unique EAB secret for each of the accounts.
references: !ruby/object:Api::Resource::ReferenceLinks
  guides:
    'Official Documentation': 'https://cloud.google.com/certificate-manager/docs/public-ca'
    'Request EAB key ID and HMAC': 'https://cloud.google.com/certificate-manager/docs/public-ca-tutorial#request-key-hmac'
    'Register ACME account': 'https://cloud.google.com/certificate-manager/docs/public-ca-tutorial#register-acme'
    'Request Certificate Using Public CA': 'https://cloud.google.com/certificate-manager/docs/public-ca-tutorial'
identity:
  - name
parameters:
  - !ruby/object:Api::Type::String
    name: 'name'
    description: |
      Name of the ACME registration, this is just used for resource identity.
properties:
  - !ruby/object:Api::Type::String
    name: 'email'
    required: true
    description: |
      Email address used for registering an account with ACME.
  - !ruby/object:Api::Type::String
    name: 'privateKeyPem'
    sensitive: true
    required: true
    description: |
      Private key in PEM format, used for registering an account with ACME. Currently only RSA is supported.
  - !ruby/object:Api::Type::String
    name: 'eabKeyId'
    required: true
    sensitive: true
    description: |
      It is generated by the PublicCertificateAuthorityService when the ExternalAccountKey is created.
  - !ruby/object:Api::Type::String
    name: 'eabHmacKey'
    required: true
    description: |
      Base64-URL-encoded HS256 key. It is generated by the PublicCertificateAuthorityService
      when the ExternalAccountKey is created.
    sensitive: true
  - !ruby/object:Api::Type::String
    name: 'accountUri'
    output: true
    description: |
      Registered ACME account URI.
