# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: "UnitKind"
description: |
  Definition of a UnitKind. Units belonging to the same UnitKind are managed together; for example they
  follow the same release model (blueprints, versions etc.) and are typically rolled out together.
references:
  guides:
    "Deploy a service instance with SaaS Runtime": "https://cloud.google.com/saas-runtime/docs/deploy-vm"
  api: "https://cloud.google.com/saas-runtime/docs/reference/rest/v1beta1/projects.locations.unitKinds"
min_version: "beta"

base_url: "projects/{{project}}/locations/{{location}}/unitKinds"
self_link: "projects/{{project}}/locations/{{location}}/unitKinds/{{unit_kind_id}}"

immutable: true

create_url: "projects/{{project}}/locations/{{location}}/unitKinds?unitKindId={{unit_kind_id}}"

examples:
  - name: "saas_unitkind_basic"
    primary_resource_id: "default"
    primary_resource_name: 'fmt.Sprintf("tf-test-my-unit-kind%s", context["random_suffix"])'
    vars:
      unit_kind_id: "my-unit-kind"
    min_version: "beta"
  - name: "saas_unitkind_full"
    primary_resource_id: "default"
    primary_resource_name: 'fmt.Sprintf("tf-test-my-unit-kind%s", context["random_suffix"])'
    vars:
      unit_kind_id: "my-unit-kind"
    min_version: "beta"

import_format:
  - "projects/{{project}}/locations/{{location}}/unitKinds/{{unit_kind_id}}"
  - "{{unit_kind_id}}"

parameters:
  - name: "location"
    type: String
    required: true
    immutable: true
    url_param_only: true
    description: |
      The location for the UnitKind.
  - name: "unit_kind_id"
    type: String
    required: true
    immutable: true
    url_param_only: true
    description: |
      The ID for the UnitKind.

properties:
  - name: "name"
    type: String
    description: |
      The resource name for the UnitKind.
    output: true
  - name: "saas"
    type: String
    description: |
      A reference to the SaaS that defines the product (managed service) that
      the producer wants to manage with SaaS Runtime.
  - name: "dependency"
    type: Array
    api_name: "dependencies"
    description: |
      Dependency represent a single dependency with another unit kind by alias.
    item_type:
      type: NestedObject
      required: true
      properties:
        - name: "unitKind"
          type: String
          description: |
            The unit kind of the dependency.
          required: true
        - name: "alias"
          type: String
          description: |
            An alias for the dependency. Used for input variable mapping.
          required: true
  - name: "inputVariableMapping"
    type: Array
    api_name: "inputVariableMappings"
    description: |
      List of inputVariables for this UnitKind that will either be retrieved from a dependency's outputVariables,
      or will be passed on to a dependency's inputVariables. Maximum 100.
    item_type:
      type: NestedObject
      properties:
        - name: "variable"
          type: String
          description: |
            The name of the variable.
          required: true
        - name: "from"
          type: NestedObject
          exactly_one_of:
            - "from"
            - "to"
          properties:
            - name: "dependency"
              type: String
              description: |
                Alias of the dependency that the outputVariable will pass its value from.
              required: true
            - name: "outputVariable"
              type: String
              description: |
                Name of the outputVariable on the dependency.
              required: true
        - name: "to"
          type: NestedObject
          exactly_one_of:
            - "from"
            - "to"
          properties:
            - name: "dependency"
              type: String
              description: |
                Alias of the dependency that the inputVariable will pass its value to.
              required: true
            - name: "inputVariable"
              type: String
              description: |
                Name of the inputVariable on the dependency.
              required: true
            - name: "ignoreForLookup"
              type: Boolean
              description: |
                Tells SaaS Runtime if this mapping should be used during lookup or not.
              required: true
  - name: "labels"
    type: KeyValueLabels
    description: |-
      The labels on the resource, which can be used for categorization.
  - name: "annotations"
    type: KeyValueAnnotations
    description: |-
      Annotations is an unstructured key-value map stored with a resource that may be set by external
      tools to store and retrieve arbitrary metadata. They are not queryable and should be preserved
      when modifying objects.
  - name: "uid"
    type: String
    description: |
      Unique identifier of the UnitKind.
    output: true
  - name: "createTime"
    type: Time
    description: |
      Time the UnitKind was created in UTC.
    output: true
  - name: "updateTime"
    type: Time
    description: |
      Time the UnitKind was updated in UTC.
    output: true
