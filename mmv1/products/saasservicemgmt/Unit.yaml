# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: Unit
description: A Unit is the fundamental structural building block of a SaaS offering. Each Unit is an instance of a UnitKind. It is a versioned, manageable component of a service that has its own lifecycle, representing elements like infrastructure, workloads, or an entire application stack that a service producer intends to manage as a single entity.
base_url: projects/{{project}}/locations/{{location}}/units
update_mask: true
self_link: projects/{{project}}/locations/{{location}}/units/{{unit_id}}
create_url: projects/{{project}}/locations/{{location}}/units?unitId={{unit_id}}
update_verb: PATCH
id_format: projects/{{project}}/locations/{{location}}/units/{{unit_id}}
import_format:
  - projects/{{project}}/locations/{{location}}/units/{{unit_id}}
examples:
  - name: saas_runtime_unit_basic
    primary_resource_id: "example"
    min_version: "beta"
    vars:
      saas_name: example-saas
      unitkind_name: example-unitkind
      unit_name: example-unit
    test_env_vars:
      project: "PROJECT_NAME"
    bootstrap_iam:
      - member: "serviceAccount:service-{project_number}@gcp-sa-saasservicemgmt.iam.gserviceaccount.com"
        role: "roles/saasservicemgmt.serviceAgent"
autogen_async: false
autogen_status: VW5pdA==
parameters:
  - name: location
    type: String
    description: Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122.
    immutable: true
    url_param_only: true
    required: true
  - name: unitId
    type: String
    description: The ID value for the new unit.
    immutable: true
    url_param_only: true
    required: true
properties:
  - name: annotations
    type: KeyValueAnnotations
    description: |-
      Annotations is an unstructured key-value map stored with a resource that
      may be set by external tools to store and retrieve arbitrary metadata.
      They are not queryable and should be preserved when modifying objects.

      More info: https://kubernetes.io/docs/user-guide/annotations
  - name: conditions
    type: Array
    description: |-
      A set of conditions which indicate the various conditions this resource can
      have.
    output: true
    item_type:
      type: NestedObject
      properties:
        - name: lastTransitionTime
          type: String
          description: Last time the condition transited from one status to another.
          required: true
        - name: message
          type: String
          description: Human readable message indicating details about the last transition.
          required: true
        - name: reason
          type: String
          description: Brief reason for the condition's last transition.
          required: true
        - name: status
          type: String
          description: |-
            Status of the condition.
            Possible values:
            STATUS_UNKNOWN
            STATUS_TRUE
            STATUS_FALSE
          required: true
        - name: type
          type: String
          description: |-
            Type of the condition.
            Possible values:
            TYPE_READY
            TYPE_UPDATING
            TYPE_PROVISIONED
            TYPE_OPERATION_ERROR
          required: true
  - name: createTime
    type: String
    description: The timestamp when the resource was created.
    output: true
  - name: dependencies
    type: Array
    description: Set of dependencies for this unit. Maximum 10.
    output: true
    item_type:
      type: NestedObject
      properties:
        - name: alias
          type: String
          description: Alias for the name of the dependency.
          output: true
        - name: unit
          type: String
          description: A reference to the Unit object.
          output: true
  - name: dependents
    type: Array
    description: |-
      List of Units that depend on this unit. Unit can only be deprovisioned if
      this list is empty. Maximum 1000.
    output: true
    item_type:
      type: NestedObject
      properties:
        - name: alias
          type: String
          description: Alias for the name of the dependency.
          output: true
        - name: unit
          type: String
          description: A reference to the Unit object.
          output: true
  - name: inputVariables
    type: Array
    description: Indicates the current input variables deployed by the unit
    output: true
    item_type:
      type: NestedObject
      properties:
        - name: type
          type: String
          description: |-
            Name of a supported variable type. Supported types are string, int, bool.
            Possible values:
            STRING
            INT
            BOOL
          immutable: true
        - name: value
          type: String
          description: String encoded value for the variable.
        - name: variable
          type: String
          description: Name of the variable from actuation configs.
          immutable: true
          required: true
  - name: labels
    type: KeyValueLabels
    description: |-
      The labels on the resource, which can be used for categorization.
      similar to Kubernetes resource labels.
  - name: maintenance
    type: NestedObject
    description: |-
      Captures requested directives for performing future maintenance on the
      unit. This includes a request for the unit to skip maintenance for a period
      of time and remain pinned to its current release as well as controls for
      postponing maintenance scheduled in future.
    properties:
      - name: pinnedUntilTime
        type: String
        description: |-
          If present, it fixes the release on the unit until the given time; i.e.
          changes to the release field will be rejected. Rollouts should and will
          also respect this by not requesting an upgrade in the first place.
  - name: managementMode
    type: String
    description: |-
      Indicates whether the Unit life cycle is controlled
      by the user or by the system.
      Immutable once created.
      Possible values:
      MANAGEMENT_MODE_USER
      MANAGEMENT_MODE_SYSTEM
    immutable: true
  - name: name
    type: String
    description: |-
      Identifier. The resource name (full URI of the resource) following the standard naming
      scheme:

      "projects/{project}/locations/{location}/units/{unit}"
    output: true
  - name: ongoingOperations
    type: Array
    description: List of concurrent UnitOperations that are operating on this Unit.
    output: true
    item_type:
      type: String
  - name: outputVariables
    type: Array
    description: |-
      Set of key/value pairs corresponding to output variables from execution of
      actuation templates. The variables are declared in actuation configs (e.g
      in helm chart or terraform) and the values are fetched and returned by the
      actuation engine upon completion of execution.
    output: true
    item_type:
      type: NestedObject
      properties:
        - name: type
          type: String
          description: |-
            Name of a supported variable type. Supported types are string, int, bool.
            Possible values:
            STRING
            INT
            BOOL
          immutable: true
        - name: value
          type: String
          description: String encoded value for the variable.
        - name: variable
          type: String
          description: Name of the variable from actuation configs.
          immutable: true
          required: true
  - name: pendingOperations
    type: Array
    description: List of pending (wait to be executed) UnitOperations for this unit.
    output: true
    item_type:
      type: String
  - name: release
    type: String
    description: The current Release object for this Unit.
    output: true
  - name: scheduledOperations
    type: Array
    description: List of scheduled UnitOperations for this unit.
    output: true
    item_type:
      type: String
  - name: state
    type: String
    description: |-
      Current lifecycle state of the resource (e.g. if it's being
      created or ready to use).
      Possible values:
      UNIT_STATE_NOT_PROVISIONED
      UNIT_STATE_PROVISIONING
      UNIT_STATE_UPDATING
      UNIT_STATE_DEPROVISIONING
      UNIT_STATE_READY
      UNIT_STATE_ERROR
    output: true
  - name: systemCleanupAt
    type: String
    description: If set, indicates the time when the system will start removing the unit.
    output: true
  - name: systemManagedState
    type: String
    description: |-
      Indicates the system managed state of the unit.
      Possible values:
      SYSTEM_MANAGED_STATE_ACTIVE
      SYSTEM_MANAGED_STATE_INACTIVE
      SYSTEM_MANAGED_STATE_DECOMMISSIONED
    output: true
  - name: tenant
    type: String
    description: |-
      Reference to the Saas Tenant resource this unit belongs to. This for
      example informs the maintenance policies to use for scheduling future
      updates on a unit. (optional and immutable once created)
  - name: uid
    type: String
    description: |-
      The unique identifier of the resource. UID is unique in the time
      and space for this resource within the scope of the service. It is
      typically generated by the server on successful creation of a resource
      and must not be changed. UID is used to uniquely identify resources
      with resource name reuses. This should be a UUID4.
    output: true
  - name: unitKind
    type: String
    description: Reference to the UnitKind this Unit belongs to. Immutable once set.
  - name: updateTime
    type: String
    description: |-
      The timestamp when the resource was last updated. Any
      change to the resource made by users must refresh this value.
      Changes to a resource made by the service should refresh this value.
    output: true
