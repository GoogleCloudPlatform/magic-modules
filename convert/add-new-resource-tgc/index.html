<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Add TGC conversion#


This method of adding TGC support is currently experimental and not officially supported. We recommended this path only for core contributors.

terraform-google-conversion (TGC) consumes a Terraform plan and uses it to build Cloud Asset Inventory (CAI) Assets. These built assets only exist in memory locally.
TGC supports only those GCP resources that are available in both the Terraform provider and Cloud Asset Inventory.
Before you begin#
Getting a Terraform resource name from a GCP resource name#
The first step in determining if a GCP resource is supported is to identify the corresponding Terraform resource. You can often do this by searching for the GCP resource name in the Terraform google provider documentation."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/convert/add-new-resource-tgc/"><meta property="og:site_name" content="Magic Modules"><meta property="og:title" content="Add TGC conversion"><meta property="og:description" content="Add TGC conversion# This method of adding TGC support is currently experimental and not officially supported. We recommended this path only for core contributors. terraform-google-conversion (TGC) consumes a Terraform plan and uses it to build Cloud Asset Inventory (CAI) Assets. These built assets only exist in memory locally.
TGC supports only those GCP resources that are available in both the Terraform provider and Cloud Asset Inventory.
Before you begin# Getting a Terraform resource name from a GCP resource name# The first step in determining if a GCP resource is supported is to identify the corresponding Terraform resource. You can often do this by searching for the GCP resource name in the Terraform google provider documentation."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="convert"><meta property="article:modified_time" content="2025-10-20T10:08:44-07:00"><title>Add TGC conversion | Magic Modules</title><link rel=icon href=/magic-modules/favicon.png><link rel=manifest href=/magic-modules/manifest.json><link rel=canonical href=https://googlecloudplatform.github.io/magic-modules/convert/add-new-resource-tgc/><link rel=stylesheet href=/magic-modules/book.min.34f6ea145e56d87823abe9f451d0a8fbe3dbcc6f9e02412199a014611b7adf70.css integrity="sha256-NPbqFF5W2Hgjq+n0UdCo++PbzG+eAkEhmaAUYRt633A=" crossorigin=anonymous><script defer src=/magic-modules/fuse.min.js></script><script defer src=/magic-modules/en.search.min.f80a1790b33c1c9d52b24e467f117903baf956e86799991ca9e8f53a2a67c0d7.js integrity="sha256-+AoXkLM8HJ1Ssk5GfxF5A7r5VuhnmZkcqej1OipnwNc=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-convert"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/magic-modules/ title=Overview>Overview</a></li></ul><ul><li><a href=/magic-modules/contribution-process/>Contribution process</a></li><li><input type=checkbox id=section-1218d39abefe7f824522d24e615b6429 class=toggle>
<label for=section-1218d39abefe7f824522d24e615b6429 class=flex><a role=button>Develop</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/develop/set-up-dev-environment/>Set up your development environment</a></li><li><a href=/magic-modules/develop/add-resource/>Add a resource</a></li><li><a href=/magic-modules/develop/add-fields/>Add a field to an existing resource</a></li><li><a href=/magic-modules/develop/add-iam-support/>Add IAM support</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/update-dependencies/>Update dependencies</a></li><li><a href=/magic-modules/develop/diffs/>Fix diffs</a></li><li><a href=/magic-modules/develop/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/develop/client-side-fields/>Client-side fields</a></li></ul></li><li><input type=checkbox id=section-46008ee5c4ef0e6f804abf3cfaea6dd0 class=toggle>
<label for=section-46008ee5c4ef0e6f804abf3cfaea6dd0 class=flex><a role=button>Test</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/test/test/>Add resource tests</a></li><li><a href=/magic-modules/test/run-tests/>Run tests</a></li></ul></li><li><input type=checkbox id=section-54e8c97150acf80b182bc188a6e6c492 class=toggle>
<label for=section-54e8c97150acf80b182bc188a6e6c492 class=flex><a role=button>Document</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/document/add-documentation/>Add documentation</a></li><li><a href=/magic-modules/document/handwritten-docs-style-guide/>Handwritten docs style guide</a></li></ul></li><li><input type=checkbox id=section-d11be9eb6f9aad36128162d909d31b29 class=toggle checked>
<label for=section-d11be9eb6f9aad36128162d909d31b29 class=flex><a role=button>Convert</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/convert/add-new-resource-tgc/ class=active>Add TGC conversion</a></li></ul></li><li><input type=checkbox id=section-ca39f9a7961e297a8c04b44ec69dbc58 class=toggle>
<label for=section-ca39f9a7961e297a8c04b44ec69dbc58 class=flex><a role=button>Breaking changes</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/breaking-changes/breaking-changes/>Types of breaking changes</a></li><li><a href=/magic-modules/breaking-changes/make-a-breaking-change/>Make a breaking change</a></li></ul></li><li><input type=checkbox id=section-e42fc06bc1be2cad20d6487ff549c503 class=toggle>
<label for=section-e42fc06bc1be2cad20d6487ff549c503 class=flex><a role=button>Code review</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/code-review/create-pr/>Create a pull request</a></li><li><a href=/magic-modules/code-review/release-notes/>Write release notes</a></li><li><a href=/magic-modules/code-review/review-pr/>Review a pull request</a></li></ul></li><li><input type=checkbox id=section-29607ad0ac6d788001e899a44038a031 class=toggle>
<label for=section-29607ad0ac6d788001e899a44038a031 class=flex><a role=button>Best practices</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/best-practices/immutable-fields/>Immutable fields</a></li><li><a href=/magic-modules/best-practices/deletion-behaviors/>Deletion behaviors</a></li><li><a href=/magic-modules/best-practices/labels-and-annotations/>Labels and annotations</a></li><li><a href=/magic-modules/best-practices/common-resource-patterns/>Common resource patterns</a></li><li><a href=/magic-modules/best-practices/validation/>Validation</a></li></ul></li><li><input type=checkbox id=section-3de530fff78b7e92c59925d632c7e725 class=toggle>
<label for=section-3de530fff78b7e92c59925d632c7e725 class=flex><a role=button>Reference</a>
<img src=/magic-modules/icons/chevron-right.svg class=book-icon></label><ul><li><a href=/magic-modules/reference/resource/>MMv1 resource reference</a></li><li><a href=/magic-modules/reference/field/>MMv1 field reference</a></li><li><a href=/magic-modules/reference/make-commands/>make commands</a></li><li><a href=/magic-modules/reference/metadata/>MMv1 metadata reference</a></li><li><a href=/magic-modules/reference/ruby-go-changes/>Ruby to Go Migration</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/icons/menu.svg class=book-icon alt=Menu></label><h3>Add TGC conversion</h3><label for=toc-control><img src=/magic-modules/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a><ul><li><a href=#getting-a-terraform-resource-name-from-a-gcp-resource-name>Getting a Terraform resource name from a GCP resource name</a></li><li><a href=#getting-the-cai-asset-type-of-a-gcp-resource>Getting the CAI asset type of a GCP resource</a></li></ul></li><li><a href=#adding-support>Adding support</a><ul><li><a href=#1-adding-a-resource-to-tgc>1. Adding a resource to TGC</a></li><li><a href=#2-generate-terraform-google-conversion>2. Generate terraform-google-conversion</a></li><li><a href=#3-run-tests-locally>3. Run tests locally</a></li><li><a href=#4-make-prs>4. Make PRs</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=add-tgc-conversion>Add TGC conversion<a class=anchor href=#add-tgc-conversion>#</a></h1><blockquote class="book-hint warning">This method of adding TGC support is currently experimental and not officially supported. We recommended this path only for core contributors.</blockquote><p>terraform-google-conversion (TGC) consumes a Terraform plan and uses it to build Cloud Asset Inventory (CAI) Assets. These built assets only exist in memory locally.</p><p>TGC supports only those GCP resources that are available in both the Terraform provider and Cloud Asset Inventory.</p><h2 id=before-you-begin>Before you begin<a class=anchor href=#before-you-begin>#</a></h2><h3 id=getting-a-terraform-resource-name-from-a-gcp-resource-name>Getting a Terraform resource name from a GCP resource name<a class=anchor href=#getting-a-terraform-resource-name-from-a-gcp-resource-name>#</a></h3><p>The first step in determining if a GCP resource is supported is to identify the corresponding Terraform resource. You can often do this by searching for the GCP resource name in the <a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs>Terraform google provider documentation</a>.</p><h3 id=getting-the-cai-asset-type-of-a-gcp-resource>Getting the CAI asset type of a GCP resource<a class=anchor href=#getting-the-cai-asset-type-of-a-gcp-resource>#</a></h3><p>The second step in determining if a GCP resource is supported is to verify its inclusion in the Cloud Asset Inventory (CAI). You can complete this by searching for the resource&rsquo;s asset type within CAI&rsquo;s list of <a href=https://cloud.google.com/asset-inventory/docs/asset-types>supported asset types</a>.</p><h2 id=adding-support>Adding support<a class=anchor href=#adding-support>#</a></h2><p>Adding support for a resource has 4 steps:</p><ol><li>Make changes to <a href=https://github.com/GoogleCloudPlatform/magic-modules>Magic Modules</a> to add resource conversion code.</li><li>Generate terraform-google-conversion.</li><li>Run tests locally.</li><li>Make PRs for Magic Modules with your changes.</li></ol><p>Each of these is discussed in more detail below.</p><h3 id=1-adding-a-resource-to-tgc>1. Adding a resource to TGC<a class=anchor href=#1-adding-a-resource-to-tgc>#</a></h3><div class=book-tabs><input type=radio class=toggle name=tabs-resource id=tabs-resource-0 checked><label for=tabs-resource-0>MMv1</label><div class="book-tabs-content markdown-inner"><p>Magic Modules uses a shared code base to generate terraform-google-conversion and the <a href=https://github.com/hashicorp/terraform-provider-google>google</a> and <a href=https://github.com/hashicorp/terraform-provider-google-beta>google-beta</a> Terraform providers.
Most Terraform resources are represented as <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/master/mmv1/products>yaml files which are grouped by product</a>.
Each product has a <code>product.yaml</code> file (which defines the basic product information) and Resource.yaml files (which defines any resource-specific information).
A Resource.yaml file can specify <code>include_in_tgc_next_DO_NOT_USE: true</code> to enable converters autogeneration, or <code>exclude_resource: true</code> to skip autogeneration for both converters and the providers.</p><p>Auto-generating converters code based on yaml files is strongly preferred.</p></div><input type=radio class=toggle name=tabs-resource id=tabs-resource-1><label for=tabs-resource-1>Handwritten</label><div class="book-tabs-content markdown-inner"><h4 id=handwritten-converters>Handwritten converters<a class=anchor href=#handwritten-converters>#</a></h4><p>If autogenerated converter are not possible, you can instead place three handwritten files in the specific Product folder in the <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/tgc_next/pkg/services><code>mmv1/third_party/tgc_next/pkg/services</code> folder</a>.</p><h5 id=resourcego-file>Resource.go file<a class=anchor href=#resourcego-file>#</a></h5><p>The Resource.go file defines the resource, providing its CAI asset type, Terraform schema name, resource schema, and supporting utility functions.</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#78787e>// The type comes from https://cloud.google.com/asset-inventory/docs/supported-asset-types</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>const</span> ProductResourceAssetType <span style=color:#9aedfe>string</span> = <span style=color:#5af78e>&#34;whatever.googleapis.com/asset-type&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e>// ProductResourceSchemaName is the TF resource schema name for the Resource resource within Product.</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>const</span> ProductResourceSchemaName <span style=color:#9aedfe>string</span> = <span style=color:#5af78e>&#34;google_product_resource&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e>// Copy the resource schema from [google](https://github.com/hashicorp/terraform-provider-google) Terraform provider</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>func</span> <span style=color:#57c7ff>ResourceGoogleProject</span>() <span style=color:#ff6ac1>*</span>schema.Resource {
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>&amp;</span>schema.Resource{
</span></span><span style=display:flex><span>		SchemaVersion: <span style=color:#ff9f43>1</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Schema: <span style=color:#ff5c57>map</span>[<span style=color:#9aedfe>string</span>]<span style=color:#ff6ac1>*</span>schema.Schema{
</span></span><span style=display:flex><span>			<span style=color:#ff6ac1>...</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>You will also need to add an entry to <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/templates/tgc_next/provider/provider_mmv1_resources.go.tmpl><code>tgc_next/provider/provider_mmv1_resources.go.tmpl</code></a>, which is used to generate <a href=https://github.com/GoogleCloudPlatform/terraform-google-conversion/blob/main/pkg/provider/provider_mmv1_resources.go><code>pkg/provider/provider_mmv1_resources.go</code></a>. Each entry in <code>provider_mmv1_resources.go.tmpl</code> maps a terraform resource name to a function that returns the resource schema - in this case:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#78787e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#5af78e>&#34;google_product_resource&#34;</span>: product.<span style=color:#57c7ff>ResourceName</span>(),
</span></span><span style=display:flex><span><span style=color:#78787e>// ...</span></span></span></code></pre></div><h5 id=resource_tfplan2caigo-file>Resource_tfplan2cai.go file<a class=anchor href=#resource_tfplan2caigo-file>#</a></h5><p>Most resources will only need a resource converter with a conversion func. For example, Resource resource within Product, this might look like:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#ff5c57>func</span> <span style=color:#57c7ff>resourceConverterProductResource</span>() ResourceConverter {
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>return</span> ResourceConverter{
</span></span><span style=display:flex><span>		Convert:   GetProductResourceCaiObject,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>func</span> <span style=color:#57c7ff>GetProductResourceCaiObject</span>(d TerraformResourceData, config <span style=color:#ff6ac1>*</span>Config) ([]Asset, <span style=color:#9aedfe>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#78787e>// This function does basic conversion of a Terraform resource to a CAI Asset.</span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// The asset path (name) will substitute in variables from the Terraform resource.</span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// The format should match what is specified at https://cloud.google.com/asset-inventory/docs/supported-asset-types</span>
</span></span><span style=display:flex><span>	name, err <span style=color:#ff6ac1>:=</span> <span style=color:#57c7ff>assetName</span>(d, config, <span style=color:#5af78e>&#34;//whatever.googleapis.com/projects/{{project}}/whatevers/{{name}}&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>if</span> err <span style=color:#ff6ac1>!=</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>return</span> []Asset{}, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>if</span> obj, err <span style=color:#ff6ac1>:=</span> <span style=color:#57c7ff>GetProductResourceApiObject</span>(d, config); err <span style=color:#ff6ac1>==</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>return</span> []Asset{{
</span></span><span style=display:flex><span>			Name: name,
</span></span><span style=display:flex><span>			Type: ProductResourceAssetType,
</span></span><span style=display:flex><span>			Resource: <span style=color:#ff6ac1>&amp;</span>AssetResource{
</span></span><span style=display:flex><span>				Version:              <span style=color:#5af78e>&#34;v1&#34;</span>,  <span style=color:#78787e>// or whatever the correct version is</span>
</span></span><span style=display:flex><span>				DiscoveryDocumentURI: <span style=color:#5af78e>&#34;https://www.googleapis.com/path/to/rest/api/docs&#34;</span>,
</span></span><span style=display:flex><span>				DiscoveryName:        <span style=color:#5af78e>&#34;Whatever&#34;</span>,  <span style=color:#78787e>// The term used to refer to this resource by the official documentation</span>
</span></span><span style=display:flex><span>				Data:                 obj,
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		}}, <span style=color:#ff6ac1>nil</span>
</span></span><span style=display:flex><span>	} <span style=color:#ff6ac1>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>return</span> []Asset{}, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>func</span> <span style=color:#57c7ff>GetProductResourceApiObject</span>(d TerraformResourceData, config <span style=color:#ff6ac1>*</span>Config) (<span style=color:#ff5c57>map</span>[<span style=color:#9aedfe>string</span>]<span style=color:#ff5c57>interface</span>{}, <span style=color:#9aedfe>error</span>) {
</span></span><span style=display:flex><span>	obj <span style=color:#ff6ac1>:=</span> <span style=color:#ff5c57>make</span>(<span style=color:#ff5c57>map</span>[<span style=color:#9aedfe>string</span>]<span style=color:#ff5c57>interface</span>{})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// copy values from the terraform resource to obj</span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// return any errors encountered</span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>return</span> obj, <span style=color:#ff6ac1>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>You will also need to add an entry to <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/templates/tgc_next/tfplan2cai/resource_converters.go.tmpl><code>tgc_next/tfplan2cai/resource_converters.go.tmpl</code></a>, which is used to generate <a href=https://github.com/GoogleCloudPlatform/terraform-google-conversion/blob/main/pkg/tfplan2cai/converters/resource_converters.go><code>pkg/tfplan2cai/converters/resource_converters.go</code></a>. Each entry in <code>resource_converters.go.tmpl</code> maps a terraform resource name to a function that returns a ResourceConverter - in this case:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#78787e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#5af78e>&#34;google_product_resource&#34;</span>: product.<span style=color:#57c7ff>ResourceTfplan2caiConverter</span>(),
</span></span><span style=display:flex><span><span style=color:#78787e>// ...</span></span></span></code></pre></div><h5 id=resource_cai2hclgo-file>Resource_cai2hcl.go file<a class=anchor href=#resource_cai2hclgo-file>#</a></h5><p>Most resources will only need a resource converter with a conversion func in the handwritten Resource_cai2hcl.go file. For the Resource resource within Product, this might look like:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#78787e>// ProductResourceConverter for the Resource resource within Product.</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>type</span> ProductResourceConverter <span style=color:#ff5c57>struct</span> {
</span></span><span style=display:flex><span>	name   <span style=color:#9aedfe>string</span>
</span></span><span style=display:flex><span>	schema <span style=color:#ff5c57>map</span>[<span style=color:#9aedfe>string</span>]<span style=color:#ff6ac1>*</span>schema.Schema
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e>// NewProductResourceConverter returns an HCL converter for compute instance.</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>func</span> <span style=color:#57c7ff>NewProductResourceConverter</span>(provider <span style=color:#ff6ac1>*</span>schema.Provider) common.Converter {
</span></span><span style=display:flex><span>	schema <span style=color:#ff6ac1>:=</span> provider.ResourcesMap[ProductResourceSchemaName].Schema
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>&amp;</span>ProductResourceConverter{
</span></span><span style=display:flex><span>		name:   ProductResourceSchemaName,
</span></span><span style=display:flex><span>		schema: schema,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e>// Convert converts asset to HCL resource blocks.</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>func</span> (c <span style=color:#ff6ac1>*</span>ProductResourceConverter) <span style=color:#57c7ff>Convert</span>(assets []<span style=color:#ff6ac1>*</span>caiasset.Asset) ([]<span style=color:#ff6ac1>*</span>common.HCLResourceBlock, <span style=color:#9aedfe>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#ff5c57>var</span> blocks []<span style=color:#ff6ac1>*</span>common.HCLResourceBlock
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>for</span> _, asset <span style=color:#ff6ac1>:=</span> <span style=color:#ff6ac1>range</span> assets {
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>if</span> asset <span style=color:#ff6ac1>==</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#ff6ac1>continue</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>if</span> asset.Resource <span style=color:#ff6ac1>!=</span> <span style=color:#ff6ac1>nil</span> <span style=color:#ff6ac1>&amp;&amp;</span> asset.Resource.Data <span style=color:#ff6ac1>!=</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>			block, err <span style=color:#ff6ac1>:=</span> c.<span style=color:#57c7ff>convertResourceData</span>(asset)
</span></span><span style=display:flex><span>			<span style=color:#ff6ac1>if</span> err <span style=color:#ff6ac1>!=</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>nil</span>, err
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			blocks = <span style=color:#ff5c57>append</span>(blocks, block)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>return</span> blocks, <span style=color:#ff6ac1>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>func</span> (c <span style=color:#ff6ac1>*</span>ProductResourceConverter) <span style=color:#57c7ff>convertResourceData</span>(asset <span style=color:#ff6ac1>*</span>caiasset.Asset) (<span style=color:#ff6ac1>*</span>common.HCLResourceBlock, <span style=color:#9aedfe>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>if</span> asset <span style=color:#ff6ac1>==</span> <span style=color:#ff6ac1>nil</span> <span style=color:#ff6ac1>||</span> asset.Resource <span style=color:#ff6ac1>==</span> <span style=color:#ff6ac1>nil</span> <span style=color:#ff6ac1>||</span> asset.Resource.Data <span style=color:#ff6ac1>==</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>nil</span>, fmt.<span style=color:#57c7ff>Errorf</span>(<span style=color:#5af78e>&#34;asset resource data is nil&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	hclData <span style=color:#ff6ac1>:=</span> <span style=color:#ff5c57>make</span>(<span style=color:#ff5c57>map</span>[<span style=color:#9aedfe>string</span>]<span style=color:#ff5c57>interface</span>{})
</span></span><span style=display:flex><span>	<span style=color:#78787e>// copy values from the CAI asset to hclData</span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// return any errors encountered</span>
</span></span><span style=display:flex><span>	<span style=color:#78787e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	ctyVal, err <span style=color:#ff6ac1>:=</span> common.<span style=color:#57c7ff>MapToCtyValWithSchema</span>(hclData, c.schema)
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>if</span> err <span style=color:#ff6ac1>!=</span> <span style=color:#ff6ac1>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>nil</span>, err
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>&amp;</span>common.HCLResourceBlock{
</span></span><span style=display:flex><span>		Labels: []<span style=color:#9aedfe>string</span>{c.name, <span style=color:#5af78e>&#34;Whatever&#34;</span>},
</span></span><span style=display:flex><span>		Value:  ctyVal,
</span></span><span style=display:flex><span>	}, <span style=color:#ff6ac1>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>You will also need to add an entry to <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/templates/tgc_next/cai2hcl/resource_converters.go.tmpl><code>tgc_next/cai2hcl/resource_converters.go.tmpl</code></a>, which is used to generate <a href=https://github.com/GoogleCloudPlatform/terraform-google-conversion/blob/main/pkg/cai2hcl/converters/resource_converters.go><code>pkg/cai2hcl/converters/resource_converters.go</code></a>. Each entry in <code>resource_converters.go.tmpl</code> maps a CAI asset type to a function that returns a ResourceConverter - in this case:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#78787e>// ...</span>
</span></span><span style=display:flex><span><span style=color:#5af78e>&#34;alloydb.googleapis.com/Backup&#34;</span>: {
</span></span><span style=display:flex><span>	<span style=color:#5af78e>&#34;Default&#34;</span>: alloydb.<span style=color:#57c7ff>NewAlloydbBackupCai2hclConverter</span>(provider),
</span></span><span style=display:flex><span>},
</span></span><span style=display:flex><span><span style=color:#78787e>// ...</span></span></span></code></pre></div></div></div><h3 id=2-generate-terraform-google-conversion>2. Generate terraform-google-conversion<a class=anchor href=#2-generate-terraform-google-conversion>#</a></h3><p>To generate terraform-google-conversion code locally, run the following from the root of the <code>magic-modules</code> repository:</p><pre tabindex=0><code>make tgc OUTPUT_PATH=&#34;/path/to/your/terraform-google-conversion&#34;</code></pre><h3 id=3-run-tests-locally>3. Run tests locally<a class=anchor href=#3-run-tests-locally>#</a></h3><h4 id=before-you-begin-1>Before you begin<a class=anchor href=#before-you-begin-1>#</a></h4><ol><li>Set the following environment variable:</li></ol><pre tabindex=0><code>export WRITE_FILES=true</code></pre><ol start=2><li><p>Please request the necessary permission for the GCS bucket <a href="https://pantheon.corp.google.com/storage/browser/cai_assets_metadata;tab=permissions?forceOnBucketsSortingFiltering=true&amp;e=13802955&amp;inv=1&amp;invt=Ab0TPA&amp;mods=ml_engine_alpha_ng2&amp;project=tgc-test-infra&amp;prefix=&amp;forceOnObjectsSortingFiltering=false">cai_assets_metadata</a>, which stores the nightly test metadata required to run the integration tests.</p><p>Ensure you have the correct Go version installed. Follow <a href=https://googlecloudplatform.github.io/magic-modules/get-started/generate-providers/#before-you-begin>Before you begin</a> and <a href=https://googlecloudplatform.github.io/magic-modules/develop/set-up-dev-environment/>Setup your development environment</a> from the <a href=https://googlecloudplatform.github.io/magic-modules/get-started/generate-providers/>Magic Modules documentation</a>.</p></li></ol><h4 id=run-unit-tests>Run unit tests<a class=anchor href=#run-unit-tests>#</a></h4><p>To run the unit tests locally, run the following from the root of the <code>terraform-google-conversion</code> repository:</p><pre tabindex=0><code>make test</code></pre><h4 id=run-integration-tests>Run integration tests<a class=anchor href=#run-integration-tests>#</a></h4><p>In the following examples, the resource being tested is <code>google_alloydb_backup</code>.</p><p>To run the integration tests for the added resource locally, run the following from the root of the <code>terraform-google-conversion</code> repository:</p><pre tabindex=0><code>make test-integration-local TESTPATH=./test/services/alloydb  TESTARGS=&#39;-run=TestAccAlloydbBackup&#39; &gt; alloydbBackup.log</code></pre><p>To run one integration test for the added resource locally, run the following from the root of the <code>terraform-google-conversion</code> repository:</p><pre tabindex=0><code>make test-integration-local TESTPATH=./test/services/alloydb  TESTARGS=&#39;-run=TestAccAlloydbBackup_alloydbBackupBasicTestExample&#39; &gt; alloydbBackup.log</code></pre><p>The core integration tests in <code>terraform-google-conversion</code> mirror the naming of the corresponding acceptance tests in the Terraform provider. This testing process uses a crucial round-trip validation method:</p><ol><li><p>Test Input Data</p><p>The input for each equivalent integration test combines two elements:</p><ul><li><p>The original Terraform resource configuration from the acceptance test step.</p></li><li><p>The Cloud Asset Inventory (CAI) data exported from the actual resources provisioned during the nightly execution of the Terraform provider tests.</p></li></ul></li><li><p>Test File Generation (WRITE_FILES Flow)</p><p>By setting the environment variable WRITE_FILES, running the integration tests locally generates a series of files in the service folder, detailing the entire conversion cycle.</p><p>For example, running <code>TestAccAlloydbBackup_alloydbBackupBasicTestExample</code> successfully creates five files for each step:</p></li></ol><table><thead><tr><th style=text-align:left>File</th><th style=text-align:left>Content</th><th style=text-align:left>Conversion Step</th></tr></thead><tbody><tr><td style=text-align:left>File 1 (.tf)</td><td style=text-align:left>Original Terraform configuration (raw_config)</td><td style=text-align:left>Start</td></tr><tr><td style=text-align:left>File 2 (.json)</td><td style=text-align:left>CAI Assets exported from the resource (export_assets)</td><td style=text-align:left>Input for CAI to HCL</td></tr><tr><td style=text-align:left>File 3 (export.tf)</td><td style=text-align:left>Converted Terraform configuration (export_config) from File 2</td><td style=text-align:left>cai2hcl</td></tr><tr><td style=text-align:left>File 4 (roundtrip.json)</td><td style=text-align:left>CAI Assets (roundtrip_assets) converted from File 3</td><td style=text-align:left>tfplan2cai</td></tr><tr><td style=text-align:left>File 5 (roundtrip.tf)</td><td style=text-align:left>Final Terraform configuration (roundtrip_config) from File 4</td><td style=text-align:left>cai2hcl</td></tr></tbody></table><p>The integration tests pass only when two conditions are met:</p><ol><li>Every field in the original <code>raw_config</code> must exist within the generated <code>export_config</code>.</li><li>The <code>export_config</code> and the final <code>roundtrip_config</code> must contain the same sets of fields.</li></ol><h4 id=address-integration-test-failures>Address integration test failures<a class=anchor href=#address-integration-test-failures>#</a></h4><p>To resolve integration test failures, you need to apply the correct override configuration to the Resource.yaml file, based on the root cause of the data mismatch or failure.</p><ul><li><p>Test Specific Overrides</p><p>These rules are applied when a specific test cannot be reliably executed or fails due to expected differences in zero values.</p><ul><li><p>Ignore Zero Values (in raw_config)</p><p>Add <code>tgc_test_ignore_extra</code> to the resource example in Resource.yaml. This tells the test to ignore fields that have a zero value in the original Terraform configuration (raw_config) but retain a value in the exported CAI assets (export_assets).</p></li><li><p>Skip the Entire Test</p><p>Add <code>tgc_skip_test:REASON</code> to the resource example in Resource.yaml, providing a brief explanation for why the test is being skipped.</p></li></ul></li><li><p>Resource-specific Overrides</p><p>These rules address mismatches in how the resource is identified or where it is converted.</p><ul><li><p>Fix CAI Resource Kind Mismatch</p><p>If the CAI asset type differs from the Terraform API resource kind (<code>api_resource_type_kind</code>), add the correct <code>cai_resource_kind</code> to the Resource.yaml file.</p></li><li><p>Ignore Default Terraform Encoder</p><p>If the default Terraform encoding applied during conversion is causing issues, disable it by adding <code>tgc_ignore_terraform_encoder: true</code> to the Resource.yaml file.</p></li><li><p>Ignore Default Terraform Decoder</p><p>If the default Terraform decoding applied during conversion is causing issues, disable it by adding <code>tgc_ignore_terraform_decoder: true</code> to the Resource.yaml file.</p></li><li><p>Custom Decoder (CAI → GET API object Mismatch)</p><p>This is used when the value of a field in a CAI asset is different from the value required in the final API object during cai2hcl.</p><ol><li><p>Add the <code>tgc_decoder</code> file path to the field in Resource.yaml.</p></li><li><p>Implement the custom Go code in the corresponding file under <code>mmv1/templates/tgc_next/decoders</code>.</p></li></ol></li><li><p>Custom Encoder (CREATE API object -> CAI Mismatch)</p><p>This is used when the value of a field in a CAI asset is different from the value needed in the API object when the resource is first created during tfplan2cai.</p><ol><li><p>Add the <code>tgc_encoder</code> file path to the field in Resource.yaml.</p></li><li><p>Implement the custom Go code in the corresponding file under <code>mmv1/templates/tgc_next/encoders</code>.</p></li></ol></li></ul></li><li><p>Field-Specific Overrides</p><p>These rules are used when custom code is required because the field values or structure change during the tfplan2cai or cai2hcl conversion process.</p><ul><li><p>Ignore Field Missing in CAI</p><p>If a field is present in the Terraform resource but not supported or exported by Cloud Asset Inventory (CAI), add <code>is_missing_in_cai: true</code> to that specific field&rsquo;s definition in the Resource.yaml file.</p></li><li><p>Ignore Default Terraform Custom Flatten</p><p>If the default flattening logic is incorrect for TGC, disable it by adding <code>tgc_ignore_terraform_custom_flatten: true</code> to the field definition.</p></li><li><p>TGC Specific Expander / Flattener</p><p>For custom tfplan2cai conversion logic, add <code>custom_tgc_expand</code> to the field.</p><p>For custom cai2hcl conversion logic, add <code>custom_tgc_flatten</code> to the field.</p></li></ul></li></ul><h3 id=4-make-prs>4. Make PRs<a class=anchor href=#4-make-prs>#</a></h3><p>Now that you have your code working locally, open a PR for <a href=https://github.com/GoogleCloudPlatform/magic-modules>Magic Modules</a>.</p><p>For the Magic Modules PR, check the build results within <code>presubmit-generate-diffs</code>. Click through the build links, and find the results of <code>tgc-test</code>, <code>tgc-test-integration-*</code> - the other checks only matter if you&rsquo;re also making changes to the terraform provider.</p><p>If <code>tgc-test</code> fails, make sure you can run the unit tests successfully locally. If any of <code>tgc-test-integration-*</code> fails, make sure you can run the integration tests successfully locally.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/29fc5fcf701c8673fddf3632a6297701e05b203e title='Last modified by Zhenhua Li | October 20, 2025' target=_blank rel=noopener><img src=/magic-modules/icons/calendar.svg class=book-icon alt>
<span>October 20, 2025</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/convert%2fadd-new-resource-tgc.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/icons/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/convert/add-new-resource-tgc.md target=_blank rel="noopener edit"><img src=/magic-modules/icons/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap justify-between"><span><a href=/magic-modules/document/handwritten-docs-style-guide/ class="flex align-center"><img src=/magic-modules/icons/backward.svg class=book-icon alt=Previous title="Handwritten docs style guide">
<span>Handwritten docs style guide</span>
</a></span><span><a href=/magic-modules/breaking-changes/breaking-changes/ class="flex align-center"><span>Types of breaking changes</span>
<img src=/magic-modules/icons/forward.svg class=book-icon alt=Next title="Types of breaking changes"></a></span></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a><ul><li><a href=#getting-a-terraform-resource-name-from-a-gcp-resource-name>Getting a Terraform resource name from a GCP resource name</a></li><li><a href=#getting-the-cai-asset-type-of-a-gcp-resource>Getting the CAI asset type of a GCP resource</a></li></ul></li><li><a href=#adding-support>Adding support</a><ul><li><a href=#1-adding-a-resource-to-tgc>1. Adding a resource to TGC</a></li><li><a href=#2-generate-terraform-google-conversion>2. Generate terraform-google-conversion</a></li><li><a href=#3-run-tests-locally>3. Run tests locally</a></li><li><a href=#4-make-prs>4. Make PRs</a></li></ul></li></ul></nav></div></aside></main></body></html>